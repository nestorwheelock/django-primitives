# Beneath the Surface
## A Complete Guide to Dive Shop Logistics and Software Solutions

---

# Preface

Running a dive shop is unlike any other retail or service business. You're not just selling products or experiences—you're managing life-support equipment, navigating complex certification requirements, coordinating with weather and tides, and ensuring the safety of customers in an inherently risky environment.

This book is for dive shop owners, managers, and anyone considering entering the recreational diving industry. It covers the operational complexities unique to dive businesses and explores how modern software solutions can transform chaotic day-to-day operations into streamlined, profitable, and—most importantly—safe enterprises.

Whether you're running a small beach shack with a single boat or managing a multi-location dive resort, the principles in this book will help you understand, organize, and optimize your operations.

---

# Part I: Understanding Dive Shop Operations

---

## Chapter 1: The Anatomy of a Dive Shop

### 1.1 What Makes Dive Shops Different

A dive shop occupies a unique intersection of retail, education, tourism, and adventure sports. Unlike a typical retail business, a dive shop must:

- **Manage life-critical equipment** that requires regular maintenance and certification
- **Verify customer qualifications** before allowing participation in activities
- **Coordinate with environmental factors** like weather, tides, and water conditions
- **Maintain strict safety protocols** with legal and insurance implications
- **Balance seasonal demand** with year-round fixed costs
- **Navigate international certification standards** across multiple training agencies

This complexity means that operational mistakes don't just cost money—they can cost lives.

### 1.2 The Three Types of Dive Shops

Dive shops are not one-size-fits-all. Geography fundamentally determines business model:

---

**Type 1: Landlocked Shops** (Midwest USA, UK interior, continental Europe)

*"We bring diving to people who don't live near it"*

**Characteristics:**
- Brick-and-mortar retail stores
- Often in strip malls or industrial parks
- Pool access (owned, rented, or partnership with gyms/schools)
- Classroom facilities
- Limited or no boat operations

**Primary Revenue:**
1. **Equipment sales** (major revenue stream—their customers buy gear)
2. **Certification courses** (classroom + pool + referral or local checkout)
3. **Equipment service** (regulator service, hydro testing)
4. **Travel planning** (organizing group trips worldwide)

**Customer Profile:**
- Almost exclusively **Identity Divers**
- Committed enough to dive despite geography
- Own their equipment (or will soon)
- Plan vacations around diving
- High lifetime value, long relationships

**Certification Model:**
- Classroom: In-shop or online (eLearning)
- Confined water: Local pool
- Open water checkouts via:
  - Local quarry/lake (cold water, low viz, dedicated)
  - Referral to destination operator (customer completes in Cozumel, Bahamas, etc.)

**The Referral Economy:**
Landlocked shops create certified divers who then dive worldwide. They refer customers to destination operators for:
- Open water certification checkouts
- Continuing education specialties
- Recreational diving

This creates a symbiotic relationship—landlocked shops send customers; destination shops complete certifications and host diving.

**Software Needs:**
- Retail POS and inventory management
- Course scheduling (classroom + pool)
- Student tracking through certification
- Referral management and tracking
- Trip planning and group travel
- Equipment service records
- Customer relationship management (long-term)

---

**Type 2: Destination Operators** (Cozumel, Caribbean, Thailand, Red Sea, Great Barrier Reef)

*"We take people diving where diving is"*

**Characteristics:**
- Located in prime diving destinations
- Boat operations (usually multiple vessels)
- Minimal retail footprint
- Dock/marina presence
- Tourism-dependent

**Primary Revenue:**
1. **Guided dive trips** (2-tank trips, night dives, specialty trips)
2. **Discover Scuba / Try Dives** (high volume, tourism)
3. **Certification courses** (visitors getting certified on vacation)
4. **Referral completions** (finishing certs started elsewhere)
5. **Equipment rental** (tourists don't bring gear)

**What They Don't Do Much:**
- Equipment sales (tourists can't carry it home)
- Equipment service (locals are few)
- Long-term relationship building (customers leave)

**Customer Profile:**
- Heavy **Experience Diver** mix (tourists, bucket-listers)
- Visiting **Identity Divers** on dive trips
- Referral students completing certifications
- Seasonal/cruise ship traffic

**Operational Reality:**
- Multiple trips per day
- Weather-dependent scheduling
- Seasonal demand swings
- High staff turnover (seasonal workers)
- Multi-language requirements
- Cruise ship coordination
- Hotel/resort partnerships

**Software Needs:**
- Boat scheduling and manifest management
- High-volume booking and check-in
- Rental equipment tracking
- Multi-language support
- Integration with tourism channels (OTAs, hotels)
- Photo/video delivery
- Simplified customer profiles (transactional)
- Weather-based trip management

---

**Type 3: Coastal Shops** (Florida, California, Australia coast, Mediterranean)

*"We do it all because we can"*

**Characteristics:**
- Located near diveable water
- Hybrid retail + operations model
- Local customer base + tourism
- May have boats or do shore diving
- Year-round or extended season operations

**Primary Revenue:**
- Mix of everything:
  - Equipment sales to locals
  - Certification courses (full completion locally)
  - Guided local dives
  - Tourist experiences
  - Equipment service
  - Some travel planning

**Customer Profile:**
- Local **Identity Divers** (regular customers)
- Visiting **Identity Divers** (traveling divers)
- **Experience Divers** (tourists, try-divers)
- Students (locals getting certified for real use)

**Operational Complexity:**
Highest of all three types—they need to do everything:
- Retail operations
- Course delivery (complete, not referral)
- Boat/dive operations
- Equipment service
- Customer relationships (local loyalty)
- Tourism marketing
- Weather management

**Software Needs:**
- Full-featured: retail + operations + CRM
- Local customer profiles (long-term)
- Tourist profiles (transactional)
- Complete certification tracking
- Boat scheduling
- Equipment sales AND rental
- Service department management

---

**Comparison Matrix:**

| Aspect | Landlocked | Destination | Coastal | Independent | Liveaboard | Dive Resort |
|--------|-----------|-------------|---------|-------------|------------|-------------|
| **Primary customer** | Identity | Experience | Both | Varies | Identity (exp) | Identity |
| **Main revenue** | Equipment | Dive trips | Mixed | Services | Packages | Packages |
| **Boat operations** | None | Core | Varies | None | Vessel | Boats + shore |
| **Accommodation** | None | None | None | None | Cabins | Rooms |
| **Retail inventory** | Extensive | Minimal | Moderate | None | Minimal | Minimal |
| **Customer relationship** | Long-term | Transactional | Both | Personal | Annual | Repeat guests |
| **Certification model** | Referral | Completion | Full local | Specialty | On-trip | On-site |
| **Seasonality** | Year-round | Tourism | Weather | Demand | Wildlife | Tourism + weather |
| **Software needs** | Retail+CRM | Operations | Everything | Minimal | Maritime | PMS + Dive ops |
| **Overhead** | High | High | High | Low | Very high | Very high |
| **Booking lead time** | Days | Days | Days | Days | Months | Weeks-months |
| **Non-diver friendly** | N/A | Some | Some | No | No | Yes |

---

**Type 4: Independent Operators** (Everywhere)

*"I am the business"*

Not all dive operations have storefronts. A significant segment operates independently:

**Private Instructors**
- Certified to teach independently
- Work out of their vehicle, home, or rented pool time
- May affiliate with shops for equipment/air or operate fully solo
- Flexible scheduling, personalized attention
- Often specialize in specific certifications or student types
- Build reputation through word-of-mouth

**Specialty Instructors**
- Technical diving (trimix, rebreathers, cave, wreck penetration)
- Specific agency specialties (sidemount, freediving, photography)
- Often travel to students or teach at specific sites
- Premium pricing for specialized knowledge
- Small student counts, high touch
- May be the only instructor in a region for certain specialties

**Private Guides**
- Certified divemasters or instructors offering guide services
- Work independently at dive destinations
- Often locals with deep site knowledge
- Offer personalized experiences vs. cattle-boat operations
- May partner with boats but not be employees
- Popular with Identity Divers wanting better experiences

**Mobile Operators**
- Operate from vehicles (trucks, vans)
- Bring equipment to pools, lakes, quarries
- Common in landlocked areas without dedicated shops
- Low overhead, high flexibility
- May teach at corporate events, universities, camps
- Often part-time or seasonal

**Characteristics:**
- Minimal or no fixed location
- Low overhead, high margin potential
- Personal brand is everything
- Flexible but limited scale
- Often work alongside traditional shops
- May receive referrals from shops lacking specific expertise

**Revenue Model:**
- Per-student or per-dive pricing
- No facility costs
- Equipment: owned personal gear, student provides own, or arrangements with shops
- Air fills: arrangements with local shops

**Modern Revenue Opportunities:**
Independent operators can now access retail revenue without inventory burden:
- **Drop shipping**: Sell equipment through distributor partnerships—customer orders, distributor ships direct
- **Print-on-demand merchandise**: Custom branded gear (shirts, hoodies, bags) printed per order
- **Affiliate equipment sales**: Earn commission referring students to retailers
- **Digital products**: Online courses, dive planning tools, site guides
- **Membership models**: Monthly/annual access to guided dives, priority booking

These e-commerce models let independents compete with shops on product offerings while maintaining low overhead.

**Customer Acquisition:**
- Word of mouth (primary)
- Social media presence
- Shop referrals for specialties
- Online instructor directories
- Dive club connections

**Software Needs:**
- Simple scheduling and booking
- Student records and certification tracking
- Basic invoicing
- Customer communication
- Mobile-first (no office computer)
- Minimal overhead matches minimal software

---

**Type 5: Liveaboards** (Remote destinations worldwide)

*"The dive site is home for the week"*

Liveaboards are vessels where divers live aboard for multi-day dive trips, accessing remote sites impossible to reach on day boats.

**Characteristics:**
- Vessels ranging from 60-foot boats to small cruise ships
- Multi-day trips (3-14 nights typical)
- Access to remote, pristine dive sites
- All-inclusive: accommodation, meals, diving, equipment
- Premium pricing ($200-800+/night)
- Limited capacity (8-30 divers typically)

**Destinations:**
- Galápagos, Cocos Island, Socorro (Pacific)
- Red Sea (Egypt, Sudan)
- Maldives, Thailand (Similan Islands)
- Great Barrier Reef (Australia)
- Bahamas (shark diving)
- Indonesia (Raja Ampat, Komodo)
- Palau, Truk Lagoon (Micronesia)

**Primary Revenue:**
1. **Trip packages** (accommodation + diving + meals)
2. **Equipment rental** (full gear for travelers)
3. **Nitrox/tech gas** upgrades
4. **Courses** (Advanced, specialties during trip)
5. **Merchandise** (ship-branded gear)
6. **Bar/extras** (alcohol, snacks, tips)

**Customer Profile:**
- Almost exclusively **Identity Divers**
- Experienced (100+ dives typical minimum)
- Higher income (premium pricing)
- Destination-focused (bucket list sites)
- Plan far in advance (6-18 months)
- Often repeat customers (annual trips)
- International travelers

**Operational Complexity:**

Liveaboards combine hospitality with dive operations with maritime:

*Hospitality:*
- Cabin assignments and management
- Meal planning and dietary requirements
- Guest services and comfort
- Crew quarters and scheduling

*Dive Operations:*
- 3-5 dives per day
- Equipment storage and management
- Dive briefings and planning
- Nitrox/air production onboard
- Safety and emergency protocols

*Maritime:*
- Navigation and passage planning
- Weather routing
- Port clearances and paperwork
- Vessel maintenance
- Fuel and provisioning
- Coast guard compliance
- International maritime law

**Booking Model:**
- Long lead times (months to over a year)
- Significant deposits (25-50% at booking)
- Balance due 60-90 days before departure
- Strict cancellation policies
- Often sold through agents/brokers
- Group/charter bookings common

**Seasonality:**
- Follows weather and marine life patterns
- Manta season, whale shark season, etc.
- May relocate vessel seasonally
- Maintenance periods during off-season

**Software Needs:**
- Long-term booking and deposit management
- Cabin inventory and assignment
- Dietary and special requirements tracking
- Trip manifests with flight details
- Multi-currency pricing (international guests)
- Agent/broker commission tracking
- Itinerary management (multi-stop trips)
- Vessel maintenance scheduling
- Crew scheduling and certification
- Guest certification verification
- Integration with booking agents/OTAs
- Post-trip follow-up and rebooking

**Unique Challenges:**
- Connectivity: Limited internet at sea
- Payments: Processing in remote locations
- Emergencies: Evacuation planning from remote sites
- Logistics: Provisioning in remote ports
- Regulations: Multiple country compliance
- Weather: Route flexibility requirements

---

**Type 6: Dive Resorts** (Prime diving destinations)

*"Come for the diving, stay for the experience"*

Dive resorts are land-based accommodations where diving is the primary draw—purpose-built or optimized for divers.

**Examples:**
- Wakatobi (Indonesia)
- Buddy Dive (Bonaire)
- Anthony's Key (Honduras)
- Little Cayman Beach Resort
- Red Sea resort hotels
- Maldives dive resorts
- Belize dive lodges

**What Makes Them Different from Hotels with Dive Shops:**

A resort with a dive operation ≠ A dive resort

**Dive Resort** (diving is the reason):
- Guests choose it FOR the diving
- Dive operation is core, not amenity
- Packages are dive-inclusive
- Staff understands divers
- Schedules built around diving
- Rinse tanks, camera rooms, gear storage
- Nitrox standard or included
- Shore diving access 24/7

**Hotel with Dive Shop** (diving is an option):
- Guests may or may not dive
- Dive shop is a concession/vendor
- Diving is add-on cost
- General hospitality staff
- Limited dive scheduling
- Basic diver facilities
- Caters to Experience Divers

**Characteristics:**
- Land-based accommodation (rooms, bungalows, villas)
- Dedicated dive operation (boats, shore access, or both)
- Purpose-built diver facilities
- All-inclusive or dive-inclusive packages
- Restaurant/bar focused on diver schedules
- Often in remote locations (limited alternatives)
- Mix of boat and unlimited shore diving

**Primary Revenue:**
1. **Accommodation packages** (room + diving + meals)
2. **Dive packages** (X dives per day included)
3. **Extra dives** (beyond package)
4. **Courses** (certifications, specialties)
5. **Equipment rental**
6. **Nitrox/tech gas**
7. **Spa/wellness** (common add-on)
8. **Non-diver activities** (for traveling companions)
9. **Bar and extras**

**Customer Profile:**
- Primarily **Identity Divers**
- Range from newly certified to experienced
- Often couples (one diver, one non-diver) or dive buddies
- 1-2 week stays typical
- Mix of repeat guests and new visitors
- International travelers
- Plan months in advance

**Operational Complexity:**

Dive resorts run three businesses simultaneously:

*Hospitality Operations:*
- Room inventory and housekeeping
- Restaurant and meal service
- Front desk and guest services
- Grounds and facilities maintenance
- Pool, spa, activities
- Airport transfers

*Dive Operations:*
- Daily boat trips (multiple per day)
- Unlimited shore diving (24/7)
- Equipment room and rentals
- Compressor and gas fills
- Dive briefings and guides
- Courses and instruction
- Underwater photography services

*Resort Management:*
- Package pricing and yield management
- Staff housing and scheduling
- Provisioning in remote locations
- Generator/utilities (often off-grid)
- Environmental compliance (reef protection)
- Local community relations

**The "Unlimited Shore Diving" Model:**

Many dive resorts offer unlimited shore diving—guests can dive the house reef anytime, day or night, as often as they want:
- House reef accessible from property
- Tanks staged and filled continuously
- Buddy system (no guide required for certified)
- Night diving with flashlights
- Attracts serious divers who want maximum bottom time
- Differentiator from day-trip operators

**Booking Model:**
- Package-based (3-night, 7-night, 10-night)
- Deposit at booking (25-50%)
- Balance due before arrival
- Often include airport transfers
- Group rates for dive clubs
- Repeat guest loyalty programs
- Travel agent/wholesaler relationships

**Software Needs:**
- Full property management system (PMS)
- Room inventory and assignment
- Package configuration and pricing
- Dive operation scheduling
- Guest certification tracking
- Equipment rental management
- Restaurant/bar POS
- Housekeeping management
- Airport transfer scheduling
- Multi-department coordination
- Repeat guest recognition
- Travel agent commission tracking
- All-inclusive tracking (what's included vs. extra)

**Unique Challenges:**
- Coordinating dive and non-dive guests
- Managing unlimited shore diving (tank logistics)
- Diver vs. non-diver meal timing
- Remote location provisioning
- Staff recruitment and housing
- Seasonal occupancy swings
- Weather affecting both diving and flights
- Environmental sustainability

---

**Comparison: Liveaboard vs. Dive Resort**

| Aspect | Liveaboard | Dive Resort |
|--------|------------|-------------|
| **Accommodation** | Cabins on vessel | Rooms on land |
| **Mobility** | Travels to sites | Sites come to you (or boats) |
| **Flexibility** | Captain decides | Guest decides (shore diving) |
| **Privacy** | Limited (shared spaces) | More (private rooms) |
| **Non-divers** | Not practical | Welcome (activities available) |
| **Shore diving** | No | Often unlimited |
| **Trip length** | Fixed itinerary | Flexible stay length |
| **Booking** | Set departure dates | Any arrival date |
| **Price** | Higher per-night | Lower per-night, longer stays |
| **Sites accessible** | Remote, varied | Local to resort |

**The Choice:**
- **Liveaboard**: Maximum site variety, serious diving focus, no non-divers
- **Dive Resort**: More comfort, unlimited shore diving, non-diver friendly, flexibility

---

### 1.2.7 Expanding Services: The Concierge Model

Any dive operator—even independents working from a truck—can offer resort-like services by becoming a **dive concierge**: coordinating the complete diving experience, not just the underwater part.

**The Core Insight:**

Divers (especially traveling Identity Divers) want:
- Seamless logistics
- Local expertise
- One point of contact
- Someone who "handles everything"

You don't need to own a resort to provide this. You need systems and partnerships.

**Services Any Operator Can Offer:**

**1. Airport Transfers**
- Partner with reliable taxi/shuttle services
- Negotiate rates for your customers
- Coordinate pickup times with flight schedules
- Provide driver contact and instructions
- Handle delays and changes

*Implementation:*
- Build relationships with 2-3 drivers/services
- Collect flight details at booking
- Send automated pickup confirmations
- Include transfer cost in packages or as add-on
- Software tracks arrival times and driver assignments

**2. Accommodation Coordination**
- Partner with local hotels, Airbnbs, guesthouses
- Negotiate diver-friendly rates
- Recommend properties near your operation
- Coordinate early check-in for morning dives
- Arrange late checkout for afternoon flights

*Implementation:*
- Referral agreements with properties
- Package deals (accommodation + diving)
- Commission arrangements
- Guest preference tracking

**3. Site Transportation (Cenotes, Remote Sites)**
- Arrange transport to sites not on your boat route
- Cenote diving in Mexico's Riviera Maya
- Lake/quarry trips for landlocked shops
- Multi-site day trips
- Private guide + transport packages

*Example: Cenote Operations*
```
Customer books "Cenote Day" package:
- Hotel pickup 7:00 AM
- Transport to Cenote Dos Ojos
- Two guided cenote dives
- Surface interval at cenote park
- Lunch at local restaurant
- Transport to second cenote
- Two more dives
- Return to hotel by 5:00 PM

You coordinate:
- Vehicle and driver
- Cenote entrance fees
- Guide (you or contractor)
- Equipment transport
- Lunch reservations
- Timing and logistics
```

**4. Equipment Logistics**
- Arrange gear delivery to accommodations
- Set up gear at sites before customers arrive
- Handle tank fills and transport
- Offer "dive ready" service (everything handled)

**5. Multi-Day Itineraries**
- Plan complete dive vacations
- Mix of boat diving, shore diving, cenotes, etc.
- Restaurant recommendations and reservations
- Non-diving activities for rest days
- Excursions for non-diving companions

**6. Group Coordination**
- Manage dive club trips
- Coordinate multiple accommodations
- Arrange group dinners
- Handle diverse skill levels
- Private boat charters

**The Partnership Model:**

Independent operators and small shops can create a virtual resort through partnerships:

```
┌─────────────────────────────────────────────────────┐
│           YOUR DIVE OPERATION (Hub)                 │
│                                                     │
│  • Booking & coordination                           │
│  • Dive instruction & guiding                       │
│  • Customer relationship                            │
│  • Quality control                                  │
└───────────────────────┬─────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        │               │               │
        ▼               ▼               ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────┐
│  TRANSPORT    │ │ ACCOMMODATION │ │   SERVICES    │
│  PARTNERS     │ │   PARTNERS    │ │   PARTNERS    │
│               │ │               │ │               │
│ • Airport     │ │ • Hotels      │ │ • Restaurants │
│ • Cenotes     │ │ • Airbnbs     │ │ • Spa/massage │
│ • Site access │ │ • Hostels     │ │ • Tours       │
│ • Boats       │ │ • Resorts     │ │ • Rentals     │
└───────────────┘ └───────────────┘ └───────────────┘
```

**Revenue Opportunities:**

1. **Markup on services**: Add 15-25% to partner services
2. **Package pricing**: Bundle for perceived value
3. **Referral commissions**: Earn from accommodations, transport, activities
4. **Convenience premium**: Charge for "handling everything"
5. **Group rates**: Negotiate bulk then sell individual

---

**Commission Tracking: The Hidden Revenue Stream**

Commissions are often overlooked but can represent 10-20% of a dive operation's revenue:

**Where Commissions Come From:**

| Partner Type | Typical Commission | How It Works |
|--------------|-------------------|--------------|
| Hotels/Resorts | 10-20% | Per night referred |
| Liveaboards | 10-15% | Per booking |
| Dive Resorts | 10-15% | Per package |
| Transport/Taxi | 10-20% | Per trip |
| Restaurants | 5-15% | Per party referred |
| Equipment retailers | 5-15% | Per sale |
| Travel insurance | 20-40% | Per policy |
| Certification agencies | Varies | Per student |
| Activity tours | 10-20% | Per booking |

**Example: Landlocked Shop Commission Revenue**

A Midwest dive shop refers customers to diving destinations:

```
Annual Referral Volume:
- 50 customers → Cozumel dive operators: 50 × $500 × 10% = $2,500
- 20 customers → Caribbean liveaboards: 20 × $3,000 × 12% = $7,200
- 30 customers → Dive resorts: 30 × $2,000 × 15% = $9,000
- 100 customers → Travel insurance: 100 × $150 × 30% = $4,500

Total Commission Revenue: $23,200/year
```

This is revenue for work you're already doing—helping your customers plan trips.

**Example: Destination Operator Commission Revenue**

A Cozumel dive operator partners locally:

```
Annual Referral Volume:
- Airport transfers: 500 × $40 × 15% = $3,000
- Hotel bookings: 200 nights × $80 × 15% = $2,400
- Restaurant referrals: 300 × $50 × 10% = $1,500
- Rental cars: 50 × $200 × 10% = $1,000
- Snorkel tours (non-diving companions): 100 × $60 × 15% = $900

Total Commission Revenue: $8,800/year
```

**Software Requirements for Commission Tracking:**

Essential tracking:
- **Partner registry**: Who pays commissions, at what rate
- **Referral logging**: Which customers referred to which partners
- **Status tracking**: Referred → Booked → Completed → Commission Due → Paid
- **Commission calculation**: Automatic based on partner rates
- **Aging/receivables**: Track what's owed and how long
- **Reconciliation**: Match partner payments to referrals
- **Reporting**: Revenue by partner, by period, by customer

**Commission Tracking Data Model:**

```
Partner
├── name
├── type (hotel, transport, liveaboard, etc.)
├── commission_rate (percentage)
├── payment_terms (monthly, per-booking, etc.)
├── contact_info
└── is_active

Referral
├── partner_id
├── customer_id
├── referred_at
├── service_date
├── service_amount (what customer paid)
├── commission_amount (calculated)
├── status (pending, confirmed, paid)
├── notes
└── paid_at

Commission Payment
├── partner_id
├── payment_date
├── amount
├── period_covered
├── referrals (list of referral_ids)
└── notes
```

**Operational Best Practices:**

1. **Document everything**: Written agreements with commission rates
2. **Track immediately**: Log referral at time of booking
3. **Follow up**: Confirm booking happened with partner
4. **Reconcile monthly**: Don't let commissions slip through
5. **Invoice proactively**: Don't wait for partners to pay
6. **Review annually**: Negotiate better rates as volume grows

**Commission Payment Models:**

- **Per-transaction**: Partner pays after each referral completes
- **Monthly batch**: Accumulated commissions paid monthly
- **Net rates**: You pay partner net, keep difference (common with transport)
- **Reciprocal**: You refer to them, they refer to you (no cash exchanges)

**Risks and Challenges:**

- Partners "forgetting" referrals (track independently)
- Commission disputes (document everything)
- Slow payment (clear terms, follow up)
- Rate changes (written agreements)
- Partner goes out of business (diversify)

**The Ecosystem Opportunity:**

Every type of dive operation can earn commissions:

| Operation Type | Commission Opportunities |
|----------------|--------------------------|
| **Landlocked** | Liveaboards, resorts, destination operators, travel insurance |
| **Destination** | Hotels, transport, restaurants, activities |
| **Coastal** | All of the above |
| **Independent** | Shops (for air fills), transport, accommodations |
| **Liveaboard** | Pre/post-trip hotels, travel insurance |
| **Dive Resort** | Activities, spa, transport, car rentals |

**The Key Insight:**

Commission revenue is:
- **Passive** (once relationship is established)
- **Recurring** (ongoing referrals)
- **High margin** (no cost to you)
- **Relationship building** (strengthens partner network)

Track it systematically and it grows. Ignore it and you leave money on the table.

---

**Paying Commissions: The Other Side**

Just as you earn commissions for referrals out, you pay commissions for referrals in. This is a legitimate customer acquisition cost.

**Who Sends You Customers:**

| Referrer Type | Why They Refer | Typical Commission |
|---------------|----------------|-------------------|
| Hotels/Resorts | Guest asks "where to dive?" | 10-20% |
| Tour operators | Package inclusions | 15-25% |
| Travel agents | Booking dive components | 10-15% |
| Cruise ships | Shore excursions | 20-40% |
| Other dive shops | Referral completions | 10-15% |
| Concierge services | Guest requests | 15-20% |
| Online booking platforms | Lead generation | 15-30% |
| Taxi drivers | "Best dive shop" recommendations | $5-20 per head |
| Timeshare presentations | Activity bookings | 20-30% |

**Example: Destination Operator Commission Expense**

A Cozumel dive operator receives referrals:

```
Annual Referral Sources:
- Hotel concierge referrals: 200 customers × $150 × 15% = $4,500
- Cruise ship excursions: 100 customers × $120 × 30% = $3,600
- Online booking platform: 150 customers × $140 × 20% = $4,200
- Travel agent bookings: 50 customers × $200 × 12% = $1,200
- Local taxi network: 100 customers × $10 = $1,000

Total Commission Expense: $14,500/year
```

**Is It Worth It?**

Calculate your effective customer acquisition cost:

```
Commission paid: $4,500 to hotels
Customers acquired: 200
Average revenue per customer: $150
Cost per acquisition: $22.50 (15%)

Compare to:
- Google Ads: $30-50 per booking
- Walk-in rate without referrals: ???
- Lifetime value of customer acquired: ???
```

Often, commission-based referrals are your most cost-effective customer acquisition.

**Managing Outbound Commissions:**

**Track Every Referral Source:**
```
Booking
├── customer_id
├── booking_date
├── total_amount
├── referral_source (hotel, cruise, walk-in, etc.)
├── referrer_id (specific partner)
├── commission_rate
├── commission_amount
├── commission_paid_at
└── notes
```

**Referrer Types:**

1. **Contracted Partners** (hotels, agents)
   - Written agreements with rates
   - Monthly reconciliation and payment
   - Track by partner, not just category

2. **Platform Referrals** (OTAs, booking sites)
   - Automatic commission deduction
   - Or monthly invoice
   - Usually higher rates for convenience

3. **Informal Referrals** (taxi drivers, timeshares)
   - Cash payments often
   - Still worth tracking
   - May be per-head not percentage

4. **Reciprocal Agreements**
   - You refer to them, they refer to you
   - Track both directions
   - Ensure fairness over time

**Software for Commission Payables:**

- **Referral source on every booking** (required field)
- **Partner rate lookup** (automatic calculation)
- **Payables aging** (what you owe, to whom)
- **Payment tracking** (when paid, how much)
- **Profitability by channel** (revenue minus commission)
- **Partner statements** (send to partners for verification)

**Commission Payable Data Model:**

```
ReferralPartner
├── name
├── type (hotel, cruise, agent, etc.)
├── commission_rate
├── payment_method (check, transfer, cash)
├── payment_frequency (per-booking, monthly)
├── contact_info
├── is_active
└── notes

BookingReferral
├── booking_id
├── partner_id
├── referral_date
├── booking_amount
├── commission_amount
├── status (pending, paid)
├── paid_at
├── payment_reference
└── notes
```

**Best Practices:**

1. **Attribute every booking**: Where did this customer come from?
2. **Pay promptly**: Keeps referral partners happy and sending more
3. **Track walk-ins separately**: Know your organic rate
4. **Negotiate rates**: Volume should earn better terms
5. **Audit periodically**: Are you paying for false referrals?
6. **Build relationships**: Partners send more to operators they like

**The Complete Commission Picture:**

| Flow | Example | Track As |
|------|---------|----------|
| **You → Partner → Customer** | You refer to hotel | Commission receivable |
| **Partner → You → Customer** | Hotel refers to you | Commission payable |
| **You → Customer → Partner** | Customer books partner after you | Possible commission |
| **Platform → You → Customer** | OTA booking | Platform fee/commission |

**Net Commission Position:**

Track both sides to understand your true position:

```
Monthly Commission Summary:
─────────────────────────────────
Commissions Earned (Receivables)
  Hotels referred: $450
  Transport: $180
  Insurance: $320
  Total Earned: $950

Commissions Owed (Payables)
  Hotel referrals: $680
  Cruise ships: $420
  OTA fees: $290
  Total Owed: $1,390

Net Position: -$440
─────────────────────────────────
```

A negative net position isn't bad—it means you're receiving more referrals than sending. The question is whether those referrals are profitable after commission.

**Channel Profitability Analysis:**

```
Revenue by Channel     Gross    Commission   Net      Margin
─────────────────────────────────────────────────────────────
Walk-in/Direct        $8,000      $0       $8,000    100%
Hotel referrals       $4,500      $675     $3,825    85%
Cruise excursions     $3,600      $1,080   $2,520    70%
Online platforms      $2,800      $560     $2,240    80%
Travel agents         $1,200      $144     $1,056    88%
─────────────────────────────────────────────────────────────
Total                $20,100     $2,459   $17,641    88%
```

This analysis helps you decide:
- Which channels to invest in
- Which commissions to negotiate
- Where to focus marketing for direct bookings
- Acceptable commission rates for new partners

---

**Marketing Attribution: Know What's Working**

Beyond partner referrals, track the effectiveness of your own marketing spend.

**The Problem:**

You run ads in dive magazines, post on social media, sponsor events, distribute flyers at hotels. But which actually brings customers?

Without tracking, you're guessing. With tracking, you know exactly what works.

**Attribution Methods:**

**1. Unique Phone Numbers**

Use different phone numbers for different campaigns:

```
Main business line: (555) 123-4567
Magazine ad: (555) 123-4568
Google Ads: (555) 123-4569
Hotel flyers: (555) 123-4570
Facebook: (555) 123-4571
```

Services like CallRail, Grasshopper, or Google Voice let you:
- Get multiple numbers cheaply ($5-15/month each)
- Forward all to your main line
- Track call volume by number
- Record calls for training
- See call duration and outcomes

**2. Unique URLs / Landing Pages**

Create trackable URLs for each campaign:

```
Website: www.yourdiveshop.com
Magazine ad: www.yourdiveshop.com/scubamagazine
Google Ads: www.yourdiveshop.com/google
Facebook: www.yourdiveshop.com/fb
Email campaign: www.yourdiveshop.com/summer2024
```

Or use UTM parameters:
```
www.yourdiveshop.com?utm_source=scubamagazine&utm_campaign=winter2024
```

Google Analytics tracks:
- Which URLs get traffic
- Conversion rates by source
- Time on site, pages viewed
- Booking completion rates

**3. QR Codes**

Modern print advertising should include QR codes:

```
Magazine Ad:
┌─────────────────────────────────┐
│                                 │
│   DIVE WITH US IN COZUMEL       │
│                                 │
│   [Beautiful underwater photo]  │
│                                 │
│   Scan to book:                 │
│   ┌─────────┐                   │
│   │ QR CODE │  Special offer    │
│   │         │  for readers!     │
│   └─────────┘                   │
│                                 │
│   Or call: (555) 123-4568       │
│   yourdiveshop.com/scubamagazine│
│                                 │
└─────────────────────────────────┘
```

Each QR code links to a unique URL, tracking:
- Scan count
- Location (if permissions granted)
- Time of scan
- Resulting bookings

Free QR generators: qr-code-generator.com, Canva
Tracking QR services: Bitly, QR Code Generator Pro

**4. Promo Codes**

Give each marketing channel a unique promo code:

```
Magazine ad: SCUBAMAG24 (10% off)
Facebook: FBDIVE (free Nitrox)
Email list: VIP2024 ($20 off)
Hotel flyer: HOTELSPECIAL (free photos)
```

When customer uses code:
- You know where they came from
- They feel special (discount)
- Easy to track in any booking system

**5. "How Did You Hear About Us?"**

Simple but effective—ask at booking:

```
Booking Form:
...
How did you hear about us?
[ ] Google search
[ ] Magazine ad (which one? _______)
[ ] Social media (which? _______)
[ ] Friend/family referral
[ ] Hotel recommendation
[ ] Walk-by / saw your shop
[ ] Repeat customer
[ ] Other: _______________
```

**Combining Methods:**

Use multiple attribution methods together:

```
Magazine Ad Campaign:
- Unique phone: (555) 123-4568
- Unique URL: /scubamagazine
- QR code: links to /scubamagazine
- Promo code: SCUBAMAG24
- "How heard" option: Magazine ad
```

Cross-reference for accuracy. If someone calls the magazine number and uses the promo code, you're confident about attribution.

**Marketing Attribution Data Model:**

```
MarketingChannel
├── name (Magazine - Scuba Diving, Google Ads, etc.)
├── type (print, digital, social, event, partner)
├── tracking_phone
├── tracking_url
├── promo_code
├── cost_per_period
├── active_from / active_to
└── notes

MarketingAttribution
├── booking_id
├── channel_id
├── attribution_method (phone, url, promo, self-reported)
├── confidence (high, medium, low)
├── promo_code_used
├── landing_page
└── notes
```

**Calculating Marketing ROI:**

```
Channel: Scuba Magazine Ad (Q1 2024)
─────────────────────────────────────
Ad cost: $2,500

Attributed bookings: 35
Revenue from bookings: $5,250
Average booking value: $150

ROI = (Revenue - Cost) / Cost
ROI = ($5,250 - $2,500) / $2,500 = 110%

Cost per acquisition: $2,500 / 35 = $71.43
─────────────────────────────────────
```

Compare across channels:

```
Channel              Cost    Bookings  Revenue   CPA      ROI
──────────────────────────────────────────────────────────────
Scuba Magazine      $2,500      35     $5,250   $71.43   110%
Google Ads          $1,200      28     $4,200   $42.86   250%
Facebook Ads          $800      15     $2,250   $53.33   181%
Hotel flyers          $150      12     $1,800   $12.50   1100%
Email marketing        $50      22     $3,300   $2.27    6500%
──────────────────────────────────────────────────────────────
```

This shows:
- Email has best ROI (existing customers, low cost)
- Hotel flyers are incredibly efficient
- Magazine has lowest ROI but may build brand awareness
- Google Ads provides good volume at reasonable cost

**Software Integration:**

Your booking system should:
- Capture attribution source on every booking
- Support multiple tracking codes/URLs
- Calculate channel ROI automatically
- Report trends over time
- Integrate with Google Analytics
- Support A/B testing of campaigns

**Multi-Touch Attribution:**

Reality: customers often interact multiple times before booking:
1. See magazine ad (awareness)
2. Google search your name (research)
3. Check Facebook reviews (validation)
4. Click email offer (trigger)
5. Book

Who gets credit?

Models:
- **First touch**: Magazine ad (started the journey)
- **Last touch**: Email (final trigger)
- **Linear**: Equal credit to all
- **Time decay**: More credit to recent touches

For most dive shops, track first and last touch, don't overcomplicate it.

**Practical Tips:**

1. **Start simple**: Ask "how did you hear about us?" on every booking
2. **Add phone tracking**: Cheap, easy, valuable data
3. **Use promo codes**: Customers like discounts, you get data
4. **Review monthly**: Check what's working, cut what isn't
5. **Test and iterate**: Try new channels, measure, adjust
6. **Track offline too**: Events, word-of-mouth, walk-ins all count

---

### 1.2.8 Equipment: Sales, Rentals, and Service

Equipment is a major component of dive shop economics—whether selling, renting, or servicing it.

---

**Equipment Sales (Retail)**

For landlocked and coastal shops, retail equipment sales can be 40-60% of revenue.

**Inventory Categories:**

| Category | Examples | Margin | Turnover |
|----------|----------|--------|----------|
| **Life Support** | Regulators, BCDs | 30-40% | Low |
| **Exposure** | Wetsuits, drysuits | 35-45% | Medium |
| **Accessories** | Masks, fins, snorkels | 40-50% | High |
| **Instruments** | Computers, gauges | 25-35% | Low |
| **Cylinders** | Tanks, valves | 20-30% | Low |
| **Lights** | Primary, backup | 35-45% | Medium |
| **Photo/Video** | Housings, cameras | 20-30% | Low |
| **Soft Goods** | Bags, apparel, books | 45-55% | High |

**Inventory Management Challenges:**

1. **Sizing complexity**: Wetsuits in 15+ sizes, fins in multiple sizes
2. **Color/style variants**: Same item in multiple configurations
3. **Seasonal demand**: Wetsuit thickness varies by season
4. **Long tail**: Many SKUs with slow turnover
5. **Manufacturer minimums**: Must order in quantities
6. **Demo/display units**: Track separately from sellable stock
7. **Special orders**: Customer-specific items

**Sales Tracking Requirements:**

```
Product
├── sku
├── name
├── brand
├── category
├── variants (size, color)
├── cost
├── retail_price
├── current_stock
├── reorder_point
├── supplier_id
└── is_active

InventoryTransaction
├── product_id
├── transaction_type (purchase, sale, adjustment, transfer)
├── quantity
├── unit_cost
├── date
├── reference (PO#, invoice#)
├── location (if multi-location)
└── notes

Sale
├── customer_id
├── date
├── items (product, quantity, price, discount)
├── subtotal
├── tax
├── total
├── payment_method
├── salesperson_id
└── notes
```

**Key Retail Metrics:**

- **Inventory turnover**: Sales / Average inventory (higher = better)
- **Gross margin**: (Revenue - COGS) / Revenue
- **Stock-to-sales ratio**: Inventory value / Monthly sales
- **Sell-through rate**: Units sold / Units received
- **Dead stock**: Items with no sales in 12+ months

**Integration with Diving:**

Equipment sales often connect to training:

```
Student completes Open Water course
→ Ready to buy first equipment
→ System prompts: "New diver equipment package"
→ Salesperson knows certification level
→ Recommends appropriate gear
→ Student discount applied
→ Equipment registered to diver profile
```

---

**Equipment Rentals**

For destination operators, rentals are essential—tourists can't bring full gear.

**Rental Inventory Types:**

| Equipment | Rental Rate | Sizing | Maintenance |
|-----------|-------------|--------|-------------|
| **BCD** | $15-25/day | XS-XXL | Annual service |
| **Regulator** | $15-25/day | Universal | Annual service |
| **Wetsuit** | $10-20/day | Many sizes | Replace when worn |
| **Mask** | $5-10/day | Universal | Clean, check strap |
| **Fins** | $5-10/day | S/M/L/XL | Check straps |
| **Computer** | $15-30/day | Universal | Battery, calibration |
| **Weights** | $5-10/day | By weight | Check coating |
| **Cylinder** | Usually included | Standard | VIP/Hydro |
| **Torch** | $10-20/dive | Universal | Battery, seals |
| **SMB** | $5-10/dive | Universal | Check inflation |

**Full Rental Set**: $40-80/day typically

**Rental Tracking Requirements:**

```
RentalItem
├── item_id (unique identifier)
├── equipment_type (BCD, regulator, etc.)
├── brand / model
├── size
├── serial_number (for life support)
├── purchase_date
├── purchase_cost
├── condition (excellent, good, fair, needs service)
├── status (available, rented, maintenance, retired)
├── location
├── last_service_date
├── next_service_due
└── notes

RentalAssignment
├── rental_item_id
├── booking_id
├── customer_id
├── assigned_at
├── returned_at
├── condition_out
├── condition_in
├── damage_notes
├── assigned_by (staff)
└── checked_in_by (staff)

RentalPackage
├── name ("Full Equipment", "Reg + BCD Only")
├── included_items (list of equipment types)
├── daily_rate
├── multi_day_discount
└── is_active
```

**Rental Workflow:**

```
1. BOOKING
   Customer books dive trip
   → Selects rental needs (full set, partial, none)
   → Provides sizes (height, weight, shoe size)
   → Rental added to booking total

2. PRE-TRIP PREPARATION
   Day before trip:
   → System shows rental needs for tomorrow
   → Staff pulls equipment by size
   → Stages gear with customer name
   → Checks condition before assignment

3. CHECK-IN
   Customer arrives:
   → Verify sizes, adjust if needed
   → Assign specific items (serial numbers logged)
   → Customer signs rental agreement
   → Note any pre-existing damage

4. DURING DIVING
   → Equipment tracked to customer
   → If issue, swap and log
   → Monitor for problems

5. RETURN
   Customer returns equipment:
   → Check condition against checkout
   → Note any damage
   → Log return time
   → Mark items for cleaning/service

6. POST-RENTAL
   → Clean and sanitize
   → Inspect for wear/damage
   → Service if needed
   → Return to available inventory
```

**Rental Pricing Models:**

1. **Per-day rental**: Simple, common
2. **Per-dive rental**: For single-dive experiences
3. **Package pricing**: Full set discount vs. à la carte
4. **Multi-day discounts**: Day 1 full price, days 2+ discounted
5. **Weekly rates**: Significant discount for week rentals
6. **Inclusive packages**: Diving + all equipment bundled
7. **Own-equipment discount**: Reduce trip price if customer brings gear

**Example Pricing Structure:**

```
RENTAL RATES

Single Items (per day):
- BCD: $20
- Regulator: $20
- Wetsuit: $15
- Mask/Fins/Snorkel: $10
- Computer: $25

Packages (per day):
- Full Equipment: $65 (save $25)
- Reg + BCD: $35 (save $5)
- Exposure Package (wetsuit + mask/fins): $20 (save $5)

Multi-Day Discounts:
- 2-3 days: 10% off
- 4-6 days: 15% off
- 7+ days: 20% off

Example: Full equipment for 5 days
$65 × 5 = $325 × 0.85 = $276.25
```

**Rental Challenges:**

1. **Size availability**: Popular sizes run out
   - Track demand patterns
   - Stock more medium sizes
   - Have adjustment options (weight pockets, etc.)

2. **Condition tracking**: Wear isn't visible until failure
   - Inspect after every use
   - Rotate stock evenly
   - Retire before failure

3. **Lost/damaged equipment**: Customers lose or break items
   - Clear damage policies
   - Credit card hold or deposit
   - Insurance offerings

4. **Peak demand**: Everyone needs gear on busy days
   - Forecast based on bookings
   - Rent from partner shops if needed
   - Overbooking buffer

5. **Cleaning/turnaround**: Gear needs prep between users
   - Schedule cleaning time
   - Have backup sets ready
   - Sanitization standards (post-COVID essential)

---

**Equipment Service Department**

Life support equipment requires regular professional service.

**Service Types:**

| Service | Frequency | Price Range | Time |
|---------|-----------|-------------|------|
| **Regulator annual** | Yearly | $80-150 | 1-2 weeks |
| **BCD annual** | Yearly | $50-80 | 1-2 weeks |
| **Computer battery** | 1-3 years | $30-80 | Same day - 1 week |
| **Cylinder VIP** | Annual | $20-35 | Same day |
| **Cylinder hydro** | 5 years | $35-50 | 1-2 weeks |
| **Drysuit repair** | As needed | $50-200+ | 1-3 weeks |
| **Wetsuit repair** | As needed | $20-75 | 1-2 weeks |

**Service Tracking:**

```
ServiceTicket
├── ticket_number
├── customer_id
├── equipment_type
├── brand / model
├── serial_number
├── service_type (annual, repair, warranty)
├── received_date
├── technician_id
├── status (received, in progress, complete, picked up)
├── parts_used
├── labor_hours
├── parts_cost
├── labor_cost
├── total_price
├── notes
├── completed_date
├── picked_up_date
└── next_service_due

ServiceHistory (linked to equipment or customer)
├── equipment_identifier
├── service_date
├── service_type
├── technician
├── parts_replaced
├── notes
└── next_service_due
```

**Service Workflow:**

```
1. INTAKE
   Customer brings equipment:
   → Create service ticket
   → Document condition and issues
   → Photograph if needed
   → Estimate cost and time
   → Customer signs authorization
   → Provide claim ticket

2. DIAGNOSIS (if repair)
   Technician examines:
   → Identify problem
   → Determine parts needed
   → Update estimate if different
   → Contact customer if significant change

3. SERVICE/REPAIR
   Technician performs work:
   → Log parts used
   → Log labor time
   → Document work performed
   → Test equipment
   → Update service history

4. QUALITY CHECK
   Second check:
   → Verify work complete
   → Test functionality
   → Clean equipment
   → Apply service sticker/date

5. NOTIFICATION
   → Contact customer (text, email, call)
   → Equipment ready for pickup
   → Provide invoice

6. PICKUP
   Customer retrieves:
   → Review work performed
   → Payment collected
   → Next service date noted
   → Service documentation provided
```

**Parts Inventory:**

Service departments need parts inventory:

```
Part
├── part_number
├── description
├── fits_equipment (brand, model, component)
├── cost
├── retail_price
├── quantity_on_hand
├── reorder_point
├── supplier
└── location

PartsUsage
├── service_ticket_id
├── part_id
├── quantity
├── unit_price
└── notes
```

**Service Revenue Potential:**

```
Annual Service Revenue Estimate (small shop):

Regular customers with own equipment: 200 divers

Regulator annuals: 150 × $100 = $15,000
BCD annuals: 100 × $60 = $6,000
Computer batteries: 50 × $50 = $2,500
Cylinder VIP: 200 × $25 = $5,000
Cylinder hydro: 40 × $45 = $1,800
Miscellaneous repairs: $3,000

Total Service Revenue: $33,300
(at ~60% margin = $20,000 gross profit)
```

---

**Tracking Equipment Across the Business**

Equipment touches multiple areas—sales, rentals, service, and operations.

**Serial Number Tracking:**

Life support equipment should be tracked by serial number:

```
Equipment (owned inventory)
├── serial_number (primary key for life support)
├── type (regulator, BCD, computer)
├── brand
├── model
├── purchase_date
├── warranty_expiration
├── status (inventory, rental_fleet, demo, sold)
├── service_history (list)
├── rental_history (list)
└── current_owner (customer_id if sold)
```

This enables:
- **Service reminders**: "Your regulator is due for annual service"
- **Warranty tracking**: Know if repair is covered
- **Recall handling**: Contact owners of affected equipment
- **Rental accountability**: Know exact item customer used
- **History on resale**: Service records transfer with equipment

**Customer Equipment Registry:**

Track what equipment customers own:

```
CustomerEquipment
├── customer_id
├── equipment_type
├── brand / model
├── serial_number
├── purchase_date
├── purchased_from (your shop or elsewhere)
├── last_service_date
├── next_service_due
├── notes
└── is_active

Benefits:
- Service reminders (revenue!)
- Appropriate rental offerings (don't rent what they own)
- Upgrade recommendations
- Trade-in valuations
- Warranty claims support
```

**Equipment Integration Points:**

```
┌─────────────────────────────────────────────────────────────────┐
│                     EQUIPMENT ECOSYSTEM                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  RETAIL          RENTAL           SERVICE         CUSTOMER      │
│  ────────        ──────           ───────         ────────      │
│  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐   │
│  │ Product │     │ Rental  │     │ Service │     │ My Gear │   │
│  │Inventory│     │ Fleet   │     │ Queue   │     │Registry │   │
│  └────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘   │
│       │               │               │               │         │
│       └───────────────┴───────────────┴───────────────┘         │
│                           │                                     │
│                    ┌──────┴──────┐                              │
│                    │   Serial    │                              │
│                    │   Number    │                              │
│                    │   Tracking  │                              │
│                    └──────┬──────┘                              │
│                           │                                     │
│       ┌───────────────────┼───────────────────┐                 │
│       │                   │                   │                 │
│       ▼                   ▼                   ▼                 │
│  ┌─────────┐        ┌──────────┐       ┌───────────┐           │
│  │Bookings │        │ Service  │       │ Customer  │           │
│  │(rentals)│        │ History  │       │  Profile  │           │
│  └─────────┘        └──────────┘       └───────────┘           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Reporting Needs:**

Equipment reports help manage the business:

**Rental Reports:**
- Utilization rate by item type (% of days rented)
- Revenue per rental item
- Items needing service
- Size availability forecast
- Damage/loss report

**Retail Reports:**
- Sales by category
- Margin by product
- Inventory aging
- Reorder alerts
- Top sellers

**Service Reports:**
- Tickets by status
- Technician productivity
- Average turnaround time
- Parts usage
- Revenue by service type
- Upcoming service reminders (customer list)

**Example Dashboard Metrics:**

```
EQUIPMENT DASHBOARD - January 2024
──────────────────────────────────────────────
RENTALS
  Rental revenue: $8,450
  Utilization rate: 67%
  Items rented: 1,234 item-days
  Damage incidents: 3
  Items due for service: 12

RETAIL
  Sales revenue: $24,300
  Units sold: 89
  Average margin: 38%
  Low stock alerts: 7 items

SERVICE
  Tickets completed: 45
  Service revenue: $3,850
  Average turnaround: 6.2 days
  Parts revenue: $1,240

REMINDERS TO SEND
  Regulator annuals due: 23 customers
  Computer batteries due: 8 customers
  Cylinder hydros due: 15 customers
──────────────────────────────────────────────
```

---

### 1.2.9 Customer Self-Service and Automation

The biggest efficiency gains in modern dive operations come from letting customers do things themselves—before they arrive.

**The Problem with Traditional Check-In:**

```
Traditional Day-of-Trip Check-In:
─────────────────────────────────────────────────────
6:45 AM  Customer arrives
6:46     Find booking in paper log
6:48     Print liability waiver (3 pages)
6:52     Customer reads waiver, asks questions
7:01     Customer signs waiver
7:02     Print medical questionnaire
7:05     Customer fills out medical form
7:12     Staff reviews medical, asks follow-up questions
7:18     Pull certification card, write down number
7:20     Rental equipment sizing discussion
7:25     Payment processing
7:30     Finally ready to board boat

Elapsed time: 45 minutes PER CUSTOMER
─────────────────────────────────────────────────────
```

Multiply by 12 customers and your boat doesn't leave on time.

**The Self-Service Solution:**

```
Modern Pre-Trip Self-Service:
─────────────────────────────────────────────────────
3 DAYS BEFORE:
  Customer receives email with pre-trip checklist
  → Link to complete online

2 DAYS BEFORE:
  Customer completes (on phone, 10 min total):
  → Digital liability waiver (e-signature)
  → Medical questionnaire (branching logic)
  → Certification upload (photo of card)
  → Rental sizes (height, weight, shoe)
  → Dietary restrictions (if lunch included)
  → Emergency contact
  → Payment (if not already collected)

1 DAY BEFORE:
  Customer receives:
  → Confirmation with meeting point
  → What to bring checklist
  → Pre-dive briefing video link
  → National park orientation (if required)

DAY OF TRIP:
6:55 AM  Customer arrives
6:56     Staff: "Hi [name], you're all checked in!"
6:57     Hand customer staged rental gear
6:58     Board boat

Elapsed time: 3 minutes PER CUSTOMER
─────────────────────────────────────────────────────
```

---

**Digital Waivers and Agreements**

**Why Digital Waivers:**
- Completed before arrival (not eating trip time)
- Legible (no chicken-scratch signatures)
- Searchable (find any waiver instantly)
- Backed up (never lost)
- Legally valid (with proper e-signature)
- Environmentally friendly (no paper)

**Waiver Types:**

| Document | When Used | Validity |
|----------|-----------|----------|
| **Liability Release** | Every customer, every trip | Per-trip or annual |
| **Medical Statement** | Every customer | Per-trip or 12 months |
| **Rental Agreement** | When renting equipment | Per-trip |
| **Photo/Video Release** | If shooting content | Per-trip or permanent |
| **Minor Consent** | Under-18 participants | Per-trip |
| **Training Agreement** | Course students | Per-course |

**Digital Waiver Workflow:**

```
1. TRIGGER
   Booking confirmed
   → System queues waiver for delivery

2. DELIVERY
   Email/SMS sent to customer:
   "Complete your dive paperwork online"
   → Link to secure waiver portal
   → Mobile-optimized

3. CUSTOMER COMPLETES
   Customer opens on phone/computer:
   → Reviews document (scrollable)
   → Checks acknowledgment boxes
   → Types name or draws signature
   → Submits

4. CONFIRMATION
   → Customer receives signed copy (PDF)
   → System marks waiver complete
   → Staff dashboard shows green checkmark

5. STORAGE
   → PDF stored with booking
   → Searchable by name, date, trip
   → Retained per legal requirements (varies by jurisdiction)
```

**Waiver Data Model:**

```
WaiverTemplate
├── name
├── type (liability, medical, rental, photo, minor)
├── version
├── content (HTML/markdown)
├── required_acknowledgments (list of checkboxes)
├── signature_type (typed, drawn, both)
├── validity_period (single_use, 12_months, permanent)
├── is_active
└── effective_date

SignedWaiver
├── waiver_template_id
├── customer_id
├── booking_id (if per-trip)
├── signed_at
├── ip_address
├── device_info
├── signature_image (if drawn)
├── acknowledgments_checked (list)
├── pdf_document (generated signed copy)
├── valid_until
└── superseded_by (if updated)
```

**Legal Considerations:**
- E-signatures are legally binding (ESIGN Act, eIDAS)
- Keep audit trail (timestamp, IP, device)
- Store copies in tamper-evident format
- Consult local attorney for jurisdiction-specific requirements
- Some agencies require specific waiver language

---

**Medical Questionnaires and Health Screeners**

Diving has medical requirements. Digital screeners make this efficient and safe.

**Standard Medical Questionnaire:**

Most training agencies provide standard medical forms (RSTC, PADI, SSI). Key questions:

- Heart conditions
- Respiratory conditions (asthma, pneumothorax)
- Ear/sinus issues
- Neurological conditions (epilepsy, blackouts)
- Diabetes
- Pregnancy
- Recent surgeries
- Current medications
- Psychological conditions
- Substance use

**Branching Logic:**

Digital forms use conditional logic:

```
Question: "Have you ever had asthma?"

If NO → Continue to next question

If YES → Branch to:
  → "When were you last diagnosed?"
  → "Have you had symptoms in past 12 months?"
  → "Do you use rescue inhaler?"
  → "Have you had exercise-induced symptoms?"

  If concerning answers → Flag for physician clearance
  If mild/historical → May proceed with acknowledgment
```

**Medical Screener Outcomes:**

```
GREEN: Clear to dive
  → All questions answered "No"
  → Proceed with diving

YELLOW: Conditional
  → Some "Yes" answers but low risk
  → Staff review recommended
  → May require additional acknowledgment
  → Example: Well-controlled high blood pressure on medication

RED: Requires physician clearance
  → Concerning answers flagged
  → Cannot dive without doctor's note
  → System generates physician form
  → Customer uploads clearance letter

BLOCKED: Cannot dive
  → Absolute contraindications
  → Recent surgery, pregnancy, active symptoms
  → Reschedule required
```

**Medical Form Data Model:**

```
MedicalQuestionnaire
├── customer_id
├── completed_at
├── responses (JSON of all answers)
├── outcome (green, yellow, red, blocked)
├── flags (list of concerning responses)
├── staff_reviewed_by
├── staff_review_notes
├── physician_clearance_required
├── physician_clearance_received
├── clearance_document (uploaded PDF)
├── valid_until
└── superseded_by

MedicalFlag
├── questionnaire_id
├── question_id
├── response_value
├── severity (low, medium, high)
├── auto_action (proceed, review, require_clearance, block)
└── notes
```

**Integration with Booking:**

```
Booking Status Includes:
□ Waiver signed
□ Medical cleared
□ Certification verified
□ Payment complete
□ Rental sizes provided

Customer cannot be marked "ready to dive" until all boxes checked.
```

---

**Pre-Trip Briefings and Training**

Move briefings online to save trip time and improve safety.

**Types of Pre-Briefings:**

**1. Shop/Operation Orientation**
Your custom video covering:
- Where to meet / parking
- What to bring / not bring
- Day schedule overview
- Boat layout and facilities
- Emergency procedures
- Equipment handling expectations
- Tipping and gratuity guidance

**2. Dive Site Briefings**
Site-specific videos:
- Map/layout of dive site
- Typical marine life
- Current patterns
- Entry/exit procedures
- Depth and bottom time expectations
- Photo opportunities
- Hazards and how to avoid them

**3. National Park / Marine Reserve Orientations**
Required by some destinations:
- Rules and regulations
- Protected species
- No-touch policies
- Penalties for violations
- Environmental awareness

**4. Course Prerequisite Content**
For certification students:
- Online learning modules
- Knowledge reviews
- Video demonstrations
- Quiz requirements

**5. Specialty Briefings**
Activity-specific content:
- Night diving procedures
- Drift diving techniques
- Nitrox orientation
- Photography etiquette

**Video Briefing Workflow:**

```
1. CREATION
   Record professional briefing videos:
   → Script key information
   → Keep videos 3-8 minutes
   → Include captions (accessibility, language)
   → Host on YouTube (unlisted) or Vimeo

2. DELIVERY
   After booking confirmation:
   → Email with video links
   → "Watch before your trip"
   → Reminder 24 hours before if not viewed

3. TRACKING
   Track video completion:
   → Embed tracking (Wistia, Vidyard)
   → Or: Quiz after video
   → Or: Checkbox confirmation

4. VERIFICATION
   System records:
   → Video watched (timestamp)
   → Quiz passed (if applicable)
   → Checkbox confirmed

5. DAY-OF BENEFIT
   Boat briefing can focus on:
   → Site-specific conditions TODAY
   → Buddy assignments
   → Questions only
   → Not repeating basics
```

**Video Tracking Data Model:**

```
BriefingVideo
├── title
├── type (orientation, site, park, course, specialty)
├── url
├── duration_seconds
├── required_for (trip types, sites, etc.)
├── has_quiz
├── is_active
└── created_at

VideoCompletion
├── video_id
├── customer_id
├── booking_id
├── started_at
├── completed_at
├── percent_watched
├── quiz_score (if applicable)
├── confirmed_at (checkbox timestamp)
└── ip_address
```

**National Park Integration:**

Some marine parks require completed orientation:
- Great Barrier Reef (Australia)
- Galápagos (Ecuador)
- Various US National Marine Sanctuaries
- Cozumel Marine Park (Mexico)

Options:
- Link to official park video/quiz
- Embed park requirements in your system
- Track completion before allowing booking confirmation

---

**Certification Verification**

Let customers upload their credentials digitally.

**What to Collect:**

```
Certification Upload:
├── Photo of front of cert card
├── Photo of back of cert card (if different info)
├── OR: Digital certification (PADI eCard, SSI app screenshot)
├── OR: Certification number + issuing agency

Extracted/Entered Information:
├── Agency (PADI, SSI, NAUI, etc.)
├── Certification level
├── Certification number
├── Certification date
├── Diver name (must match booking)
└── Specialties visible
```

**Verification Workflow:**

```
1. Customer uploads cert photo

2. Staff reviews (or AI extracts):
   → Matches name to booking
   → Identifies agency and level
   → Checks expiration (if applicable)
   → Notes specialties

3. System records:
   → Certification level in profile
   → Eligibility for trip types updated
   → Image stored for reference

4. Future bookings:
   → Customer doesn't re-upload
   → Cert on file unless expired/upgraded
   → "Add new certification" option
```

**Digital Certification Integration:**

Training agencies moving to digital:
- **PADI**: eCard in app
- **SSI**: Digital cert in app
- **SDI/TDI**: Digital credentials

Future: Direct API verification with agencies (not widely available yet, but coming).

---

**Automated Communications**

Reduce manual communication while improving customer experience.

**Email/SMS Automation Triggers:**

| Trigger | Timing | Content |
|---------|--------|---------|
| Booking confirmed | Immediate | Confirmation, receipt, what's next |
| Pre-trip checklist | 3 days before | Links to waiver, medical, briefings |
| Checklist reminder | 1 day before | "Don't forget to complete..." |
| Final confirmation | Evening before | Meeting time/place, weather, what to bring |
| Day-of welcome | Morning of | "See you soon!" with contact info |
| Post-trip thank you | Same evening | Thank you, review request, photos link |
| Feedback request | 2 days after | Survey link |
| Rebooking prompt | 1 week after | "Book your next dive" offer |
| Service reminder | Based on equipment | "Your regulator is due for service" |
| Birthday/anniversary | Annual | Special offer |
| Lapsed customer | 6-12 months inactive | "We miss you" campaign |

**Communication Templates:**

```
CommunicationTemplate
├── name
├── trigger_type
├── timing (relative to trigger)
├── channel (email, sms, both)
├── subject (email)
├── body (supports variables: {{customer_name}}, {{trip_date}}, etc.)
├── conditions (only if incomplete checklist, only for certain trips, etc.)
├── is_active
└── created_at

SentCommunication
├── template_id
├── customer_id
├── booking_id
├── sent_at
├── channel
├── status (sent, delivered, opened, clicked, bounced, failed)
├── variables_used
└── response_data
```

**SMS Considerations:**
- Requires customer opt-in
- Keep messages short
- Include opt-out option
- Costs per message (plan accordingly)
- Great for day-of updates (weather, time changes)

---

**Customer Portal**

Give customers a self-service portal to manage their diving.

**Portal Features:**

**My Bookings**
- View upcoming trips
- Reschedule/cancel (within policy)
- Complete paperwork
- View past trips

**My Profile**
- Contact information
- Emergency contacts
- Medical information
- Rental sizes/preferences
- Communication preferences

**My Certifications**
- View certifications on file
- Upload new certifications
- Track continuing education

**My Documents**
- Signed waivers
- Medical forms
- Trip receipts
- Completion certificates

**My Equipment** (if they own gear serviced by you)
- Equipment registry
- Service history
- Service reminders
- Schedule service

**My Photos/Videos**
- Access trip photos
- Download links
- Share to social media

**Portal Data Model:**

```
CustomerPortalSession
├── customer_id
├── logged_in_at
├── logged_out_at
├── ip_address
├── device_info
└── pages_viewed

CustomerPreference
├── customer_id
├── category (communication, rental, dietary, etc.)
├── preference_key
├── preference_value
└── updated_at
```

**Authentication Options:**
- Email magic link (simple, no password)
- Email + password (traditional)
- Social login (Google, Facebook)
- SMS code (for phone-primary customers)

---

**Automation ROI**

Calculate the value of self-service:

```
BEFORE AUTOMATION:
─────────────────────────────────────────────────────
Manual check-in time: 20 minutes per customer
Customers per day: 24
Staff time spent: 8 hours/day on check-in
Staff cost: $20/hour
Daily check-in cost: $160

Paper costs: $2 per customer (waivers, forms)
Daily paper: $48

Errors/issues from illegible forms: 2 per day
Time to resolve: 15 min each = 30 min
Error cost: $10/day

DAILY TOTAL: $218
MONTHLY (25 days): $5,450
ANNUAL: $65,400

AFTER AUTOMATION:
─────────────────────────────────────────────────────
Verification time: 3 minutes per customer
Staff time: 1.2 hours/day
Daily staff cost: $24

Software cost: $200/month

Paper: $0
Errors: Near zero

DAILY TOTAL: ~$30
MONTHLY: $950 (including software)
ANNUAL: $11,400

SAVINGS: $54,000/year
─────────────────────────────────────────────────────
```

Plus intangible benefits:
- Trips leave on time
- Better customer experience
- Professional image
- Data quality improved
- Staff focused on hospitality, not paperwork

---

**Implementation Checklist:**

```
Phase 1: Digital Waivers
□ Choose e-signature platform (Smartwaiver, WaiverForever, etc.)
□ Digitize waiver templates
□ Integrate with booking system
□ Test customer experience
□ Train staff on workflow

Phase 2: Medical Questionnaire
□ Digitize medical form
□ Build branching logic
□ Define outcome rules
□ Add physician clearance upload
□ Integrate with booking status

Phase 3: Automated Communications
□ Map customer journey touchpoints
□ Write email/SMS templates
□ Configure automation triggers
□ Test sequences end-to-end
□ Monitor open/click rates

Phase 4: Video Briefings
□ Script essential briefings
□ Record and edit videos
□ Host on video platform
□ Add tracking
□ Integrate completion with booking

Phase 5: Customer Portal
□ Build/configure portal
□ Enable self-service features
□ Test customer flows
□ Communicate to customers
□ Monitor adoption

Phase 6: Certification Upload
□ Add upload functionality
□ Train staff on verification
□ Build certification database
□ Enable future booking shortcuts
```

---

**Software Needs for Concierge Model:**
- **Accommodation tracking**: Bookings, preferences, special requests
- **Package pricing**: Bundle services with automatic calculation
- **Communication hub**: Coordinate with partners and customers
- **Document delivery**: Send complete trip details to customers

**Example Package Configuration:**

```
CENOTE ADVENTURE PACKAGE - 3 Days

Day 1:
- Airport pickup (included)
- Hotel check-in assistance
- Afternoon 2-tank boat dive
- Welcome dinner recommendation

Day 2:
- Cenote day trip (2 cenotes, 4 dives)
- Transport, guide, entrance fees included
- Lunch at cenote

Day 3:
- Morning 2-tank boat dive
- Hotel checkout
- Airport transfer (included)

Package includes:
✓ 8 dives total
✓ All tanks, weights
✓ Airport transfers
✓ Cenote transport
✓ Cenote entrance fees
✓ Lunch Day 2

Not included:
- Accommodation (we can arrange)
- Equipment rental
- Nitrox
- Tips

Price: $XXX per person
```

**The Competitive Advantage:**

A small operator offering the concierge model competes with resorts on:
- **Personalization**: More attention than large resorts
- **Flexibility**: Custom itineraries vs. fixed packages
- **Local expertise**: Deep knowledge of hidden gems
- **Price**: Lower overhead, competitive pricing
- **Relationships**: Customers know you, not a rotating staff

**Quality Control:**

When you rely on partners, your reputation depends on them:
- Vet partners carefully before recommending
- Get feedback after every service
- Drop partners who disappoint
- Build redundancy (multiple options)
- Visit/use partner services yourself

**Scaling the Model:**

Start small, expand as you systemize:
1. Begin with airport transfers (easy, high value)
2. Add accommodation recommendations
3. Build cenote/remote site offerings
4. Create multi-day packages
5. Develop group trip capabilities
6. Eventually: your own vehicles, your own property?

---

**The Referral Network:**

These operator types form an ecosystem:

```
                              ┌─────────────────────┐
                              │     LIVEABOARDS     │
                              │                     │
                              │ • Remote destinations│
                              │ • Bucket list trips │
                              │ • Annual pilgrimages│
                              └──────────┬──────────┘
                                         │
            Sell liveaboard trips        │         Book direct or via agents
            to their customers           │
                    ┌────────────────────┴────────────────────┐
                    ▼                                         │
┌─────────────────┐         Referrals          ┌─────────────────┐
│   LANDLOCKED    │ ─────────────────────────▶ │   DESTINATION   │
│     SHOPS       │                            │    OPERATORS    │
│                 │ ◀───────────────────────── │                 │
│ (train divers)  │    Completion confirmations │ (complete certs)│
└────────┬────────┘                            └────────┬────────┘
         │                                              │
         │  Specialty referrals ↓↑                      │ Specialty referrals ↓↑
         │                                              │
         │      ┌─────────────────────────┐             │
         │      │     INDEPENDENT         │             │
         └─────▶│      OPERATORS          │◀────────────┘
                │                         │
                │ • Specialty instruction │
                │ • Private guiding       │
                │ • Technical training    │
                │ • Overflow capacity     │
                └────────────┬────────────┘
                             │
         ┌───────────────────┴───────────────────┐
         ▼                                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                      COASTAL SHOPS                               │
│              (serve all segments, integrate with all)            │
└─────────────────────────────────────────────────────────────────┘
```

**Symbiotic Relationships:**
- **Landlocked → Liveaboards**: Shops sell liveaboard trips to their loyal customers, often organizing group charters
- **Landlocked → Destination**: Referral completions, recreational dive bookings
- **Destination → Independents**: Private guides for VIP guests, specialty instruction
- **Independents → Shops**: Use facilities (pools, air) for fees or revenue share
- **Liveaboards → Agents**: Work with dive travel agencies who handle marketing and bookings
- **Coastal shops**: Compete and cooperate with all segments

**The Liveaboard Connection:**
Liveaboards occupy a special place—they're the "graduation trip" for Identity Divers:
1. Diver gets certified at landlocked shop
2. Does local diving and destination trips
3. Builds experience and logs dives
4. Books bucket-list liveaboard trip
5. Returns to landlocked shop for gear, more training
6. Repeats annually

Landlocked shops often become de facto travel agents for their loyal customers, booking liveaboard trips and earning commissions or organizing group charters.

Understanding which type of operation you're building software for—or supporting all five—fundamentally shapes requirements.

---

### 1.2.10 AI and Natural Language Interfaces

The next evolution in dive shop software isn't just automation—it's intelligence. By integrating Large Language Models (LLMs) through API services like OpenRouter, Claude, or GPT, dive shops can wrap their entire application in a conversational interface that understands natural language.

**The Vision: Conversational Operations**

Instead of clicking through menus and filling forms, staff and customers interact naturally:

```
Staff: "Book Maria Garcia on tomorrow morning's two-tank trip
       to Palancar Reef"

AI: "I found Maria Garcia in the system. She's Advanced Open Water
    certified with current medical clearance. Tomorrow's two-tank
    trip to Palancar Reef (8:00 AM) has 6 spots available.

    The price is $130 including the site fee. Should I create
    the booking?"

Staff: "Yes, and she'll need a full equipment rental"

AI: "I've created booking #4523 for Maria Garcia:
    - Two-Tank Morning Trip, Jan 6 @ 8:00 AM
    - Palancar Reef
    - Price: $130
    - Added full equipment rental: $45
    - Total: $175

    Her rental sizes are on file: BCD Medium, Wetsuit M-Long,
    Fins 8. Confirmation email sent. Anything else?"
```

**Why This Matters:**

1. **Reduced Training Time**: New staff can be productive immediately—just talk to the system
2. **Faster Operations**: Voice is faster than clicking; natural language faster than form-filling
3. **Fewer Errors**: AI validates as it goes, catches mismatches, suggests corrections
4. **Mobile-First**: Works from phone, boat, anywhere with signal
5. **Customer Self-Service**: Customers can book, ask questions, get recommendations via chat

---

**Architecture: LLM as Application Interface**

```
┌─────────────────────────────────────────────────────────────┐
│                    USER INTERFACES                          │
├─────────────────┬─────────────────┬─────────────────────────┤
│   Staff Chat    │  Customer Chat  │     Voice Assistant     │
│   (internal)    │   (website)     │    (phone/speaker)      │
└────────┬────────┴────────┬────────┴────────────┬────────────┘
         │                 │                      │
         ▼                 ▼                      ▼
┌─────────────────────────────────────────────────────────────┐
│                   LLM ORCHESTRATION LAYER                    │
│                                                              │
│  • Route requests to appropriate tools/functions             │
│  • Maintain conversation context                             │
│  • Enforce permissions (staff vs customer)                   │
│  • Handle ambiguity and clarification                        │
└────────────────────────────┬────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    FUNCTION/TOOL LAYER                       │
├─────────────┬─────────────┬─────────────┬───────────────────┤
│ search_     │ create_     │ check_      │ get_              │
│ divers()    │ booking()   │ eligibility()│ availability()   │
├─────────────┼─────────────┼─────────────┼───────────────────┤
│ update_     │ cancel_     │ check_in_   │ send_             │
│ booking()   │ booking()   │ diver()     │ communication()   │
├─────────────┼─────────────┼─────────────┼───────────────────┤
│ search_     │ get_        │ calculate_  │ generate_         │
│ inventory() │ schedule()  │ price()     │ report()          │
└─────────────┴─────────────┴─────────────┴───────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    DIVE SHOP APPLICATION                     │
│                                                              │
│  • Django/PostgreSQL backend                                 │
│  • Existing models, services, business logic                 │
│  • Audit logging                                             │
│  • All existing functionality                                │
└─────────────────────────────────────────────────────────────┘
```

**Key Insight**: The LLM doesn't replace your application—it becomes a new interface to it. All business logic, validation, and data integrity remain in your application layer.

---

**Implementation with OpenRouter or Direct APIs**

**OpenRouter** provides a unified API to access multiple LLM providers (Claude, GPT-4, Llama, etc.), letting you:
- Choose the best model for your use case
- Fall back to alternatives if one is unavailable
- Compare costs across providers
- Switch models without code changes

**Basic Integration Pattern:**

```python
import openai  # Works with OpenRouter's API

client = openai.OpenAI(
    base_url="https://openrouter.ai/api/v1",
    api_key=settings.OPENROUTER_API_KEY,
)

# Define tools the LLM can use
tools = [
    {
        "type": "function",
        "function": {
            "name": "search_divers",
            "description": "Search for divers by name, email, or phone",
            "parameters": {
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "Name, email, or phone to search"
                    }
                },
                "required": ["query"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "create_booking",
            "description": "Create a booking for a diver on an excursion",
            "parameters": {
                "type": "object",
                "properties": {
                    "diver_id": {"type": "string"},
                    "excursion_id": {"type": "string"},
                    "add_rentals": {"type": "boolean"}
                },
                "required": ["diver_id", "excursion_id"]
            }
        }
    },
    # ... more tools
]

def handle_staff_message(message, conversation_history):
    """Process a staff message through the LLM."""

    response = client.chat.completions.create(
        model="anthropic/claude-sonnet",  # Or any model
        messages=conversation_history + [
            {"role": "user", "content": message}
        ],
        tools=tools,
        tool_choice="auto"
    )

    # Process tool calls
    if response.choices[0].message.tool_calls:
        for tool_call in response.choices[0].message.tool_calls:
            result = execute_tool(
                tool_call.function.name,
                json.loads(tool_call.function.arguments)
            )
            # Continue conversation with tool result

    return response.choices[0].message.content
```

**Tool Implementation (connects to your app):**

```python
def execute_tool(name, arguments):
    """Execute a tool call against the dive shop application."""

    if name == "search_divers":
        return search_divers_service(arguments["query"])

    elif name == "create_booking":
        return create_booking_service(
            diver_id=arguments["diver_id"],
            excursion_id=arguments["excursion_id"],
            add_rentals=arguments.get("add_rentals", False),
            actor=current_user,  # From session
        )

    elif name == "check_eligibility":
        return check_eligibility_service(
            diver_id=arguments["diver_id"],
            excursion_id=arguments["excursion_id"],
        )

    # ... handle other tools
```

---

**Staff Assistant Capabilities**

What staff can do through natural language:

**Bookings:**
- "Book John Smith on tomorrow's morning trip"
- "Cancel Maria's booking for Friday—she called in sick"
- "Move the Gonzales family to the afternoon trip"
- "Check in everyone for the 8 AM trip"
- "Who's on tomorrow's boat?"
- "Show me all bookings for next week"

**Customer Lookup:**
- "Find the diver who called yesterday about cave diving"
- "What certifications does Sarah Johnson have?"
- "When did Mike last dive with us?"
- "Show me customers with expired medical forms"

**Scheduling:**
- "What's our availability next Saturday?"
- "Schedule a two-tank trip for next Tuesday at 8 AM"
- "Cancel Friday's afternoon trip—weather looks bad"
- "How many trips do we have this month?"

**Reporting:**
- "How much revenue did we do last month?"
- "Show me our most popular dive sites"
- "Which customers haven't been back in 6 months?"
- "What's our booking rate for the morning vs afternoon trips?"

**Equipment:**
- "Is there a large BCD available for tomorrow?"
- "Mark the reg with serial 12345 as out for service"
- "What equipment does the Johnson rental need?"

---

**Customer-Facing Chat**

Embed an AI chat on your website for customer self-service:

```
Customer: "I want to go diving next Saturday with my wife.
          We're both certified."

AI: "I'd be happy to help you book a dive for next Saturday!

    We have these trips available:

    1. 🌅 Two-Tank Morning (8:00 AM - 12:30 PM)
       Paradise Reef → Coral Gardens
       $120 per person • 8 spots left

    2. 🌊 Two-Tank Afternoon (1:30 PM - 6:00 PM)
       Chankanaab → Yucab
       $120 per person • 12 spots left

    3. 🌙 Night Dive (7:00 PM - 9:30 PM)
       Paradise Reef
       $95 per person • 6 spots left

    Which interests you?"

Customer: "The morning one sounds good. Do you have
          equipment rental?"

AI: "Yes! Full equipment rental is $45 per person and includes
    BCD, regulator, wetsuit, mask, fins, and dive computer.

    To complete your booking for 2 divers on the Two-Tank
    Morning trip (Saturday, Jan 10), I'll need:

    1. Names and certification levels for both divers
    2. Whether you need equipment rental
    3. Contact email for confirmation

    Would you like to proceed?"
```

**Customer Chat Boundaries:**

The customer chat has limited permissions:
- ✅ View availability and pricing
- ✅ Start a booking (but not complete payment)
- ✅ Ask questions about trips, sites, requirements
- ✅ Update their own profile information
- ✅ Check their upcoming bookings
- ❌ Cannot see other customers' data
- ❌ Cannot modify bookings without authentication
- ❌ Cannot access staff functions

---

**Voice Interface**

Take it further with voice:

**Phone Integration:**
- Customer calls shop
- AI answers: "Thanks for calling Blue Reef Divers. I can help you check availability, make a booking, or answer questions. How can I help?"
- Natural conversation to complete tasks
- Hands off to human for complex issues

**In-Shop Assistant:**
- Smart speaker or tablet at check-in
- Staff: "Hey DiveBot, check in everyone for the morning trip"
- AI processes, confirms: "12 divers checked in for the 8 AM trip. Maria Garcia still needs to complete her waiver—I've sent her a reminder."

**Boat/Field Use:**
- Mobile voice interface
- Divemaster: "DiveBot, mark the morning trip as started"
- AI: "Two-tank morning marked started at 8:15 AM. 12 divers, all checked in. Have a great dive!"

---

**Data Model for AI Integration**

Track AI interactions for training and audit:

```
AIConversation
├── id (UUID)
├── user_id (staff or customer)
├── user_type (staff, customer, anonymous)
├── channel (web_chat, voice, sms, internal)
├── started_at
├── ended_at
├── message_count
├── tools_called (array of tool names)
├── model_used
├── total_tokens
├── estimated_cost
└── satisfaction_rating

AIMessage
├── conversation_id
├── role (user, assistant, system, tool)
├── content
├── tool_calls (JSON)
├── tool_results (JSON)
├── timestamp
├── tokens_used
└── latency_ms

AIToolExecution
├── message_id
├── tool_name
├── arguments (JSON)
├── result (JSON)
├── success
├── execution_time_ms
├── error (if failed)
└── audit_entry_id (links to main audit log)
```

**Why Track This:**
- **Cost management**: Monitor API spend per use case
- **Quality improvement**: Review conversations that went poorly
- **Training data**: Use successful conversations to improve prompts
- **Audit trail**: Every AI action links to your audit log
- **Usage patterns**: Understand what staff/customers actually ask

---

**Prompt Engineering for Dive Shops**

The system prompt defines the AI's behavior:

```
You are an AI assistant for Blue Reef Divers, a dive shop
in Cozumel, Mexico. You help staff manage bookings, look
up customers, and handle daily operations.

CORE BEHAVIORS:
1. Always verify diver eligibility before creating bookings
2. Confirm prices and include equipment rentals when offered
3. Check availability before promising anything
4. When uncertain, ask clarifying questions
5. Log all booking changes to the audit trail

SHOP CONTEXT:
- We run 2 boats: Blue Reef I (18 divers) and Blue Reef II (12 divers)
- Morning trips: 8 AM, Afternoon trips: 1:30 PM, Night dives: 7 PM
- Minimum certification for recreational dives: Open Water
- Deep sites (>30m) require Advanced Open Water
- We accept cash, credit cards, and PayPal
- Cancellation policy: Full refund 48+ hours, 50% 24-48 hours,
  no refund under 24 hours

CURRENT STATUS:
- Today is [CURRENT_DATE]
- Weather: [WEATHER_STATUS]
- Active alerts: [ANY_ALERTS]

When you don't know something specific about our operations,
say so rather than guessing. For complex requests, confirm
understanding before taking action.
```

**Context Injection:**

Before each conversation, inject current state:

```python
def build_system_prompt(user, context="staff"):
    base_prompt = load_prompt_template("staff_assistant")

    # Inject current context
    context_data = {
        "current_date": timezone.now().strftime("%A, %B %d, %Y"),
        "weather_status": get_current_weather(),
        "alerts": get_active_alerts(),
        "todays_trips": format_todays_schedule(),
        "user_name": user.name,
        "user_role": user.role,
    }

    return base_prompt.format(**context_data)
```

---

**Permission Boundaries**

Critical: The AI must respect role boundaries:

```python
# Tool definitions include permission requirements
TOOLS = {
    "search_divers": {
        "permissions": ["staff", "admin"],
        "description": "Search customer database",
    },
    "create_booking": {
        "permissions": ["staff", "admin"],
        "description": "Create a new booking",
    },
    "view_own_bookings": {
        "permissions": ["customer", "staff", "admin"],
        "description": "View bookings for authenticated user",
    },
    "cancel_booking": {
        "permissions": ["staff", "admin"],
        "requires_confirmation": True,
        "description": "Cancel an existing booking",
    },
    "modify_pricing": {
        "permissions": ["admin"],
        "requires_confirmation": True,
        "audit_level": "critical",
        "description": "Modify pricing configuration",
    },
}

def execute_tool(name, arguments, user):
    tool_config = TOOLS[name]

    # Check permissions
    if user.role not in tool_config["permissions"]:
        raise PermissionDenied(
            f"Your role ({user.role}) cannot execute {name}"
        )

    # Require confirmation for destructive actions
    if tool_config.get("requires_confirmation"):
        if not arguments.get("confirmed"):
            return {"needs_confirmation": True, "action": name}

    # Execute and audit
    result = tool_functions[name](**arguments, actor=user)

    return result
```

---

**Error Handling and Fallbacks**

AI isn't perfect. Handle failures gracefully:

```python
async def handle_message(message, user, conversation):
    try:
        response = await call_llm(message, conversation)
        return response

    except RateLimitError:
        # Fall back to simpler model or queue
        return await call_fallback_model(message)

    except ToolExecutionError as e:
        # Tool failed - explain and suggest alternatives
        return f"I couldn't complete that action: {e.message}. " \
               f"Would you like to try a different approach?"

    except AmbiguousRequestError:
        # Need clarification
        return "I want to make sure I understand correctly. " \
               f"Did you mean {e.options}?"

    except Exception as e:
        # Unknown error - log and escalate
        log_error(e, conversation)
        return "I encountered an unexpected issue. Let me " \
               "connect you with a staff member who can help."
```

**Human Escalation:**

```
AI: "I'm not able to process that request. Let me get a
    staff member to help you.

    [Connecting to available staff...]

    Staff member Maria is now in the chat."
```

---

**ROI Calculation: AI Assistant**

```
STAFF EFFICIENCY GAINS:
─────────────────────────────────────────────────────
Without AI:
- Average booking time: 4 minutes (lookup, click, confirm)
- Bookings per day: 30
- Daily booking time: 2 hours

With AI:
- Average booking time: 45 seconds (speak or type request)
- Bookings per day: 30
- Daily booking time: 22 minutes

TIME SAVED: 1.6 hours/day = 40+ hours/month

CUSTOMER SERVICE:
- AI handles 70% of routine inquiries
- Staff focuses on complex issues
- 24/7 availability (AI doesn't sleep)
- Consistent responses every time

COSTS:
- OpenRouter/API costs: ~$50-200/month (usage dependent)
- Integration development: One-time cost
- Maintenance: Minimal (mostly prompt refinement)

INTANGIBLE BENEFITS:
- Faster response times
- Reduced training time for new staff
- Fewer errors (AI validates as it goes)
- Professional impression
- Competitive differentiation
─────────────────────────────────────────────────────
```

---

**Getting Started with AI Integration**

**Phase 1: Internal Staff Chat (Low Risk)**
1. Set up OpenRouter account
2. Build simple chat interface for staff
3. Connect 5-10 basic tools (search, view, simple reports)
4. Test with small group of power users
5. Refine prompts based on real usage

**Phase 2: Expand Staff Capabilities**
1. Add booking creation/modification tools
2. Add equipment and rental management
3. Implement confirmation workflows for destructive actions
4. Roll out to all staff
5. Monitor and improve

**Phase 3: Customer-Facing Chat**
1. Build limited-permission customer chat
2. Start with read-only (availability, FAQs, their bookings)
3. Add booking initiation (completes on website)
4. Test extensively before public launch
5. Always offer human escalation

**Phase 4: Voice and Advanced Features**
1. Integrate phone answering (Twilio + Whisper)
2. Add in-shop voice assistants
3. Implement proactive suggestions
4. Build reporting/analytics voice interface

---

**The Future: Proactive AI**

Beyond responding to requests, AI becomes proactive:

```
AI (to staff at 7 AM): "Good morning! Today's 8 AM trip
has 16 confirmed divers. Two things to note:

1. Weather shows 15-knot winds building by afternoon—
   you might want to consider adjusting the afternoon
   site to somewhere more protected.

2. Sarah Johnson on the morning trip is due for her
   annual medical renewal. She's a loyal customer
   (42 trips with us)—might be a good time to
   mention it during check-in.

Equipment is staged for all rentals. Have a great day!"
```

The AI knows your operation, watches for patterns, and surfaces relevant information before you ask.

---

**Implementation Checklist:**

```
Phase 1: Foundation
□ Choose LLM provider (OpenRouter, direct API, etc.)
□ Set up API credentials securely
□ Define tool interfaces for your application
□ Build basic chat UI for staff
□ Write initial system prompts
□ Implement conversation logging

Phase 2: Staff Tools
□ Implement search tools (divers, bookings, trips)
□ Implement read tools (availability, schedules, reports)
□ Implement action tools (create, update, cancel)
□ Add confirmation workflows for sensitive actions
□ Connect to audit logging
□ Test with real staff scenarios

Phase 3: Customer Chat
□ Build customer-facing chat widget
□ Define customer permission boundaries
□ Implement FAQ responses
□ Add booking flow initiation
□ Test with simulated customers
□ Add human escalation path

Phase 4: Voice (Optional)
□ Set up Twilio or similar for phone
□ Integrate speech-to-text (Whisper, etc.)
□ Integrate text-to-speech
□ Build voice-specific prompts
□ Test call handling scenarios
□ Deploy limited trial

Phase 5: Advanced
□ Add proactive alerts and suggestions
□ Implement analytics on conversations
□ Build prompt improvement feedback loop
□ Consider fine-tuning for your domain
□ Expand to additional channels (SMS, WhatsApp)
```

---

### 1.2.11 Regulatory Compliance and Park Reporting

Dive operators in protected marine areas face strict reporting requirements. National parks, marine reserves, and biosphere reserves require detailed visitor logs as a condition of operating permits. Failure to maintain accurate records—or submit them on time—can mean permit revocation.

**Example: Parque Nacional Arrecife de Puerto Morelos**

This Mexican national park requires operators to:
- Track every visitor entering the park
- Collect appropriate fees based on visitor category
- Issue physical bracelets as proof of payment
- Submit detailed reports when renewing operating permits
- Maintain records for audits

**Fee Structure (varies by park):**

| Category | Fee | Verification |
|----------|-----|--------------|
| Foreign Tourist | 120 MXN | Passport/ID |
| Mexican National | 60 MXN | INE/Mexican ID |
| Local Resident | Exempt | Proof of residency |
| Child (12 & under) | Exempt | Age verification |
| CONANP Researcher | Exempt | Credential |
| Student | Varies | Student ID |

**Extended Price Lists:**

Beyond park fees, dive shops often maintain tiered pricing for their own services:

```
CUSTOMER PRICING TIERS
─────────────────────────────────────────────────────────────
Tier            │ Discount │ Verification      │ Examples
────────────────┼──────────┼───────────────────┼─────────────
Regular Tourist │    0%    │ None              │ Walk-ins
Returning Guest │   10%    │ System lookup     │ 3+ trips
Local Resident  │   25%    │ Utility bill, INE │ Playa locals
Student         │   20%    │ Valid student ID  │ University
Military/First  │   15%    │ Service ID        │ Active duty
Responder       │          │                   │
Dive Pro        │   30%    │ Pro credentials   │ DMs, instructors
Senior (65+)    │   15%    │ ID with birthdate │ Retirees
Group (6+)      │   15%    │ Group booking     │ Families, clubs
Scholarship     │  100%    │ Program approval  │ Sponsored locals
─────────────────────────────────────────────────────────────
```

**Price List Data Model:**

```
PricingTier
├── id
├── name ("Local Resident", "Student", "Scholarship")
├── discount_percent
├── discount_type (percentage, fixed_amount, free)
├── verification_required
├── verification_types (JSON array)
├── stackable (can combine with other discounts?)
├── max_discount_if_stacked
├── valid_for_products (all, specific list)
├── valid_days (all, weekdays_only, etc.)
├── requires_approval
├── approval_roles (which staff can approve)
├── is_active
└── notes

CustomerTierAssignment
├── customer_id
├── tier_id
├── assigned_date
├── verified_by (staff who verified)
├── verification_document (uploaded proof)
├── expires_at (for time-limited tiers like student)
├── notes
└── is_active
```

**Local Pricing Philosophy:**

In destinations like Mexico's Riviera Maya, diving is often priced for tourists:
- Two-tank trip: $120 USD
- Local minimum wage: ~$15 USD/day

Making diving accessible to locals builds:
- Community goodwill
- Future dive professionals
- Ocean conservation advocates
- Local ambassadors for your business

**The Strategic Value: Environmental Ambassadors**

This goes beyond charity. When locals become divers, they become:

```
LOCAL DIVER → OCEAN ADVOCATE → POLITICAL INFLUENCE

┌─────────────────────────────────────────────────────────────┐
│              THE ENVIRONMENTAL AMBASSADOR PIPELINE           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  COMMUNITY MEMBERS                                          │
│  └─ Fishermen, students, workers                            │
│     └─ Often see reef as resource to extract from           │
│                                                              │
│         ↓ [Scholarship: Learn to Dive]                      │
│                                                              │
│  RECREATIONAL DIVERS                                        │
│  └─ Experience reef firsthand                               │
│     └─ Witness beauty, understand fragility                 │
│                                                              │
│         ↓ [Continued Support: Advanced Training]            │
│                                                              │
│  OCEAN ADVOCATES                                            │
│  └─ Understand conservation personally                      │
│     └─ Connect livelihood to healthy reef                   │
│                                                              │
│         ↓ [Professional Development: DM, Instructor]        │
│                                                              │
│  ENVIRONMENTAL AMBASSADORS                                  │
│  └─ Work in dive industry                                   │
│  └─ Speak at community meetings                             │
│  └─ Influence local policy                                  │
│  └─ Vote for conservation measures                          │
│  └─ Teach next generation                                   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Why Political Control Matters:**

Dive operators are often outsiders—American, European, from Mexico City. They can advocate, but locals have:

- **Voting Rights**: In local/state/federal elections affecting marine policy
- **Ejido Membership**: In Mexico, ejidos control vast coastal land
- **Community Standing**: Voice in local assemblies and decisions
- **Regulatory Input**: Invited to comment on park management plans
- **Cultural Authority**: "I grew up here, this is my reef"

**Real Impact Examples:**

```
BEFORE: Fishermen see reef as income source to exploit
AFTER:  Former fishermen now guides tourists to see "their" reef

BEFORE: Local council sees marine park as restriction on economy
AFTER:  Council members who dive vote to expand protected area

BEFORE: Youth leave for cities, no connection to ocean
AFTER:  Youth become divemasters, stay, protect, vote locally
```

**A Scholarship Recipient's Journey:**

```
Year 1: Marco, local fisherman's son, gets scholarship dive
        → First time seeing reef from diver's perspective
        → "I had no idea it was so beautiful"

Year 2: Completes Open Water, starts volunteering for reef cleanups
        → Influences family to use sustainable fishing practices
        → Speaks at school about marine conservation

Year 3: Advanced certification, assistant divemaster training
        → Attends ejido meeting about coastal development
        → Speaks against project that would damage reef

Year 4: Working divemaster, voter, community voice
        → Organizes youth diving program
        → Testifies at marine park management hearing
        → Votes in every election, prioritizes ocean issues

Year 10: Shop owner, employer, political figure
         → Hires other scholarship recipients
         → Serves on local environmental committee
         → Mentors next generation of ocean advocates
```

**This is investment, not charity.**

---

**Donations and Sponsorships as Core Software Features**

Donation and sponsorship management isn't optional—it's a core module of modern dive shop software. Just like bookings and inventory.

```
CORE SOFTWARE MODULES
─────────────────────────────────────────────────────────────
□ Customer Management
□ Booking & Scheduling
□ Pricing & Payments
□ Equipment & Inventory
□ Certification Tracking
□ Audit & Compliance
■ DONATIONS & SPONSORSHIPS  ← First-class feature
─────────────────────────────────────────────────────────────
```

**Why Core, Not Add-On:**

1. **Revenue Stream**: Donations are income (or pass-through)
2. **Customer Engagement**: Donors become loyal advocates
3. **Brand Differentiation**: "We give back" marketing
4. **Community Relations**: Builds local goodwill
5. **Tax Implications**: Must track properly
6. **Audit Requirements**: Donation accounting matters

**Donation Types to Support:**

```
DonationType
├── one_time (single contribution)
├── round_up (round booking to nearest amount)
├── percentage (add X% to booking)
├── monthly_recurring (subscription donation)
├── trip_sponsored (fund specific trip for recipient)
├── certification_sponsored (fund specific course)
├── equipment_sponsored (fund gear for recipient)
├── general_fund (unrestricted contribution)
└── matching_gift (corporate match)
```

**Sponsorship Relationship Tracking:**

```
Sponsorship
├── id
├── sponsor_id (donor customer)
├── recipient_id (scholarship recipient)
├── sponsorship_type (ongoing, one_time, pledge)
├── amount_committed
├── amount_paid
├── frequency (monthly, annual, one_time)
├── started_at
├── ends_at
├── is_anonymous
├── sponsor_updates_enabled (receive recipient news)
├── sponsor_message
├── recipient_thank_you
├── status (active, completed, cancelled)
└── notes

SponsorUpdate
├── sponsorship_id
├── sent_at
├── update_type (progress, milestone, thank_you, photo)
├── content
├── photos
├── seen_by_sponsor
└── sponsor_response
```

**Donation Processing:**

```python
class DonationProcessor:
    """Handle all donation types."""

    def process_round_up(self, booking):
        """Round booking to next $10, donate difference."""
        current = booking.total_amount
        rounded = math.ceil(current / 10) * 10
        donation = rounded - current

        if donation > 0:
            return self.create_donation(
                amount=donation,
                donation_type="round_up",
                booking=booking,
            )

    def process_percentage(self, booking, percent=5):
        """Add percentage to booking as donation."""
        donation = booking.subtotal * (Decimal(percent) / 100)
        return self.create_donation(
            amount=donation.quantize(Decimal("0.01")),
            donation_type="percentage",
            booking=booking,
        )

    def process_sponsorship(self, sponsor, recipient, amount, frequency):
        """Create ongoing sponsorship relationship."""
        sponsorship = Sponsorship.objects.create(
            sponsor=sponsor,
            recipient=recipient,
            amount_committed=amount,
            frequency=frequency,
            started_at=timezone.now(),
        )

        if frequency == "monthly":
            schedule_recurring_payment(sponsorship)

        notify_recipient_of_sponsor(sponsorship)
        return sponsorship
```

**Donor Dashboard:**

```
MY GIVING DASHBOARD - John Smith
─────────────────────────────────────────────────────────────

LIFETIME GIVING: $847

Active Sponsorship:
┌─────────────────────────────────────────────────────────┐
│ Maria Elena - Open Water → Divemaster Journey           │
│                                                          │
│ Your commitment: $50/month                              │
│ Paid to date: $400                                      │
│ Her progress: Advanced certified, now in DM training!  │
│                                                          │
│ [View Updates] [Send Message] [Increase Support]        │
└─────────────────────────────────────────────────────────┘

Recent Donations:
├─ Jan 5: $7 (round-up) - Morning dive booking
├─ Dec 28: $50 (monthly sponsorship)
├─ Dec 15: $12 (round-up) - Night dive booking
├─ Nov 28: $50 (monthly sponsorship)
└─ [View All]

Your Impact:
• Funded 4 dives for scholarship recipients
• Contributed to 1 Open Water certification
• Supporting 1 divemaster candidate

Tax Documents:
• [2025 Donation Receipt - $620]
• [2024 Donation Receipt - $227]
─────────────────────────────────────────────────────────────
```

**Integration Points:**

```
Every booking flow includes:
├─ Donation prompt (round-up, percentage, fixed)
├─ Current fund status ("$127 away from next cert!")
├─ Impact stats ("Your donations have funded 3 dives")
└─ Sponsorship opportunity ("Meet divers you could sponsor")

Every receipt includes:
├─ Donation amount (if any)
├─ Year-to-date giving total
├─ Tax-deductible notice
└─ QR code to donor dashboard

Every email includes:
├─ Footer link to scholarship program
├─ Monthly donor newsletter option
└─ Sponsorship matching campaigns
```

---

**Scholarship and Sponsorship Programs**

Create programs where visiting divers fund diving opportunities for locals who cannot afford standard prices.

**The Model:**

```
┌─────────────────────────────────────────────────────────────┐
│                    DIVE SCHOLARSHIP PROGRAM                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  DONORS (Visiting Divers)                                   │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ "Add $10 to sponsor a local's dive"                 │    │
│  │ "Round up my bill to support scholarships"          │    │
│  │ "I'd like to fully sponsor a local certification"   │    │
│  └─────────────────────────────────────────────────────┘    │
│                           │                                  │
│                           ▼                                  │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              SCHOLARSHIP FUND                        │    │
│  │                                                      │    │
│  │  Balance: $2,450                                    │    │
│  │  This month: +$380 donations, -$240 awarded         │    │
│  └─────────────────────────────────────────────────────┘    │
│                           │                                  │
│                           ▼                                  │
│  RECIPIENTS (Local Community)                               │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ • Local youth wanting to learn diving               │    │
│  │ • Aspiring dive professionals                       │    │
│  │ • Marine biology students                           │    │
│  │ • Conservation volunteers                           │    │
│  │ • Community members (fishermen, etc.)              │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Scholarship Types:**

| Type | Value | Covers | Typical Recipient |
|------|-------|--------|-------------------|
| Single Dive | $40-60 | One fun dive | Local wanting to try |
| Discovery | $100-150 | DSD experience | Youth introduction |
| Open Water Cert | $300-400 | Full OW course | Aspiring diver |
| Advanced Cert | $250-350 | AOW course | Continuing diver |
| Divemaster | $800-1200 | DM course | Career path |
| Equipment | $200-500 | Personal gear | Committed local |
| Annual Pass | $500-800 | Year of diving | Active local diver |

**Scholarship Data Model:**

```
ScholarshipProgram
├── id
├── name ("Local Youth Diving", "Future Divemasters")
├── description
├── funding_source (donations, shop_contribution, grant)
├── current_balance
├── lifetime_donations
├── lifetime_awarded
├── is_active
└── created_at

ScholarshipDonation
├── id
├── program_id
├── donor_id (customer who donated)
├── booking_id (trip where donation was made)
├── amount
├── donation_type (fixed, round_up, full_sponsorship)
├── donor_message (optional note to recipient)
├── is_anonymous
├── tax_receipt_issued
├── created_at
└── notes

ScholarshipRecipient
├── id
├── program_id
├── name
├── age
├── community (where they live)
├── background (brief story)
├── sponsor_preferences (youth, marine bio, etc.)
├── application_date
├── status (pending, approved, active, graduated, inactive)
├── approved_by
├── approved_date
├── photo (for donor recognition, with consent)
├── total_value_received
└── notes

ScholarshipAward
├── id
├── recipient_id
├── program_id
├── award_type (single_dive, certification, equipment, etc.)
├── value
├── funded_by (specific donation or general fund)
├── awarded_date
├── used_date
├── excursion_id (if for a specific trip)
├── course_id (if for certification)
├── equipment_details (if for gear)
├── status (pending, used, expired)
├── recipient_feedback
├── photos (dive photos, cert photos)
└── notes
```

**Donation Collection Points:**

```
1. AT BOOKING (Online)
   □ Add $10 to sponsor a local dive
   □ Sponsor a full certification ($350)
   □ Round up to nearest $10 for scholarship fund

2. AT CHECK-IN
   "Would you like to add a donation to our Local Diver
    Scholarship Fund? Your contribution helps community
    members experience the reef."

3. POST-DIVE
   "Enjoyed your dive? Consider paying it forward—
    sponsor a local's first dive for $40."

4. TIP JAR EQUIVALENT
   Digital tip jar on receipts/emails:
   "Leave a tip for the scholarship fund"

5. DEDICATED CAMPAIGNS
   "Sponsor a Divemaster" - fully fund a local's DM course
   "Youth Ocean Program" - fund school group visits
```

**Matching Programs:**

```
Shop Matching Options:
─────────────────────────────────────────────────────────────
• Match first $500/month in donations 1:1
• Add 25% to all scholarship donations
• Fund 2 certifications/year from shop revenue
• Provide free equipment for scholarship recipients
• Donate slow-season trips to program
─────────────────────────────────────────────────────────────
```

**Transparency and Recognition:**

Donors want to know their money helps:

```
SCHOLARSHIP FUND UPDATE - December 2025
─────────────────────────────────────────────────────────────

This Month:
├─ Donations received: $485 (from 34 guests)
├─ Shop matching: $250
├─ Total added to fund: $735
│
├─ Scholarships awarded: $580
│  ├─ 2 Discovery Dives for local youth
│  ├─ 1 Open Water certification
│  └─ 4 fun dives for scholarship divers
│
└─ Current fund balance: $2,890

RECIPIENT SPOTLIGHT:
┌─────────────────────────────────────────────────────────┐
│ 📸 [Photo]                                              │
│                                                          │
│ Maria Elena, 19, from Puerto Morelos                    │
│                                                          │
│ "I grew up watching the dive boats but never imagined   │
│ I could dive myself. Thanks to the scholarship, I       │
│ completed my Open Water certification last month.       │
│ Now I'm working toward my Advanced and dreaming of      │
│ becoming a divemaster. Thank you to everyone who        │
│ donated!"                                                │
│                                                          │
│ Sponsored by: Donations from 12 guests in October       │
└─────────────────────────────────────────────────────────┘

IMPACT TO DATE:
• 45 locals have learned to dive through the program
• 8 have become certified divemasters
• 3 now work as dive professionals
• 200+ fun dives provided to community members
─────────────────────────────────────────────────────────────
```

**Integration with Bookings:**

```python
def add_scholarship_donation(booking, amount, donation_type="fixed"):
    """Add scholarship donation to a booking."""

    donation = ScholarshipDonation.objects.create(
        program=get_active_scholarship_program(),
        donor=booking.diver,
        booking=booking,
        amount=amount,
        donation_type=donation_type,
    )

    # Update booking total
    booking.scholarship_donation = amount
    booking.total_amount += amount
    booking.save()

    # Update fund balance
    donation.program.current_balance += amount
    donation.program.lifetime_donations += amount
    donation.program.save()

    # Log the donation
    log_audit_event(
        action="scholarship_donation",
        actor=booking.diver,
        context={
            "amount": str(amount),
            "program": donation.program.name,
            "booking_id": str(booking.id),
        }
    )

    return donation


def award_scholarship(recipient, award_type, value, excursion=None):
    """Award scholarship to approved recipient."""

    program = recipient.program

    if program.current_balance < value:
        raise InsufficientFundsError(
            f"Fund balance ({program.current_balance}) "
            f"insufficient for award ({value})"
        )

    award = ScholarshipAward.objects.create(
        recipient=recipient,
        program=program,
        award_type=award_type,
        value=value,
        excursion=excursion,
        awarded_date=timezone.now(),
    )

    # Deduct from fund
    program.current_balance -= value
    program.lifetime_awarded += value
    program.save()

    # Update recipient
    recipient.total_value_received += value
    recipient.save()

    # If for specific excursion, create booking
    if excursion:
        create_scholarship_booking(recipient, excursion, award)

    return award
```

**Tax Considerations:**

```
For US-based donors:
• May be tax-deductible if shop has 501(c)(3) partner
• Or partner with existing ocean conservation nonprofit
• Issue donation receipts with EIN

For shop:
• Track donations separately from revenue
• Donation pass-through ≠ shop income
• Consult accountant for proper treatment
• Consider setting up formal scholarship entity
```

**Why This Matters:**

1. **Permit Compliance**: Inaccurate records = permit problems
2. **Financial Accountability**: Fees collected must match reports
3. **Conservation Data**: Parks use visitor data for management
4. **Audit Trail**: Inspectors can ask for records at any time
5. **Revenue Tracking**: Bracelet fees are a cost of doing business

---

**Tracking Requirements**

For each park entry, track:

```
ParkVisit
├── id (UUID)
├── booking_id (link to trip booking)
├── diver_id (if in system)
├── park_id (which park/reserve)
├── visit_date
├── visitor_name
├── visitor_category (tourist, national, local, child, exempt_other)
├── nationality
├── id_type (passport, INE, residency card, etc.)
├── id_number (optional, for records)
├── age (for child exemption verification)
├── fee_amount
├── fee_currency
├── bracelet_number (if physical bracelets issued)
├── bracelet_color (parks often use color coding)
├── payment_method (cash, included_in_booking, prepaid)
├── collected_by (staff member)
├── notes
├── created_at
└── updated_at
```

**Park/Reserve Configuration:**

```
Park
├── id
├── name ("Parque Nacional Arrecife de Puerto Morelos")
├── short_name ("Puerto Morelos NP")
├── country
├── state_province
├── governing_body ("CONANP")
├── permit_number (your operator permit)
├── permit_expiration
├── fee_structure (JSON - categories and amounts)
├── bracelet_required
├── report_frequency (monthly, quarterly, annual, on_renewal)
├── report_format (template/requirements)
├── contact_info
├── notes
└── is_active

OperatorPermit
├── park_id
├── operator_id (your company)
├── permit_number
├── issued_date
├── expiration_date
├── renewal_requirements
├── conditions (JSON - any special conditions)
├── status (active, pending_renewal, expired, suspended)
├── documents (uploaded permit copies)
└── renewal_history
```

---

**Visitor Category Determination**

Build logic to determine category and fee:

```python
def determine_visitor_category(visitor_info, park):
    """
    Determine visitor category and applicable fee.
    Returns (category, fee_amount, reason)
    """
    # Check age first (children exempt regardless of nationality)
    if visitor_info.age and visitor_info.age <= 12:
        return ("child", Decimal("0.00"), "Child 12 or under - exempt")

    # Check for local residency
    if visitor_info.residency_proof:
        if is_local_resident(visitor_info, park):
            return ("local", Decimal("0.00"), "Local resident - exempt")

    # Check nationality
    if visitor_info.nationality == park.country:
        fee = park.get_fee("national")
        return ("national", fee, f"National of {park.country}")
    else:
        fee = park.get_fee("tourist")
        return ("tourist", fee, "Foreign tourist")


def is_local_resident(visitor_info, park):
    """Check if visitor is a local resident of park area."""
    local_municipalities = park.config.get("local_municipalities", [])
    return visitor_info.municipality in local_municipalities
```

**Handling Mixed Groups:**

A typical boat might have:
- 8 foreign tourists (120 MXN each = 960 MXN)
- 2 Mexican nationals (60 MXN each = 120 MXN)
- 1 local divemaster (exempt)
- 1 child (exempt)

Total fees to collect: 1,080 MXN

```
Trip: Two-Tank Morning - Jan 15, 2026
Park: Puerto Morelos National Park

VISITOR MANIFEST:
─────────────────────────────────────────────────────────────
 # │ Name              │ Category  │ Fee    │ Bracelet │ Paid
───┼───────────────────┼───────────┼────────┼──────────┼──────
 1 │ John Smith        │ Tourist   │ 120.00 │ A-4521   │ ✓
 2 │ Jane Smith        │ Tourist   │ 120.00 │ A-4522   │ ✓
 3 │ Hans Mueller      │ Tourist   │ 120.00 │ A-4523   │ ✓
 4 │ Yuki Tanaka       │ Tourist   │ 120.00 │ A-4524   │ ✓
 5 │ Pierre Dubois     │ Tourist   │ 120.00 │ A-4525   │ ✓
 6 │ Maria Costa       │ Tourist   │ 120.00 │ A-4526   │ ✓
 7 │ Tom Wilson        │ Tourist   │ 120.00 │ A-4527   │ ✓
 8 │ Lisa Wilson       │ Tourist   │ 120.00 │ A-4528   │ ✓
 9 │ Carlos Hernández  │ National  │  60.00 │ B-2201   │ ✓
10 │ Ana García        │ National  │  60.00 │ B-2202   │ ✓
11 │ Miguel (DM)       │ Local     │   0.00 │ ---      │ N/A
12 │ Tommy Wilson (8)  │ Child     │   0.00 │ ---      │ N/A
───┴───────────────────┴───────────┴────────┴──────────┴──────
                               TOTAL: 1,080.00 MXN
─────────────────────────────────────────────────────────────
```

---

**Bracelet Management**

Many parks use physical bracelets as proof of payment:

```
BraceletInventory
├── park_id
├── color (often indicates category or date)
├── series_prefix ("A-", "B-", etc.)
├── start_number
├── end_number
├── received_date
├── received_quantity
├── issued_count
├── remaining_count
├── cost_per_bracelet (what you pay park)
├── is_active
└── notes

BraceletIssuance
├── bracelet_inventory_id
├── bracelet_number ("A-4521")
├── park_visit_id
├── issued_date
├── issued_by (staff)
├── status (issued, voided, returned)
└── void_reason (if voided)
```

**Bracelet Workflow:**

```
1. INVENTORY RECEIPT
   Receive batch of bracelets from park office
   → Record: 500 bracelets, A-4001 through A-4500
   → Pay deposit or purchase price

2. DAILY PREPARATION
   Before trips, prepare bracelet allocation:
   → Morning trip: 12 divers expected, pull 12 bracelets
   → Note starting numbers for the day

3. ON-SITE ISSUANCE
   At check-in or on boat:
   → Verify visitor category
   → Collect fee (or note if prepaid)
   → Issue bracelet
   → Record bracelet number to visitor

4. RECONCILIATION
   End of day:
   → Count remaining bracelets
   → Match issued bracelets to visitor records
   → Investigate any discrepancies
   → Deposit collected fees

5. REORDER
   When inventory low:
   → Request new batch from park
   → Receive and record new series
```

---

**Permit Renewal Reports**

When renewing permits, parks typically require:

**Visitor Summary Report:**

```
PARQUE NACIONAL ARRECIFE DE PUERTO MORELOS
INFORME DE VISITANTES / VISITOR REPORT

Operador: Blue Reef Divers S.A. de C.V.
Permiso: PNAPM-2024-0042
Período: Enero 2025 - Diciembre 2025

RESUMEN POR CATEGORÍA / SUMMARY BY CATEGORY:
─────────────────────────────────────────────────────────────
Categoría          │ Cantidad │ Ingresos    │ % del Total
───────────────────┼──────────┼─────────────┼─────────────
Turistas Extranj.  │    2,847 │ $341,640.00 │    71.2%
Nacionales         │      892 │  $53,520.00 │    22.3%
Residentes Locales │      156 │       $0.00 │     3.9%
Menores (≤12)      │      105 │       $0.00 │     2.6%
───────────────────┼──────────┼─────────────┼─────────────
TOTAL              │    4,000 │ $395,160.00 │   100.0%
─────────────────────────────────────────────────────────────

RESUMEN POR MES / MONTHLY SUMMARY:
─────────────────────────────────────────────────────────────
Mes        │ Visitas │ Turistas │ Nacion. │ Locales │ Menores
───────────┼─────────┼──────────┼─────────┼─────────┼─────────
Enero      │     287 │      198 │      62 │      15 │      12
Febrero    │     342 │      251 │      68 │      12 │      11
Marzo      │     456 │      342 │      82 │      18 │      14
Abril      │     398 │      289 │      76 │      19 │      14
Mayo       │     312 │      218 │      71 │      14 │       9
Junio      │     278 │      187 │      68 │      12 │      11
Julio      │     389 │      285 │      74 │      17 │      13
Agosto     │     356 │      262 │      72 │      13 │       9
Septiembre │     245 │      168 │      58 │      11 │       8
Octubre    │     298 │      208 │      69 │      12 │       9
Noviembre  │     356 │      261 │      71 │      14 │      10
Diciembre  │     423 │      318 │      81 │      17 │       7
───────────┼─────────┼──────────┼─────────┼─────────┼─────────
TOTAL      │   4,000 │    2,847 │     892 │     156 │     105
─────────────────────────────────────────────────────────────

SITIOS VISITADOS / SITES VISITED:
─────────────────────────────────────────────────────────────
Sitio                    │ Visitas │ % del Total
─────────────────────────┼─────────┼─────────────
Jardín de Rosa          │   1,245 │    31.1%
El Puente               │     987 │    24.7%
Cuevones                │     756 │    18.9%
La Bocana               │     623 │    15.6%
Otros sitios            │     389 │     9.7%
─────────────────────────┼─────────┼─────────────
TOTAL                   │   4,000 │   100.0%
─────────────────────────────────────────────────────────────

CERTIFICACIÓN:
Certifico que la información presentada es verídica y completa.

Firma del Representante Legal: _______________________
Nombre: ____________________________________________
Fecha: _____________________________________________
```

**Report Generation:**

```python
def generate_park_report(park_id, start_date, end_date, format="pdf"):
    """
    Generate visitor report for park permit renewal.
    """
    visits = ParkVisit.objects.filter(
        park_id=park_id,
        visit_date__gte=start_date,
        visit_date__lte=end_date,
    )

    # Aggregate by category
    by_category = visits.values('visitor_category').annotate(
        count=Count('id'),
        total_fees=Sum('fee_amount'),
    )

    # Aggregate by month
    by_month = visits.annotate(
        month=TruncMonth('visit_date')
    ).values('month').annotate(
        total=Count('id'),
        tourists=Count('id', filter=Q(visitor_category='tourist')),
        nationals=Count('id', filter=Q(visitor_category='national')),
        locals=Count('id', filter=Q(visitor_category='local')),
        children=Count('id', filter=Q(visitor_category='child')),
    ).order_by('month')

    # Aggregate by site
    by_site = visits.values(
        'booking__excursion__primary_site__name'
    ).annotate(
        count=Count('id')
    ).order_by('-count')

    return render_report(
        template="park_report",
        format=format,
        data={
            "park": park,
            "period_start": start_date,
            "period_end": end_date,
            "by_category": by_category,
            "by_month": by_month,
            "by_site": by_site,
            "operator": get_operator_info(),
            "permit": get_permit_info(park_id),
        }
    )
```

---

**Fee Collection Workflow**

Options for handling park fees:

**Option 1: Include in Trip Price**
- Add park fee to trip price
- Simpler for customer
- Operator handles fee payment to park
- Risk: Fee changes require price updates

```
Trip Price Breakdown:
- Base trip price: $120 USD
- Park fee (tourist): $6 USD (~120 MXN)
- Equipment rental: $45 USD
- Total: $171 USD

Note: Park fee shown separately on receipt
```

**Option 2: Collect Separately**
- Collect park fee in local currency on day of trip
- More transparent
- Matches actual fee structure
- Easier to handle mixed groups

```
At Check-In:
"Your park entrance fee is 120 pesos (tourist) or 60 pesos
(Mexican national). We accept cash or card. Children 12
and under are exempt."
```

**Option 3: Pre-Collect with Booking**
- Collect estimated fees at booking
- Adjust at check-in if category differs
- Better cash flow
- Requires refund process for exemptions

**Fee Reconciliation:**

```
Daily Park Fee Reconciliation:
─────────────────────────────────────────────────────────────
Date: January 15, 2026
Park: Puerto Morelos NP

Morning Trip:
- Tourists (8): 8 × 120 = 960 MXN
- Nationals (2): 2 × 60 = 120 MXN
- Exempt (2): 0 MXN
Subtotal: 1,080 MXN

Afternoon Trip:
- Tourists (6): 6 × 120 = 720 MXN
- Nationals (4): 4 × 60 = 240 MXN
- Exempt (0): 0 MXN
Subtotal: 960 MXN

DAILY TOTAL COLLECTED: 2,040 MXN
BRACELETS ISSUED: 20

Verified by: Maria (Staff)
Deposited to: Park fee account
─────────────────────────────────────────────────────────────
```

---

**Multi-Park Operations**

Operators in areas with multiple parks need consolidated tracking:

```
Parks Served:
1. Parque Nacional Arrecife de Puerto Morelos
2. Parque Nacional Costa Occidental de Isla Mujeres
3. Área de Protección de Flora y Fauna Manglares de Nichupté

Each has:
- Different fee structures
- Different permit requirements
- Different reporting schedules
- Different bracelet systems

Software must:
- Track visits per park
- Generate reports per park
- Manage separate bracelet inventories
- Calculate fees per park's rules
- Consolidate for operator overview
```

---

**Compliance Dashboard**

At-a-glance compliance status:

```
PARK COMPLIANCE DASHBOARD
─────────────────────────────────────────────────────────────

PERMIT STATUS:
┌─────────────────────────┬──────────┬─────────────┬─────────┐
│ Park                    │ Status   │ Expires     │ Action  │
├─────────────────────────┼──────────┼─────────────┼─────────┤
│ Puerto Morelos NP       │ ✓ Active │ Mar 15 2026 │ ---     │
│ Isla Mujeres NP         │ ⚠ Renew  │ Jan 31 2026 │ URGENT  │
│ Manglares Nichupté      │ ✓ Active │ Jun 30 2026 │ ---     │
└─────────────────────────┴──────────┴─────────────┴─────────┘

BRACELET INVENTORY:
┌─────────────────────────┬──────────┬──────────┬────────────┐
│ Park                    │ On Hand  │ Low Alert│ Reorder    │
├─────────────────────────┼──────────┼──────────┼────────────┤
│ Puerto Morelos (A)      │      234 │      100 │ ---        │
│ Puerto Morelos (B)      │       45 │       50 │ ⚠ REORDER │
│ Isla Mujeres            │      312 │      100 │ ---        │
└─────────────────────────┴──────────┴──────────┴────────────┘

PENDING REPORTS:
┌─────────────────────────┬──────────────┬─────────────────────┐
│ Park                    │ Report Type  │ Due Date            │
├─────────────────────────┼──────────────┼─────────────────────┤
│ Isla Mujeres NP         │ Annual       │ Jan 20 2026 (15d)   │
│ Puerto Morelos NP       │ Quarterly    │ Feb 15 2026 (41d)   │
└─────────────────────────┴──────────────┴─────────────────────┘

MONTHLY FEES COLLECTED:
This Month (Jan 2026): 42,360 MXN
├─ Puerto Morelos: 28,440 MXN
├─ Isla Mujeres: 12,120 MXN
└─ Manglares: 1,800 MXN
─────────────────────────────────────────────────────────────
```

---

**Audit Preparedness**

Park authorities may audit at any time. Be ready:

**Records to Maintain:**
- Complete visitor logs (name, category, fee, date)
- Bracelet issuance records
- Fee collection receipts
- Deposit records to park
- Copies of all submitted reports
- Permit documents
- Staff training records (park rules)

**Retention Period:**
- Typically 5 years minimum
- Check specific park requirements
- Digital records with backup
- Paper receipts scanned and archived

**Audit Response:**

```python
def generate_audit_package(park_id, audit_period):
    """
    Generate complete audit package for park inspection.
    """
    return {
        "permit_documents": get_permit_docs(park_id),
        "visitor_log": export_visitor_log(park_id, audit_period),
        "fee_reconciliation": export_fee_records(park_id, audit_period),
        "bracelet_inventory": export_bracelet_records(park_id, audit_period),
        "submitted_reports": get_submitted_reports(park_id, audit_period),
        "staff_certifications": get_staff_training_records(),
        "daily_manifests": export_trip_manifests(park_id, audit_period),
    }
```

---

**Implementation Checklist:**

```
Phase 1: Park Configuration
□ Set up park records (fees, requirements, contacts)
□ Enter current permit information
□ Configure fee structures per category
□ Set up bracelet inventory tracking
□ Define report templates and schedules

Phase 2: Visit Tracking
□ Add visitor category to booking/check-in flow
□ Build fee calculation logic
□ Implement bracelet assignment
□ Create daily manifest generation
□ Add fee collection tracking

Phase 3: Reporting
□ Build permit renewal report generator
□ Create monthly/quarterly summary reports
□ Implement site visit analysis
□ Add nationality breakdown reports
□ Generate audit packages on demand

Phase 4: Compliance Monitoring
□ Build permit expiration alerts
□ Add bracelet reorder warnings
□ Create report due date reminders
□ Implement fee reconciliation checks
□ Build compliance dashboard

Phase 5: Integration
□ Connect park visits to bookings
□ Link fees to financial tracking
□ Include in customer receipts
□ Add to trip manifests
□ Sync with audit logging
```

---

### 1.2.12 Loyalty Programs and Rewards

Repeat customers are the lifeblood of dive operations. A well-designed loyalty program turns one-time visitors into regulars, advocates, and community members.

**Why Loyalty Programs Work for Dive Shops:**

```
TYPICAL CUSTOMER JOURNEY WITHOUT LOYALTY:
─────────────────────────────────────────────────────────────
Visit 1: Tourist books dive → Has great experience → Leaves
Visit 2: Returns next year → Might book with you, might not
         → No relationship maintained between visits
         → No incentive to choose you over competitors
─────────────────────────────────────────────────────────────

WITH LOYALTY PROGRAM:
─────────────────────────────────────────────────────────────
Visit 1: Tourist books dive → Earns 120 points → Gets member card
         → Receives "Welcome to the family" email
         → Added to newsletter (dive tips, local news)

Between visits:
         → Monthly email keeps you top of mind
         → Birthday discount offer
         → "We miss you" message at 6 months

Visit 2: Returns → "Welcome back!" recognition
         → Uses points for free nitrox upgrade
         → Earns more points → Hits Silver tier
         → Books 3 more dives this trip

Year 2+: → Loyal customer, books exclusively with you
         → Refers friends (earns referral bonus)
         → Becomes brand advocate on social media
─────────────────────────────────────────────────────────────
```

**Loyalty Program Models:**

**1. Points-Based Program**

```
EARNING POINTS:
─────────────────────────────────────────────────────────────
Activity                     │ Points Earned
────────────────────────────┼────────────────────────────────
Book a dive (per $1 spent)  │ 1 point
Complete certification      │ 100 bonus points
Refer a friend (who books)  │ 200 points
Write a review              │ 50 points
Book on your birthday       │ 2x points
Early bird booking (7+ days)│ 1.5x points
Off-season booking          │ 2x points
Donate to scholarship fund  │ 2x points on donation
─────────────────────────────────────────────────────────────

REDEEMING POINTS:
─────────────────────────────────────────────────────────────
Reward                      │ Points Required
────────────────────────────┼────────────────────────────────
Free nitrox upgrade         │ 100 points
Equipment rental discount   │ 200 points
Free night dive add-on      │ 500 points
Free 2-tank trip            │ 1,000 points
Donate to scholarship       │ Any amount (1 pt = $0.05)
Exclusive merchandise       │ Varies
Free certification course   │ 3,000 points
Private guide experience    │ 2,500 points
─────────────────────────────────────────────────────────────
```

**2. Tier-Based Program**

```
LOYALTY TIERS:
─────────────────────────────────────────────────────────────
         │           │ Lifetime  │
Tier     │ Icon      │ Spend     │ Benefits
─────────┼───────────┼───────────┼─────────────────────────
Bronze   │ 🥉        │ $0+       │ Earn 1 pt/$1
         │           │           │ Birthday offer
         │           │           │ Newsletter
─────────┼───────────┼───────────┼─────────────────────────
Silver   │ 🥈        │ $500+     │ Earn 1.25 pt/$1
         │           │           │ 10% equipment discount
         │           │           │ Priority booking
         │           │           │ Free nitrox (1/trip)
─────────┼───────────┼───────────┼─────────────────────────
Gold     │ 🥇        │ $1,500+   │ Earn 1.5 pt/$1
         │           │           │ 15% all discounts
         │           │           │ Free equipment rental
         │           │           │ Exclusive events invite
         │           │           │ Dedicated concierge
─────────┼───────────┼───────────┼─────────────────────────
Platinum │ 💎        │ $5,000+   │ Earn 2 pt/$1
         │           │           │ 20% all discounts
         │           │           │ All Gold benefits
         │           │           │ Annual free trip
         │           │           │ Private experiences
         │           │           │ Bring a friend free (1/yr)
─────────────────────────────────────────────────────────────
```

**3. Dive Count Recognition**

```
DIVE MILESTONES:
─────────────────────────────────────────────────────────────
Dives with Us  │ Recognition
───────────────┼─────────────────────────────────────────────
10 dives       │ "Regular Diver" badge, 10% off next trip
25 dives       │ Photo on "Wall of Divers", free shirt
50 dives       │ "50 Club" membership, free night dive
100 dives      │ Lifetime 15% discount, name on boat plaque
200 dives      │ Honorary staff status, free annual pass
─────────────────────────────────────────────────────────────
```

---

**Loyalty Data Model:**

```
LoyaltyProgram
├── id
├── name ("Blue Reef Rewards")
├── points_name ("Reef Points")
├── points_per_dollar
├── points_expiry_months (null = never expire)
├── tier_calculation (spend, points, dives)
├── is_active
└── created_at

LoyaltyTier
├── program_id
├── name ("Bronze", "Silver", "Gold", "Platinum")
├── threshold (minimum to qualify)
├── points_multiplier (1.0, 1.25, 1.5, 2.0)
├── discount_percent
├── benefits (JSON - list of perks)
├── icon/badge
├── sort_order
└── is_active

CustomerLoyalty
├── customer_id
├── program_id
├── current_tier_id
├── lifetime_points_earned
├── current_points_balance
├── lifetime_spend
├── dive_count
├── joined_at
├── tier_qualified_at
├── tier_expires_at (if tiers expire)
└── notes

PointsTransaction
├── customer_loyalty_id
├── transaction_type (earn, redeem, expire, adjust)
├── points
├── balance_after
├── booking_id (if earned from booking)
├── reward_id (if redeemed for reward)
├── description
├── created_at
├── expires_at
└── expired_at

Reward
├── program_id
├── name ("Free Nitrox Upgrade")
├── description
├── points_cost
├── reward_type (discount, freebie, upgrade, donation)
├── value (monetary equivalent)
├── terms (restrictions, blackout dates, etc.)
├── is_active
├── limited_quantity (null = unlimited)
├── quantity_remaining
└── created_at

RewardRedemption
├── reward_id
├── customer_loyalty_id
├── points_used
├── booking_id (if applied to booking)
├── redeemed_at
├── used_at
├── status (pending, used, expired, cancelled)
└── notes
```

---

**Referral Program:**

Turn loyal customers into sales team:

```
REFERRAL REWARDS:
─────────────────────────────────────────────────────────────

REFERRER GETS:            REFEREE GETS:
├─ 200 points when        ├─ 10% off first booking
│  friend books           │
├─ 100 bonus if friend    ├─ 50 bonus points on
│  returns within 90d     │  first dive completion
├─ $50 credit if friend   │
│  completes certification│
└─ Tier credit toward     └─ Auto-enrolled in
   next level                loyalty program

TRACKING:
─────────────────────────────────────────────────────────────
Referral
├── referrer_customer_id
├── referee_email
├── referral_code ("JOHN2025")
├── sent_at
├── clicked_at
├── converted_at (booking made)
├── booking_id
├── referrer_reward_issued
├── referee_discount_applied
└── status (pending, clicked, converted, rewarded)
─────────────────────────────────────────────────────────────
```

**Easy Sharing:**

```
[Your Referral Link]
bluereefdivers.com/ref/JOHN2025

Share via: [Email] [WhatsApp] [Facebook] [Copy Link]

"Invite friends to dive with us! They get 10% off,
 you get 200 points. Win-win!"

YOUR REFERRAL STATS:
├─ Links shared: 12
├─ Friends clicked: 8
├─ Friends booked: 3
├─ Points earned: 600
└─ Friends' value: $360
```

---

**Integration with Donations:**

Let customers donate their points:

```
POINTS → SCHOLARSHIP FUND
─────────────────────────────────────────────────────────────

"Donate your points to help locals dive!"

Your balance: 847 points

[Donate 100 pts] → Funds 1 local fun dive
[Donate 500 pts] → Funds Discovery Scuba experience
[Donate All]     → Maximum impact

Your donation: 500 points = $25 to scholarship fund

Matching: Shop matches point donations 50%!
          Your 500 pts + 250 match = $37.50 for scholarships

[Confirm Donation]
─────────────────────────────────────────────────────────────
```

```python
def donate_points_to_scholarship(customer_loyalty, points):
    """Convert loyalty points to scholarship donation."""

    # Points have monetary value
    points_value = points * program.points_to_dollar_ratio  # e.g., 0.05

    # Shop matching
    match_amount = points_value * program.donation_match_percent

    total_donation = points_value + match_amount

    # Deduct points
    PointsTransaction.objects.create(
        customer_loyalty=customer_loyalty,
        transaction_type="redeem",
        points=-points,
        balance_after=customer_loyalty.current_points_balance - points,
        description=f"Donated to scholarship fund",
    )

    customer_loyalty.current_points_balance -= points
    customer_loyalty.save()

    # Create scholarship donation
    ScholarshipDonation.objects.create(
        program=get_scholarship_program(),
        donor=customer_loyalty.customer,
        amount=total_donation,
        donation_type="points_conversion",
        notes=f"Converted {points} points + ${match_amount} shop match",
    )

    return total_donation
```

---

**Gamification Elements:**

Make earning points fun:

```
ACHIEVEMENTS:
─────────────────────────────────────────────────────────────
🌅 Early Bird      - Book 3 trips 7+ days in advance
🌙 Night Owl       - Complete 5 night dives
📸 Social Star     - Share 10 posts tagging us
🎓 Scholar         - Complete 3 certification courses
🌊 Reef Regular    - Dive 20 times in one year
🤝 Community Hero  - Donate to scholarship 5 times
👥 Crew Builder    - Refer 5 friends who book
🏆 Century Club    - Complete 100 dives with us
─────────────────────────────────────────────────────────────

Each achievement unlocks:
• Badge on profile
• One-time point bonus (50-500 points)
• Special perks (e.g., Night Owl gets free glow stick)
```

**Challenges:**

```
MONTHLY CHALLENGE: January 2026
─────────────────────────────────────────────────────────────
"New Year, New Depths"

Complete 3 dives in January to earn:
├─ 100 bonus points
├─ Entry into gear raffle
└─ "2026 First Divers" badge

Your progress: ██████░░░░ 2/3 dives

[Book Now to Complete Challenge]
─────────────────────────────────────────────────────────────
```

---

**Member Recognition:**

```
AT CHECK-IN:
─────────────────────────────────────────────────────────────
System alerts staff:

🥇 GOLD MEMBER ARRIVING

John Smith - Gold tier, 47 dives with us
└─ Preferences: Size L wetsuit, hates cold water
└─ Last visit: 3 months ago
└─ Note: Prefers afternoon trips

Suggested actions:
□ "Welcome back, John!"
□ Offer free nitrox (Gold perk)
□ Mention new dive site since last visit
─────────────────────────────────────────────────────────────

ON MILESTONE:
─────────────────────────────────────────────────────────────
DIVE #50 ALERT!

Sarah Johnson just completed her 50th dive with us!

□ Take celebration photo
□ Present "50 Club" certificate
□ Award 500 bonus points
□ Offer complimentary drink
□ Update wall of fame
─────────────────────────────────────────────────────────────
```

---

**Loyalty Analytics:**

```
LOYALTY PROGRAM DASHBOARD
─────────────────────────────────────────────────────────────

PROGRAM HEALTH:
├─ Active members: 1,247
├─ This month enrollments: 89
├─ Points issued (MTD): 45,670
├─ Points redeemed (MTD): 12,340
├─ Redemption rate: 27%
├─ Average member value: $847/year

TIER DISTRIBUTION:
├─ Platinum: 23 (2%)     │ ████████████████████████████████
├─ Gold: 156 (13%)       │ ████████████████████████████
├─ Silver: 412 (33%)     │ ████████████████████████
└─ Bronze: 656 (52%)     │ ████████████████████

TOP MEMBERS (Lifetime):
1. John Smith      │ $12,450 │ 234 dives │ Platinum
2. Sarah Johnson   │ $8,920  │ 156 dives │ Platinum
3. Mike Williams   │ $7,340  │ 98 dives  │ Gold

POINTS LIABILITY:
Outstanding points: 234,567
Estimated $ value: $11,728
(if all redeemed at current rates)

REFERRAL PERFORMANCE:
├─ Active referrers: 89
├─ Referrals converted (MTD): 23
├─ Revenue from referrals (MTD): $2,760
├─ Top referrer: John Smith (7 referrals)
─────────────────────────────────────────────────────────────
```

---

**Implementation Checklist:**

```
Phase 1: Program Design
□ Define points earning structure
□ Design tier system and benefits
□ Set point expiration policy
□ Create reward catalog
□ Plan referral incentives

Phase 2: Core Build
□ Implement loyalty data models
□ Build points earning engine
□ Create tier calculation logic
□ Add rewards redemption flow
□ Integrate with booking system

Phase 3: Customer Experience
□ Build member dashboard
□ Add points display on receipts
□ Create tier status emails
□ Build referral sharing tools
□ Design achievement system

Phase 4: Staff Tools
□ Member lookup at check-in
□ Manual points adjustments
□ Milestone alerts and prompts
□ Override and exception handling
□ Loyalty reports and analytics

Phase 5: Integration
□ Connect to scholarship donations
□ Sync with pricing/discounts
□ Add to customer communications
□ Enable points for gift cards
□ Build partner point sharing (future)
```

---

### 1.2.13 Gift Cards and Vouchers

Gift cards turn your services into giftable products. They're perfect for dive experiences—memorable, experiential gifts that create new customers.

**Why Gift Cards Matter:**

```
GIFT CARD ECONOMICS:
─────────────────────────────────────────────────────────────
• 10-15% of gift cards are never redeemed ("breakage")
  → Pure profit on unredeemed balance

• Gift recipients often spend MORE than card value
  → Average overspend: 20-40% above card value

• Creates new customers
  → Gift giver may not be a diver, but recipient becomes one

• Guaranteed future revenue
  → Cash today, service later

• Holiday/birthday revenue spike
  → Predictable seasonal boost (Dec, Mother's/Father's Day)
─────────────────────────────────────────────────────────────
```

**Types of Gift Products:**

```
GIFT CARD TYPES:
─────────────────────────────────────────────────────────────
Type              │ Value        │ Use Case
──────────────────┼──────────────┼───────────────────────────
Monetary Card     │ $50, $100,   │ Flexible spending
                  │ $200, custom │ on any service
──────────────────┼──────────────┼───────────────────────────
Experience Card   │ Fixed        │ Specific experience:
                  │              │ "Two-Tank Morning Dive"
                  │              │ "Discover Scuba"
                  │              │ "Open Water Course"
──────────────────┼──────────────┼───────────────────────────
Package Card      │ Bundle       │ "Dive & Dine Package"
                  │              │ "Certification Bundle"
                  │              │ "Weekend Warrior (3 dives)"
──────────────────┼──────────────┼───────────────────────────
Voucher/Promo     │ Discount %   │ "20% off any dive"
                  │ or $ off     │ "$25 off certification"
                  │              │ "Free equipment rental"
──────────────────┼──────────────┼───────────────────────────
Refund Credit     │ Exact amount │ Store credit for
                  │              │ cancelled bookings
──────────────────┼──────────────┼───────────────────────────
Corporate/Group   │ Bulk         │ Company incentives
                  │              │ Team building events
                  │              │ Wedding party gifts
─────────────────────────────────────────────────────────────
```

---

**Gift Card Data Model:**

```
GiftCard
├── id (UUID)
├── code (unique redemption code: "GC-ABCD-1234-EFGH")
├── card_type (monetary, experience, package, voucher, credit)
├── original_value
├── current_balance
├── currency
├── experience_type_id (if experience card)
├── package_id (if package card)
├── discount_type (if voucher: percent, fixed)
├── discount_value (if voucher)
├── purchaser_id (who bought it)
├── purchaser_name (if purchased by non-customer)
├── purchaser_email
├── recipient_name
├── recipient_email
├── personal_message
├── purchased_at
├── delivered_at (email sent)
├── delivery_method (email, print, physical)
├── first_used_at
├── fully_redeemed_at
├── expires_at
├── status (active, partially_used, redeemed, expired, cancelled)
├── is_refund_credit (true if issued for cancellation)
├── original_booking_id (if refund credit)
├── notes
├── created_at
└── updated_at

GiftCardTransaction
├── gift_card_id
├── transaction_type (purchase, redeem, refund, expire, adjust)
├── amount
├── balance_after
├── booking_id (if redemption)
├── processed_by (staff)
├── notes
└── created_at

GiftCardDesign
├── id
├── name ("Ocean Blue", "Birthday Bubbles", "Holiday Reef")
├── occasion (birthday, holiday, thank_you, general)
├── image_url
├── is_active
└── sort_order
```

---

**Purchase Flow:**

```
CUSTOMER GIFT CARD PURCHASE:
─────────────────────────────────────────────────────────────

Step 1: Choose Type
┌─────────────────────────────────────────────────────────┐
│ GIVE THE GIFT OF DIVING                                 │
│                                                          │
│ ○ Monetary Gift Card                                    │
│   Any amount, use toward any service                    │
│                                                          │
│ ● Experience Gift Card                                  │
│   Gift a specific dive experience                       │
│                                                          │
│ ○ Certification Gift                                    │
│   Fund their diving journey                             │
└─────────────────────────────────────────────────────────┘

Step 2: Select Experience
┌─────────────────────────────────────────────────────────┐
│ CHOOSE AN EXPERIENCE                                     │
│                                                          │
│ [🌅] Two-Tank Morning Dive         $120                 │
│      Perfect for certified divers                       │
│                                                          │
│ [🤿] Discover Scuba Diving         $150                 │
│      No certification needed!                           │
│                                                          │
│ [🌙] Night Dive Adventure          $95                  │
│      Experience the reef after dark                     │
│                                                          │
│ [🎓] Open Water Certification      $450                 │
│      Start their diving journey                         │
└─────────────────────────────────────────────────────────┘

Step 3: Personalize
┌─────────────────────────────────────────────────────────┐
│ PERSONALIZE YOUR GIFT                                    │
│                                                          │
│ Recipient's Name: [John Smith____________]              │
│ Recipient's Email: [john@email.com_______]              │
│                                                          │
│ Personal Message:                                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Happy Birthday! Can't wait to hear about your      │ │
│ │ underwater adventure. Have an amazing dive! 🐠     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                          │
│ Choose Design: [Birthday Bubbles 🎂 ▼]                  │
│                                                          │
│ Delivery: ○ Email Now  ○ Email on Date: [___]          │
│           ○ Print at Home  ○ Mail Physical Card        │
└─────────────────────────────────────────────────────────┘

Step 4: Payment & Confirmation
┌─────────────────────────────────────────────────────────┐
│ ORDER SUMMARY                                            │
│                                                          │
│ Two-Tank Morning Dive Gift Card          $120.00        │
│ Delivery: Email to john@email.com                       │
│                                                          │
│ □ Add $10 to Scholarship Fund                           │
│                                                          │
│                              Total: $120.00             │
│                                                          │
│ [Complete Purchase]                                     │
└─────────────────────────────────────────────────────────┘
─────────────────────────────────────────────────────────────
```

---

**Email Delivery:**

```
┌─────────────────────────────────────────────────────────┐
│                                                          │
│            🎁 YOU'VE RECEIVED A GIFT! 🎁                │
│                                                          │
│     ┌─────────────────────────────────────────────┐     │
│     │                                              │     │
│     │     [Beautiful Gift Card Image]             │     │
│     │                                              │     │
│     │     TWO-TANK MORNING DIVE                   │     │
│     │     at Blue Reef Divers                     │     │
│     │                                              │     │
│     │     Gift Code: GC-ABCD-1234-EFGH           │     │
│     │                                              │     │
│     └─────────────────────────────────────────────┘     │
│                                                          │
│     From: Sarah Smith                                   │
│                                                          │
│     "Happy Birthday! Can't wait to hear about your     │
│      underwater adventure. Have an amazing dive! 🐠"   │
│                                                          │
│     ─────────────────────────────────────────────       │
│                                                          │
│     This gift card is valid for:                        │
│     • One Two-Tank Morning Dive ($120 value)           │
│     • Valid for 12 months from purchase                │
│     • Book online or call us to redeem                 │
│                                                          │
│              [BOOK YOUR DIVE NOW]                       │
│                                                          │
│     Questions? Contact us:                              │
│     📞 +52 987 123 4567                                │
│     ✉️ info@bluereefdivers.com                         │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

**Redemption Flow:**

```python
def redeem_gift_card(code, booking, amount=None):
    """
    Redeem gift card toward a booking.
    """
    gift_card = GiftCard.objects.get(code=code.upper())

    # Validate
    if gift_card.status == "expired":
        raise GiftCardExpiredError(f"Card expired on {gift_card.expires_at}")

    if gift_card.status == "redeemed":
        raise GiftCardAlreadyUsedError("Card has been fully redeemed")

    if gift_card.current_balance <= 0:
        raise GiftCardEmptyError("Card has no remaining balance")

    # Determine redemption amount
    if gift_card.card_type == "experience":
        # Experience cards must match experience type
        if booking.excursion.excursion_type_id != gift_card.experience_type_id:
            raise GiftCardMismatchError(
                f"This card is only valid for {gift_card.experience_type.name}"
            )
        redeem_amount = gift_card.current_balance  # Full value

    elif gift_card.card_type == "voucher":
        # Apply discount
        if gift_card.discount_type == "percent":
            redeem_amount = booking.subtotal * (gift_card.discount_value / 100)
        else:
            redeem_amount = min(gift_card.discount_value, booking.total_due)

    else:  # Monetary or credit
        # Redeem up to balance or booking total
        redeem_amount = amount or min(gift_card.current_balance, booking.total_due)

    # Apply to booking
    booking.gift_card_applied = redeem_amount
    booking.total_due -= redeem_amount
    booking.save()

    # Update gift card
    gift_card.current_balance -= redeem_amount

    if gift_card.first_used_at is None:
        gift_card.first_used_at = timezone.now()

    if gift_card.current_balance <= 0:
        gift_card.status = "redeemed"
        gift_card.fully_redeemed_at = timezone.now()
    else:
        gift_card.status = "partially_used"

    gift_card.save()

    # Log transaction
    GiftCardTransaction.objects.create(
        gift_card=gift_card,
        transaction_type="redeem",
        amount=redeem_amount,
        balance_after=gift_card.current_balance,
        booking=booking,
    )

    return {
        "applied": redeem_amount,
        "remaining_balance": gift_card.current_balance,
        "booking_total_due": booking.total_due,
    }
```

---

**Vouchers and Promo Codes:**

```
VOUCHER TYPES:
─────────────────────────────────────────────────────────────
Type            │ Example           │ Use Case
────────────────┼───────────────────┼─────────────────────────
Percentage Off  │ SUMMER20 (20%)    │ Seasonal promotion
Fixed Amount    │ WELCOME25 ($25)   │ New customer discount
Free Add-On     │ FREENITROX        │ Upsell incentive
Free Experience │ FREENIGHT         │ Loyalty reward
BOGO            │ BOGO2024          │ Bring a friend promo
Partner         │ HOTELXYZ15        │ Hotel partner discount
Influencer      │ DIVERJANE         │ Affiliate tracking
Event           │ DIVESHOW10        │ Trade show special
Referral        │ REF-JOHN2025      │ Customer referral
─────────────────────────────────────────────────────────────

VOUCHER RESTRICTIONS:
─────────────────────────────────────────────────────────────
Voucher
├── code (unique, case-insensitive)
├── discount_type (percent, fixed, free_item, bogo)
├── discount_value
├── free_item_id (if free_item type)
├── min_purchase (minimum booking value)
├── max_discount (cap on percentage discounts)
├── valid_products (all, or specific list)
├── valid_days (all, weekdays, weekends, specific dates)
├── blackout_dates (holidays, peak season)
├── valid_from
├── valid_until
├── usage_limit (total uses allowed)
├── usage_count (current uses)
├── per_customer_limit (uses per customer)
├── first_time_only (new customers only)
├── stackable (can combine with other discounts?)
├── attribution_source (where voucher came from)
├── is_active
└── notes
─────────────────────────────────────────────────────────────
```

**Voucher Validation:**

```python
def validate_voucher(code, booking, customer):
    """
    Validate voucher is applicable to booking.
    Returns (valid, discount_amount, message)
    """
    try:
        voucher = Voucher.objects.get(code=code.upper(), is_active=True)
    except Voucher.DoesNotExist:
        return (False, 0, "Invalid voucher code")

    # Check dates
    now = timezone.now()
    if voucher.valid_from and now < voucher.valid_from:
        return (False, 0, "Voucher not yet active")
    if voucher.valid_until and now > voucher.valid_until:
        return (False, 0, "Voucher has expired")

    # Check blackout dates
    if booking.excursion.date in voucher.blackout_dates:
        return (False, 0, "Voucher not valid on this date")

    # Check usage limits
    if voucher.usage_limit and voucher.usage_count >= voucher.usage_limit:
        return (False, 0, "Voucher usage limit reached")

    # Check per-customer limit
    customer_uses = VoucherUsage.objects.filter(
        voucher=voucher, customer=customer
    ).count()
    if voucher.per_customer_limit and customer_uses >= voucher.per_customer_limit:
        return (False, 0, "You've already used this voucher")

    # Check first-time only
    if voucher.first_time_only:
        if Booking.objects.filter(diver=customer).exists():
            return (False, 0, "Voucher only valid for first-time customers")

    # Check minimum purchase
    if voucher.min_purchase and booking.subtotal < voucher.min_purchase:
        return (False, 0, f"Minimum purchase of ${voucher.min_purchase} required")

    # Check valid products
    if voucher.valid_products:
        if booking.excursion.excursion_type_id not in voucher.valid_products:
            return (False, 0, "Voucher not valid for this experience")

    # Calculate discount
    if voucher.discount_type == "percent":
        discount = booking.subtotal * (voucher.discount_value / 100)
        if voucher.max_discount:
            discount = min(discount, voucher.max_discount)
    elif voucher.discount_type == "fixed":
        discount = min(voucher.discount_value, booking.subtotal)
    else:
        discount = voucher.discount_value

    return (True, discount, f"Voucher applied: ${discount:.2f} off")
```

---

**Refund Credits:**

When customers cancel, offer store credit instead of refunds:

```
CANCELLATION OPTIONS:
─────────────────────────────────────────────────────────────

Your booking: Two-Tank Morning Dive - Jan 15, 2026
Total paid: $120.00

Cancellation options:

○ Full Refund to Original Payment
  $120.00 back to your card
  Processing time: 5-10 business days

● Store Credit (Recommended) ✨
  $132.00 credit (10% bonus!)
  Use anytime in next 24 months
  Never expires if used within 24 months
  Transferable to friends/family

○ Reschedule
  Move to a different date (no fee)

[Confirm Cancellation]
─────────────────────────────────────────────────────────────
```

```python
def issue_refund_credit(booking, bonus_percent=10):
    """
    Issue store credit for cancelled booking with bonus incentive.
    """
    base_amount = booking.amount_paid
    bonus = base_amount * (Decimal(bonus_percent) / 100)
    total_credit = base_amount + bonus

    credit = GiftCard.objects.create(
        code=generate_gift_card_code(),
        card_type="credit",
        original_value=total_credit,
        current_balance=total_credit,
        currency=booking.currency,
        purchaser=booking.diver,
        recipient_name=booking.diver.name,
        recipient_email=booking.diver.email,
        is_refund_credit=True,
        original_booking_id=booking.id,
        expires_at=timezone.now() + timedelta(days=730),  # 2 years
        status="active",
    )

    # Link to booking
    booking.refund_credit = credit
    booking.status = "cancelled"
    booking.save()

    # Email customer
    send_refund_credit_email(booking.diver, credit)

    return credit
```

**Why Offer Credit Bonus:**
- Customer gets more value (incentivized to accept)
- You keep the cash (better for cash flow)
- They must return (guaranteed future visit)
- Reduces refund processing fees
- Higher lifetime value

---

**Corporate & Bulk Gift Cards:**

```
CORPORATE GIFT PROGRAM:
─────────────────────────────────────────────────────────────

Perfect for:
• Employee incentives and rewards
• Client appreciation gifts
• Team building events
• Conference attendee gifts
• Wedding party activities

BULK PRICING:
─────────────────────────────────────────────────────────────
Quantity    │ Discount   │ Per $100 Card
────────────┼────────────┼─────────────────────────────────
5-9 cards   │ 5% off     │ $95.00
10-24 cards │ 10% off    │ $90.00
25-49 cards │ 15% off    │ $85.00
50+ cards   │ 20% off    │ $80.00
─────────────────────────────────────────────────────────────

CORPORATE ORDER:
─────────────────────────────────────────────────────────────
Company: Acme Corp
Contact: Jane HR Manager
Order: 25 × $100 Experience Cards

Card Type: Discover Scuba Diving
Delivery: Custom branded cards, shipped to office
Personalization: "Thank you for 5 years of service!"
Logo: Acme Corp logo on card

Subtotal: $2,500.00
Bulk discount (15%): -$375.00
Total: $2,125.00

Payment: Invoice (NET 30)
─────────────────────────────────────────────────────────────
```

---

**Gift Card Accounting:**

```
GIFT CARD LIABILITY TRACKING:
─────────────────────────────────────────────────────────────

MONTHLY REPORT - January 2026

Opening Balance (outstanding gift cards): $12,450

Activity:
├─ New cards sold: +$3,200
├─ Cards redeemed: -$2,840
├─ Cards expired: -$320
├─ Refund credits issued: +$960
└─ Adjustments: $0

Closing Balance: $13,450

BREAKAGE ANALYSIS:
─────────────────────────────────────────────────────────────
Cards expiring this month: 12 cards, $1,140 value
├─ Redeemed before expiry: 8 cards, $820
├─ Expired unredeemed: 4 cards, $320
└─ Breakage rate: 28% (this month)

Lifetime breakage rate: 12%
Lifetime breakage revenue: $8,430
─────────────────────────────────────────────────────────────

AGING REPORT:
─────────────────────────────────────────────────────────────
Age             │ Cards │ Value    │ % of Total
────────────────┼───────┼──────────┼─────────────
< 30 days       │   45  │ $4,280   │ 31.8%
30-90 days      │   38  │ $3,620   │ 26.9%
90-180 days     │   29  │ $2,890   │ 21.5%
180-365 days    │   18  │ $1,940   │ 14.4%
> 365 days      │    8  │ $720     │ 5.4%
────────────────┼───────┼──────────┼─────────────
TOTAL           │  138  │ $13,450  │ 100%
─────────────────────────────────────────────────────────────
```

**Accounting Treatment:**
```
When gift card is SOLD:
  Debit:  Cash                 $100
  Credit: Deferred Revenue     $100
  (Liability until redeemed)

When gift card is REDEEMED:
  Debit:  Deferred Revenue     $100
  Credit: Revenue              $100
  (Now recognized as income)

When gift card EXPIRES (breakage):
  Debit:  Deferred Revenue     $100
  Credit: Other Income         $100
  (Recognized as breakage income)
```

---

**Integration with Loyalty:**

```
POINTS ↔ GIFT CARDS:
─────────────────────────────────────────────────────────────

REDEEM POINTS FOR GIFT CARDS:
"Convert your points to gift cards for friends!"

Your balance: 2,500 points

[1,000 pts] → $50 Gift Card
[2,000 pts] → $100 Gift Card
[2,500 pts] → $125 Gift Card (bonus!)

[Convert Points]

─────────────────────────────────────────────────────────────

EARN POINTS ON GIFT CARD PURCHASES:
"Earn 1 point per $1 when you buy gift cards"

Buying $200 gift card = 200 points earned

─────────────────────────────────────────────────────────────
```

---

**Implementation Checklist:**

```
Phase 1: Core Gift Cards
□ Design gift card data model
□ Build purchase flow (online)
□ Implement code generation
□ Create email delivery templates
□ Build redemption validation
□ Add to booking checkout

Phase 2: Vouchers & Promos
□ Design voucher system
□ Build promo code validation
□ Create usage tracking
□ Add attribution tracking
□ Build admin voucher management

Phase 3: Refund Credits
□ Add credit option to cancellation flow
□ Implement bonus incentive
□ Create credit email templates
□ Track credit vs refund rates
□ Report on credit redemption

Phase 4: Corporate Sales
□ Build bulk order flow
□ Implement volume pricing
□ Create custom branding options
□ Add invoice payment option
□ Build corporate portal

Phase 5: Reporting & Accounting
□ Build liability tracking
□ Create aging reports
□ Implement breakage recognition
□ Add gift card P&L reports
□ Integrate with accounting system

Phase 6: Integration
□ Connect to loyalty points
□ Add to customer dashboard
□ Include in CRM/communications
□ Enable partial redemptions
□ Build transfer functionality
```

---

### 1.2.14 Compliance Calendar and SOP Management

Running a dive operation means juggling dozens of recurring deadlines: permits, licenses, insurance renewals, equipment service schedules, staff certifications, and regulatory filings. Miss one, and you could lose your ability to operate.

**The Problem:**

```
WHAT DIVE SHOPS TRACK (Partial List):
─────────────────────────────────────────────────────────────
PERMITS & LICENSES:
├─ Operating permits (per park/marine reserve)
├─ Business licenses (municipal, state, federal)
├─ Coast guard/maritime authority permits
├─ Boat registrations
├─ Captain's licenses
├─ Divemaster/instructor ratings
├─ First aid/O2 provider certifications

INSURANCE:
├─ Liability insurance
├─ Boat insurance
├─ Workers comp
├─ Equipment coverage
├─ Professional indemnity

EQUIPMENT:
├─ Compressor service
├─ Tank hydrostatic testing (5 years)
├─ Tank visual inspection (annual)
├─ Regulator service (annual)
├─ BCD service
├─ O2 equipment certification
├─ First aid kit restocking
├─ AED inspection

REGULATORY:
├─ Park visitor reports
├─ Tax filings
├─ Employee certifications
├─ Safety inspections
├─ Environmental compliance

CONTRACTS:
├─ Lease renewals
├─ Vendor agreements
├─ Partner contracts
├─ Software subscriptions
─────────────────────────────────────────────────────────────
```

**What Happens When You Miss One:**

```
RISK MATRIX:
─────────────────────────────────────────────────────────────
Item                    │ Miss Deadline           │ Consequence
────────────────────────┼─────────────────────────┼────────────
Park operating permit   │ Expired                 │ SHUT DOWN
Liability insurance     │ Lapsed                  │ SHUT DOWN
Captain's license       │ Expired                 │ Cannot sail
Tank hydro test        │ Overdue                 │ Cannot fill
Instructor rating      │ Lapsed                  │ Cannot teach
Business license       │ Expired                 │ Fines, closure
Park visitor report    │ Late                    │ Permit at risk
Tax filing             │ Late                    │ Penalties
Equipment service      │ Overdue                 │ Safety risk
─────────────────────────────────────────────────────────────
```

---

**Compliance Calendar System:**

```
ComplianceItem
├── id (UUID)
├── category (permit, license, insurance, equipment, regulatory, contract)
├── name ("Puerto Morelos NP Operating Permit")
├── description
├── issuing_authority ("CONANP")
├── reference_number ("PNAPM-2024-0042")
├── current_status (active, pending_renewal, expired, not_applicable)
├── effective_date
├── expiration_date
├── renewal_lead_days (how far in advance to start renewal)
├── renewal_process (text description or link to SOP)
├── renewal_cost
├── auto_renew (true if automatically renews)
├── responsible_person_id
├── backup_person_id
├── documents (uploaded permits, certificates, etc.)
├── notes
├── is_critical (true = operation stops if expired)
├── created_at
└── updated_at

ComplianceReminder
├── compliance_item_id
├── reminder_type (upcoming, due_soon, overdue, renewal_started)
├── days_before_due
├── notification_method (email, sms, dashboard, all)
├── recipients (JSON - list of user IDs)
├── is_active
└── last_sent_at

ComplianceHistory
├── compliance_item_id
├── action (created, renewed, updated, expired, document_uploaded)
├── old_expiration
├── new_expiration
├── performed_by
├── notes
├── documents_added
└── created_at
```

---

**Compliance Dashboard:**

```
COMPLIANCE DASHBOARD - January 2026
═══════════════════════════════════════════════════════════════

🔴 CRITICAL - ACTION REQUIRED (2)
─────────────────────────────────────────────────────────────
│ ⚠️  Puerto Morelos Permit    │ EXPIRES IN 12 DAYS         │
│     Renewal started: No      │ [Start Renewal Process]    │
├──────────────────────────────┼────────────────────────────┤
│ ⚠️  Liability Insurance      │ RENEWAL DUE IN 8 DAYS      │
│     Renewal started: Yes     │ [View Status]              │
─────────────────────────────────────────────────────────────

🟡 UPCOMING (Next 30 Days) (5)
─────────────────────────────────────────────────────────────
│ Tank VIP - Batch #12        │ Due: Jan 28 (23 days)      │
│ Captain Rodriguez License   │ Due: Feb 3 (29 days)       │
│ Q4 Park Report - PM         │ Due: Feb 15 (41 days)      │
│ Compressor Service          │ Due: Feb 20 (46 days)      │
│ First Aid Kits Restock      │ Due: Feb 28 (54 days)      │
─────────────────────────────────────────────────────────────

🟢 COMPLIANT (43 items all current)
─────────────────────────────────────────────────────────────
[View All] [Export Report] [Add New Item]

COMPLIANCE SCORE: 91% (45/47 items current or in process)
─────────────────────────────────────────────────────────────

CALENDAR VIEW:
─────────────────────────────────────────────────────────────
January 2026
Mo Tu We Th Fr Sa Su
       1  2  3  4  5
 6  7  8  9 10 11 12
13 14 15 16 17⚠️18 19   ← 17: Puerto Morelos Permit expires
20 21 22 23 24 25 26
27 28 29 30 31
      ↑
      Tank VIP due

[◀ Dec]                                            [Feb ▶]
═══════════════════════════════════════════════════════════════
```

---

**Automated Reminders:**

```
REMINDER SCHEDULE:
─────────────────────────────────────────────────────────────
Days Before │ Action                    │ Recipients
────────────┼───────────────────────────┼────────────────────
90 days     │ "Renewal window opening"  │ Owner, Manager
60 days     │ "Start renewal process"   │ Owner, Manager
30 days     │ "Renewal due soon"        │ Owner, Manager, Staff
14 days     │ "URGENT: 2 weeks left"    │ All + SMS
7 days      │ "CRITICAL: 1 week left"   │ All + SMS + Call
1 day       │ "EXPIRES TOMORROW"        │ All + SMS + Call
0 days      │ "EXPIRED - ACTION REQ"    │ All + SMS + Call
─────────────────────────────────────────────────────────────

REMINDER EMAIL EXAMPLE:
─────────────────────────────────────────────────────────────
Subject: ⚠️ Puerto Morelos Permit expires in 14 days

Blue Reef Divers Compliance Alert

ITEM: Puerto Morelos National Park Operating Permit
PERMIT #: PNAPM-2024-0042
EXPIRES: January 17, 2026 (14 days)
STATUS: Renewal not yet started

RENEWAL PROCESS:
1. Complete visitor report for current period
2. Gather required documents (insurance, boat reg)
3. Submit renewal application to CONANP office
4. Pay renewal fee (~$X,XXX MXN)
5. Await inspection (if required)
6. Receive new permit

DOCUMENTS NEEDED:
□ Current liability insurance certificate
□ Updated boat registration
□ Visitor statistics report (use attached template)
□ Staff certification list
□ Safety equipment inspection report

[Start Renewal Process] [View Full SOP] [Mark as Started]

If this permit expires, you will NOT be able to operate
in Puerto Morelos National Park.
─────────────────────────────────────────────────────────────
```

---

**Standard Operating Procedures (SOPs):**

Link compliance items to step-by-step renewal procedures:

```
SOP
├── id
├── name ("Puerto Morelos Permit Renewal")
├── category (permit_renewal, equipment_service, safety, operations)
├── linked_compliance_items (which items use this SOP)
├── version
├── last_updated
├── updated_by
├── steps (JSON - ordered list of steps)
├── documents_required (checklist)
├── estimated_duration
├── estimated_cost
├── tips_and_notes
├── contact_info
├── is_active
└── created_at

SOPStep
├── sop_id
├── step_number
├── title
├── description
├── is_required
├── typical_duration
├── responsible_role
├── documents_produced
├── links (URLs to forms, portals, etc.)
└── notes

SOPExecution
├── sop_id
├── compliance_item_id
├── started_at
├── started_by
├── current_step
├── completed_steps (JSON - step numbers + completion dates)
├── notes
├── documents_collected
├── completed_at
├── completed_by
└── status (in_progress, completed, blocked, cancelled)
```

**SOP Detail View:**

```
SOP: PUERTO MORELOS PERMIT RENEWAL
═══════════════════════════════════════════════════════════════
Version: 2.1 | Last Updated: Nov 2025 | By: Maria Garcia
Typical Duration: 2-3 weeks | Est. Cost: $8,500 MXN

STEPS:
─────────────────────────────────────────────────────────────
□ Step 1: Generate Visitor Report (2-3 days)
  └─ Export visitor data from system for permit period
  └─ Format according to CONANP template
  └─ Include: counts by category, sites visited, fees collected
  └─ [Auto-Generate Report]

□ Step 2: Gather Required Documents (1-2 days)
  └─ Current liability insurance certificate
  └─ Boat registration (each vessel)
  └─ Captain licenses (each captain)
  └─ Staff certification list
  └─ Safety equipment inspection log
  └─ [Document Checklist]

□ Step 3: Complete Application Form (1 day)
  └─ Download from CONANP website
  └─ Fill in operator details
  └─ Attach visitor report
  └─ Attach supporting documents
  └─ [Download Form] [Auto-Fill from System]

□ Step 4: Submit Application (1 day)
  └─ Deliver to CONANP office in person
  └─ Address: Av. Juárez #123, Puerto Morelos
  └─ Hours: Mon-Fri 9am-2pm
  └─ Bring: Application, documents, payment
  └─ [Map/Directions]

□ Step 5: Pay Renewal Fee (same day)
  └─ Fee: ~$8,500 MXN (confirm current rate)
  └─ Payment: Cash, bank transfer, or card
  └─ Get receipt - KEEP THIS

□ Step 6: Schedule Inspection (if required) (1-2 weeks)
  └─ Inspector will contact to schedule
  └─ Ensure boats, equipment ready for inspection
  └─ Have all safety equipment accessible
  └─ Staff should know emergency procedures

□ Step 7: Receive New Permit (1-3 days after inspection)
  └─ Pick up from CONANP office
  └─ Verify all details correct
  └─ Scan and upload to system
  └─ Display original on premises

─────────────────────────────────────────────────────────────
TIPS:
• Start 60 days before expiration
• CONANP office closed during holidays
• Inspector usually comes within 1 week of application
• If problems, ask for Maria at the office (she's helpful)

CONTACTS:
• CONANP Puerto Morelos: +52 998 XXX XXXX
• Inspector (current): Juan Hernández
═══════════════════════════════════════════════════════════════
```

---

**Auto-Fill Permit Applications:**

Pre-populate permit applications from system data:

```
PERMIT AUTO-FILL:
─────────────────────────────────────────────────────────────

Generating: Puerto Morelos Permit Renewal Application

Auto-filled from system:
✓ Operator name: Blue Reef Divers S.A. de C.V.
✓ RFC: BRD123456XXX
✓ Address: Calle Marina #45, Puerto Morelos
✓ Legal representative: John Owner
✓ Contact phone: +52 998 123 4567
✓ Contact email: permits@bluereefdivers.com
✓ Previous permit #: PNAPM-2024-0042
✓ Permit expiration: January 17, 2026

Vessels (auto-populated):
✓ Blue Reef I - Reg: PM-1234 - Cap: 18 divers
✓ Blue Reef II - Reg: PM-5678 - Cap: 12 divers

Staff (auto-populated):
✓ 3 Captains (licenses verified current)
✓ 5 Divemasters (ratings verified current)
✓ 2 Instructors (ratings verified current)

Visitor Statistics (auto-generated):
✓ Total visitors: 4,000
✓ By category: Tourists 2,847, Nationals 892, etc.
✓ By month: [attached report]
✓ By site: [attached report]
✓ Fees collected: $395,160 MXN

[Preview Application] [Download PDF] [Print]
─────────────────────────────────────────────────────────────
```

```python
def generate_permit_application(permit_type, compliance_item):
    """
    Auto-generate permit application from system data.
    """
    operator = get_operator_info()

    if permit_type == "park_permit":
        park = compliance_item.park

        # Get visitor stats for permit period
        stats = generate_visitor_statistics(
            park=park,
            start_date=compliance_item.effective_date,
            end_date=compliance_item.expiration_date,
        )

        # Get vessel info
        vessels = Vessel.objects.filter(is_active=True)

        # Get staff certifications
        staff = get_certified_staff()

        # Load permit template
        template = load_permit_template(park.permit_template)

        # Fill template
        filled = template.fill(
            operator=operator,
            vessels=vessels,
            staff=staff,
            statistics=stats,
            previous_permit=compliance_item.reference_number,
        )

        return filled.to_pdf()
```

---

**Bill Payment Tracking:**

Track recurring expenses and payment due dates:

```
RecurringExpense
├── id
├── name ("Liability Insurance Premium")
├── vendor_id
├── category (insurance, rent, utilities, subscriptions, permits, payroll)
├── amount
├── currency
├── frequency (monthly, quarterly, annual, one_time)
├── due_day (day of month/quarter)
├── payment_method (auto_pay, manual, invoice)
├── account_id (bank account for payment)
├── auto_pay_enabled
├── reminder_days (days before due to remind)
├── last_paid_date
├── last_paid_amount
├── next_due_date
├── linked_compliance_item_id
├── notes
├── is_active
└── created_at

PaymentRecord
├── expense_id
├── due_date
├── amount_due
├── amount_paid
├── paid_date
├── payment_method
├── reference_number
├── receipt_document
├── paid_by
├── status (pending, paid, late, partial)
└── notes
```

**Bill Payment Dashboard:**

```
UPCOMING PAYMENTS - January 2026
═══════════════════════════════════════════════════════════════

DUE THIS WEEK:
─────────────────────────────────────────────────────────────
│ Jan 8  │ Dock Rental          │ $2,500   │ Auto-pay ✓    │
│ Jan 10 │ Internet/Phone       │ $189     │ Auto-pay ✓    │
│ Jan 12 │ Equipment Loan       │ $1,200   │ [Pay Now]     │
─────────────────────────────────────────────────────────────

DUE THIS MONTH:
─────────────────────────────────────────────────────────────
│ Jan 15 │ Payroll              │ $12,450  │ Auto-pay ✓    │
│ Jan 20 │ Fuel Account         │ ~$3,200  │ [Pay Now]     │
│ Jan 25 │ Insurance (Quarterly)│ $4,800   │ [Pay Now]     │
│ Jan 31 │ Rent                 │ $3,500   │ Auto-pay ✓    │
─────────────────────────────────────────────────────────────
                              Total Due: ~$27,839

OVERDUE:
─────────────────────────────────────────────────────────────
│ Dec 28 │ Tank Testing Service │ $890     │ 8 days late   │
│        │ Contact: ABC Testing │          │ [Pay Now]     │
─────────────────────────────────────────────────────────────

CASH FLOW FORECAST:
─────────────────────────────────────────────────────────────
Current Balance: $45,230
Upcoming Expenses (30 days): -$27,839
Expected Revenue (30 days): +$38,500
Projected Balance: $55,891
═══════════════════════════════════════════════════════════════
```

---

**Equipment Service Schedules:**

Track equipment maintenance with automated scheduling:

```
EquipmentServiceSchedule
├── equipment_id
├── service_type (visual_inspection, hydro_test, full_service, repair)
├── frequency_months
├── last_service_date
├── next_service_due
├── service_provider_id
├── estimated_cost
├── lead_time_days
├── auto_schedule
├── notes
└── is_active

ServiceRecord
├── equipment_id
├── schedule_id
├── service_type
├── service_date
├── service_provider
├── technician_name
├── findings
├── work_performed
├── parts_replaced
├── cost
├── next_service_due
├── passed_inspection
├── documents (receipts, certificates)
├── performed_by
└── notes
```

**Equipment Service Dashboard:**

```
EQUIPMENT SERVICE STATUS
═══════════════════════════════════════════════════════════════

TANKS (87 total):
─────────────────────────────────────────────────────────────
Status           │ Count │ Action
─────────────────┼───────┼─────────────────────────────────
✓ Current        │   72  │ Good until next VIP/Hydro
⚠ VIP Due (30d)  │    8  │ Schedule visual inspection
🔴 VIP Overdue   │    2  │ PULL FROM SERVICE
⚠ Hydro Due (90d)│    5  │ Schedule hydrostatic test
─────────────────────────────────────────────────────────────
[View All Tanks] [Schedule Batch Service] [Print Report]

REGULATORS (45 total):
─────────────────────────────────────────────────────────────
Status           │ Count │ Action
─────────────────┼───────┼─────────────────────────────────
✓ Current        │   38  │ Serviced within 12 months
⚠ Service Due    │    5  │ Schedule annual service
🔴 Service Overdue│    2  │ PULL FROM SERVICE
─────────────────────────────────────────────────────────────

COMPRESSOR:
─────────────────────────────────────────────────────────────
Last Service: October 15, 2025
Hours Since: 847
Next Service: 1,000 hours or February 2026
Status: ✓ Current
─────────────────────────────────────────────────────────────

UPCOMING SERVICE APPOINTMENTS:
─────────────────────────────────────────────────────────────
Jan 15 │ Tank VIP (12 tanks)    │ ABC Testing     │ $360
Jan 28 │ Regulator Service (7)  │ Scuba Tech      │ $490
Feb 10 │ Compressor Service     │ Bauer Service   │ $850
Feb 20 │ Tank Hydro (5 tanks)   │ ABC Testing     │ $375
─────────────────────────────────────────────────────────────
═══════════════════════════════════════════════════════════════
```

---

**Staff Certification Tracking:**

```
STAFF CERTIFICATIONS
═══════════════════════════════════════════════════════════════

MARIA GARCIA - Divemaster
─────────────────────────────────────────────────────────────
Certification          │ Number      │ Expires    │ Status
───────────────────────┼─────────────┼────────────┼──────────
PADI Divemaster        │ 123456      │ Active     │ ✓
EFR Instructor         │ EFR-789     │ Dec 2026   │ ✓
O2 Provider            │ O2-456      │ Mar 2026   │ ⚠ 60 days
Captain License        │ CAP-321     │ Jun 2027   │ ✓
First Aid              │ FA-654      │ Feb 2026   │ ⚠ 30 days
─────────────────────────────────────────────────────────────
Action: Schedule EFR/First Aid renewal

JUAN RODRIGUEZ - Captain
─────────────────────────────────────────────────────────────
Certification          │ Number      │ Expires    │ Status
───────────────────────┼─────────────┼────────────┼──────────
Captain License        │ CAP-111     │ Feb 2026   │ ⚠ 29 days
STCW Basic Safety      │ STCW-222    │ Feb 2028   │ ✓
First Aid              │ FA-333      │ Aug 2026   │ ✓
Radio Operator         │ RO-444      │ Lifetime   │ ✓
─────────────────────────────────────────────────────────────
Action: URGENT - Captain license renewal needed

TEAM SUMMARY:
─────────────────────────────────────────────────────────────
Total Staff: 12
Certifications Current: 89%
Expiring in 30 days: 3 (affecting 2 staff)
Expiring in 90 days: 7 (affecting 4 staff)
─────────────────────────────────────────────────────────────
[View All Staff] [Export for Permit] [Schedule Training]
═══════════════════════════════════════════════════════════════
```

---

**Compliance Reports:**

Generate reports for audits and permit applications:

```python
def generate_compliance_report(report_type, date_range=None):
    """
    Generate compliance reports for various purposes.
    """

    if report_type == "permit_renewal":
        return {
            "operator_info": get_operator_details(),
            "vessel_list": get_active_vessels_with_registrations(),
            "staff_certifications": get_staff_certification_summary(),
            "insurance_certificates": get_current_insurance_docs(),
            "safety_equipment": get_safety_equipment_status(),
            "visitor_statistics": get_visitor_stats(date_range),
        }

    elif report_type == "annual_compliance":
        return {
            "permits_status": get_all_permits_status(),
            "insurance_status": get_all_insurance_status(),
            "equipment_service_log": get_service_history(date_range),
            "staff_training_log": get_training_history(date_range),
            "incident_log": get_incident_history(date_range),
            "audit_trail": get_compliance_audit_trail(date_range),
        }

    elif report_type == "equipment_status":
        return {
            "tanks": get_tank_service_status(),
            "regulators": get_regulator_service_status(),
            "bcds": get_bcd_service_status(),
            "compressor": get_compressor_status(),
            "safety_equipment": get_safety_equipment_status(),
            "upcoming_service": get_upcoming_service_schedule(),
        }
```

---

**Implementation Checklist:**

```
Phase 1: Core Compliance Tracking
□ Design compliance item data model
□ Build compliance dashboard
□ Implement expiration tracking
□ Create reminder system (email, SMS, dashboard)
□ Add document upload/storage
□ Build calendar view

Phase 2: SOPs
□ Design SOP data model
□ Build SOP editor/viewer
□ Link SOPs to compliance items
□ Create SOP execution tracking
□ Add step-by-step progress tracking
□ Build SOP version control

Phase 3: Auto-Fill & Reporting
□ Create permit templates
□ Build auto-fill from system data
□ Generate visitor statistics reports
□ Export staff certification lists
□ Create vessel/equipment reports
□ Build PDF generation

Phase 4: Bill Payment Tracking
□ Design recurring expense model
□ Build payment dashboard
□ Implement auto-pay integration
□ Create payment reminders
□ Add cash flow forecasting
□ Build payment history

Phase 5: Equipment Service
□ Design service schedule model
□ Build equipment service dashboard
□ Implement batch service scheduling
□ Create service due alerts
□ Track service history
□ Generate service reports

Phase 6: Staff Certifications
□ Track all staff certifications
□ Alert on upcoming expirations
□ Link to training scheduling
□ Export for permit applications
□ Integration with booking (only certified staff assigned)

Phase 7: Integration
□ Connect to audit logging
□ Add to main dashboard
□ Mobile access for field checks
□ API for external integrations
□ Backup/disaster recovery for compliance docs
```

---

### 1.3 Revenue Streams

Revenue mix varies dramatically by shop type, but most include:

**Primary Services:**
- Guided dive trips (boat and shore)
- Certification courses (from beginner to professional)
- Equipment rentals

**Secondary Revenue:**
- Retail equipment sales
- Equipment servicing and repairs
- Travel packages and liveaboard bookings
- Specialty experiences (night dives, wreck dives, shark encounters)

**Ancillary Income:**
- Photography and video services
- Accommodation partnerships
- Food and beverage
- Merchandise

Each revenue stream has its own operational requirements, seasonality patterns, and margin profiles. Successful dive shops understand how these streams interact and support each other.

### 1.3 The Dive Shop Ecosystem

A dive shop doesn't operate in isolation. It exists within an ecosystem of:

- **Certification Agencies** (PADI, SSI, NAUI, BSAC, etc.)
- **Insurance Providers** (DAN, specialist dive insurers)
- **Equipment Manufacturers** (Scubapro, Mares, Aqualung, etc.)
- **Tourism Boards and Marine Parks**
- **Coast Guard and Maritime Authorities**
- **Local Hotels and Tour Operators**
- **Environmental Organizations**

Understanding these relationships—and the data flows between them—is essential for efficient operations.

---

## Chapter 2: The Customer Journey

### 2.1 The Two Types of Divers

Before discussing customer journeys, we must acknowledge a fundamental truth that shapes everything in dive shop operations:

**There are two fundamentally different types of people who dive.**

**Identity Divers** — "I am a diver"
- Diving is part of who they are
- Own their equipment (or aspire to)
- Pursue certifications as achievements
- Log dives meticulously
- Plan vacations around diving
- Talk about diving unprompted
- Read dive magazines, watch dive content
- Join dive clubs and online communities
- Measure themselves in logged dives and certification cards

**Experience Divers** — "I went diving"
- Diving is an activity, not an identity
- Like zip-lining, parasailing, or snorkeling
- May dive once per vacation, or once in a lifetime
- No interest in certification beyond "can I do this?"
- Rent everything, own nothing
- Don't log dives or track experiences
- Won't think about diving until next vacation
- No emotional attachment to the sport

**Why This Distinction Matters:**

| Aspect | Identity Diver | Experience Diver |
|--------|---------------|------------------|
| **Lifetime value** | $10,000+ over decades | $100-500 one-time |
| **Conversion goal** | Next certification | Great memory |
| **Communication** | Ongoing relationship | Transaction complete |
| **Equipment** | Purchase path | Rental only |
| **Loyalty** | Shop/instructor loyalty | Price/convenience driven |
| **Referrals** | Brings friends to diving | Tells friends "I went diving" |
| **Scheduling** | Flexible, plans ahead | Rigid vacation windows |
| **Risk tolerance** | Understands and accepts | Wants zero perceived risk |

**The Critical Insight:**

Most dive shops make the mistake of treating Experience Divers as "future Identity Divers who just need to be converted." This is wrong.

**Most Experience Divers will never become Identity Divers, and that's okay.**

They're not failed conversions. They're a legitimate, profitable customer segment with different needs:
- They want a safe, memorable, hassle-free experience
- They don't want a sales pitch for certification
- They don't want to hear about equipment purchases
- They want photos/videos to share on social media
- They want to check "went scuba diving" off their bucket list

**Serve them excellently for what they are, not what you wish they'd become.**

The small percentage who *do* have a transformative experience and want more? They'll tell you. They'll ask questions. They'll come back. You don't need to push—Identity Divers self-select.

### 2.2 The Identity Diver Journey

For those who *do* identify as divers, the journey is uniquely long and relationship-based:

```
DISCOVERY → CERTIFICATION → PRACTICE → CONTINUING EDUCATION → EQUIPMENT OWNERSHIP → TRAVEL → ADVOCACY → (possibly) PROFESSIONAL
```

This journey can span decades. A customer who gets certified at 25 might still be diving at 65, accumulating thousands of dives, multiple specialty certifications, and tens of thousands of dollars in equipment and travel.

**Key Milestones:**

1. **First Certification** (Open Water)
   - The gateway decision
   - Requires time commitment (3-4 days)
   - Financial investment ($300-500)
   - Emotional investment (overcoming fears)

2. **First 50 Dives**
   - Building confidence and skills
   - Discovering preferences (warm water vs. cold, reefs vs. wrecks)
   - First equipment purchases (usually mask, fins, computer)

3. **Advanced Certification**
   - Signals commitment to the sport
   - Opens deeper sites and more experiences
   - Often triggers more equipment purchases

4. **Specialty Certifications**
   - Nitrox, wreck, night, deep, photography
   - Each opens new experiences
   - Creates ongoing relationship with shop/instructor

5. **Equipment Ownership**
   - Major financial commitment ($2,000-5,000+)
   - Shifts relationship from rental to service/travel
   - Creates maintenance revenue stream

6. **Dive Travel**
   - Planning trips around diving
   - Liveaboards, dive resorts, exotic locations
   - May book through shop or independently

7. **Professional Track** (small percentage)
   - Divemaster, Instructor
   - Transforms from customer to colleague
   - Industry network expansion

### 2.3 The Experience Diver Journey

For Experience Divers, the journey is short and transactional:

```
AWARENESS → BOOKING → EXPERIENCE → MEMORY → (maybe) REPEAT
```

**What they want:**
- Easy booking process
- Clear pricing (no surprises)
- Minimal paperwork/friction
- Patient, reassuring guides
- Safe, controlled environment
- Memorable underwater moments
- Photos/videos to share
- Professional, friendly service

**What they don't want:**
- Lengthy briefings about dive theory
- Pressure to get certified
- Equipment purchase conversations
- Technical jargon
- Feeling rushed or judged
- Unexpected costs
- Complicated logistics

**Optimizing for Experience Divers:**

1. **Streamlined Booking**
   - Online booking essential
   - Clear pricing including everything
   - Simple medical questionnaire
   - Digital waivers before arrival

2. **Efficient Check-In**
   - They're on vacation; time is precious
   - Handle paperwork in advance
   - Equipment fitting should be quick and professional

3. **Appropriate Briefing**
   - Safety essentials only
   - Skip the physics of buoyancy
   - Focus on "what you'll see" and "what to do"
   - Reassurance, not education

4. **The Experience Itself**
   - High guide-to-guest ratio
   - Shorter, shallower dives
   - Focus on marine life encounters
   - Photos/video included or easy upsell

5. **Post-Dive**
   - Quick photo delivery (same day)
   - Easy review/testimonial request
   - No hard sell on certification
   - "If you ever want to learn more, here's how"

### 2.4 The Conversion Question

Should you try to convert Experience Divers to Identity Divers?

**Soft approach (recommended):**
- Deliver an exceptional experience
- Mention that certification exists
- Provide information if asked
- Follow up once, then leave alone
- Let the experience speak for itself

**Hard approach (not recommended):**
- Aggressive certification sales pitch
- Making them feel incomplete without certification
- Multiple follow-up emails pushing courses
- Discounting future courses to create urgency

The hard approach alienates the 95% who will never convert and doesn't meaningfully increase conversion among the 5% who might. The ones who will become Identity Divers will find their own way there.

### 2.5 Implications for Software

This distinction affects system design:

**For Experience Divers:**
- Streamlined booking flow (minimal fields)
- "Discover Scuba" or "Try Dive" as first-class product type
- No certification verification needed
- Simplified waiver process
- Photo/video delivery integration
- One-time transaction focus

**For Identity Divers:**
- Rich profile with certification history
- Logged dive tracking
- Equipment preferences and ownership
- Continuing education recommendations
- Loyalty program integration
- Long-term relationship management

**The system should recognize which type of customer it's dealing with and adapt accordingly.**

### 2.6 Customer Segmentation (Detailed)

Building on the Identity/Experience distinction, here's the complete segmentation:

**Experience Divers:**

| Segment | Description | Needs |
|---------|-------------|-------|
| **Bucket Listers** | One-time "I did it" | Safety, photos, minimal friction |
| **Vacation Dabblers** | Dive occasionally on trips | Easy booking, good experience |
| **Family/Group Tags** | Came because others wanted to | Extra reassurance, patience |

**Identity Divers:**

| Segment | Description | Needs |
|---------|-------------|-------|
| **New Converts** | Recently certified, building skills | Practice dives, mentorship |
| **Active Recreational** | Regular divers, own some gear | Variety, convenience, community |
| **Enthusiasts** | Pursuing specialties, own full kit | Advanced experiences, education |
| **Professionals** | DMs, instructors, researchers | B2B relationship, industry pricing |

### 2.7 The Booking Decision

When a customer decides to book a dive, several factors influence their choice:

1. **Availability** - Can they dive when they want?
2. **Sites** - Will they see what they want to see?
3. **Price** - Does it fit their budget?
4. **Reputation** - Is the operator safe and professional?
5. **Convenience** - How easy is the booking process?

The first three factors are operational. The fourth is built over time. The fifth is where software makes an immediate difference.

---

## Chapter 3: The Dive Trip Lifecycle

### 3.1 Planning Phase

Every dive trip begins long before customers arrive:

**Site Selection**
- Weather and sea conditions forecast
- Tidal patterns and current predictions
- Marine life seasonality
- Site rotation (to prevent overuse)
- Customer certification requirements

**Resource Allocation**
- Boat assignment and crew scheduling
- Guide-to-diver ratios
- Equipment availability
- Surface support requirements

**Capacity Planning**
- Maximum safe group size
- Skill-level mixing considerations
- Special needs accommodations

### 3.2 Booking Phase

The booking phase involves:

**Customer Qualification**
- Certification verification
- Medical questionnaire review
- Experience assessment
- Special requirements identification

**Reservation Management**
- Availability confirmation
- Deposit collection
- Waiver completion
- Pre-trip communication

**Yield Optimization**
- Pricing based on demand
- Package bundling
- Upsell opportunities (nitrox, photography, etc.)

### 3.3 Pre-Trip Phase

The day before and morning of the trip:

**Confirmation**
- Customer reminder communications
- Weather re-assessment
- Final headcount

**Preparation**
- Equipment staging
- Rental gear assignment
- Cylinder filling
- Boat provisioning

**Briefing Materials**
- Site information
- Safety protocols
- Emergency procedures

### 3.4 Execution Phase

During the actual trip:

**Check-In**
- Arrival verification
- Paperwork completion
- Equipment fitting
- Final briefings

**Diving Operations**
- Buddy assignments
- Dive planning
- In-water supervision
- Surface monitoring

**Post-Dive**
- Debriefing
- Log book signing
- Equipment return
- Feedback collection

### 3.5 Post-Trip Phase

After the customers leave:

**Administrative**
- Payment finalization
- Record completion
- Incident documentation (if any)

**Maintenance**
- Equipment cleaning and inspection
- Cylinder handling
- Boat maintenance

**Marketing**
- Photo/video delivery
- Review solicitation
- Follow-up offers

---

## Chapter 4: Safety and Compliance

### 4.1 The Non-Negotiables

Safety in diving is not a competitive advantage—it's a baseline requirement. Every dive shop must maintain:

**Certification Verification**
- Confirming customer credentials before every dive
- Understanding certification equivalencies across agencies
- Recognizing depth and specialty limitations

**Medical Screening**
- Administering medical questionnaires
- Understanding contraindications
- Requiring physician clearance when needed
- Maintaining confidential health records

**Equipment Standards**
- Regular inspection schedules
- Manufacturer service requirements
- Visual and hydrostatic cylinder testing
- Documentation of all maintenance

**Emergency Preparedness**
- Oxygen provision and administration training
- First aid equipment and training
- Emergency action plans
- Communication equipment
- Evacuation procedures

### 4.2 Regulatory Landscape

Dive shops operate under multiple regulatory frameworks:

**Maritime Law**
- Vessel certification and inspection
- Crew licensing requirements
- Passenger capacity limits
- Safety equipment mandates

**Tourism Regulations**
- Business licensing
- Tour operator requirements
- Consumer protection laws

**Environmental Rules**
- Marine park permits
- Protected species regulations
- Mooring requirements
- Waste management

**Industry Standards**
- Training agency standards
- Insurance requirements
- Professional association codes

### 4.3 Documentation Requirements

Proper documentation protects both the business and its customers:

**Per-Customer Records**
- Certification copies
- Medical questionnaires
- Liability releases
- Emergency contact information

**Per-Trip Records**
- Participant lists
- Dive profiles (depths, times)
- Conditions encountered
- Any incidents or near-misses

**Operational Records**
- Equipment maintenance logs
- Staff certifications and training
- Cylinder test dates
- Boat inspection records

### 4.4 When Things Go Wrong

Despite best precautions, incidents happen. Proper handling requires:

**Immediate Response**
- Emergency protocols activation
- Medical attention provision
- Authority notification
- Witness identification

**Documentation**
- Incident report completion
- Evidence preservation
- Statement collection

**Follow-Up**
- Insurance notification
- Legal counsel engagement
- Internal review
- Corrective action implementation

---

## Chapter 5: The Economics of Dive Operations

### 5.1 Cost Structure

Dive shops have a distinctive cost structure:

**Fixed Costs**
- Facility rent/mortgage
- Boat payments and insurance
- Staff base salaries
- Certification agency fees
- Basic utilities and maintenance

**Variable Costs**
- Fuel (significant for boat operations)
- Cylinder fills
- Equipment wear and consumables
- Seasonal staff
- Marketing and commissions

**Step Costs**
- Additional boats (capacity expansion)
- New instructors (course capacity)
- Equipment inventory (rental capacity)

### 5.2 Pricing Strategies

**Cost-Plus Pricing**
Calculate all costs per diver and add margin:
```
Trip Cost = (Fixed Costs / Expected Volume) + Variable Costs + Margin
```

**Market-Based Pricing**
Match competitor pricing with differentiation:
- Premium pricing for exclusive sites or experiences
- Value pricing for high-volume budget segments

**Dynamic Pricing**
Adjust prices based on demand:
- Peak season premiums
- Last-minute discounts for unfilled capacity
- Early booking incentives

**Package Pricing**
Bundle services for perceived value:
- Multi-dive packages
- Course + equipment bundles
- Accommodation combinations

### 5.3 Yield Management

Maximizing revenue per trip requires:

**Capacity Optimization**
- Fill every available spot
- Balance certification levels
- Minimize empty equipment

**Upsell Opportunities**
- Nitrox upgrades
- Photography services
- Equipment purchases
- Additional dives

**Cost Control**
- Efficient fuel usage
- Preventive maintenance
- Staff scheduling optimization

### 5.4 Seasonality Management

Most dive shops face significant seasonality:

**Peak Season**
- Maximum pricing
- Capacity constraints
- Staff overtime
- Equipment strain

**Shoulder Season**
- Promotional pricing
- Local market focus
- Maintenance scheduling
- Training investments

**Off Season**
- Survival mode pricing
- Staff reduction
- Major repairs and upgrades
- Business planning

Successful shops smooth seasonality through:
- Diverse market segments (tourists vs. locals)
- Alternative activities (pool sessions, classroom courses)
- Geographic diversification
- Advanced booking incentives

---

# Part II: Operational Challenges

---

## Chapter 6: The Complexity Problem

### 6.1 Information Overload

A typical dive shop must track:

- **Customer Data**: Hundreds or thousands of profiles with certifications, medical status, preferences, and history
- **Scheduling**: Multiple boats, sites, instructors, and trip types across varying timeframes
- **Inventory**: Rental equipment, retail stock, consumables, and maintenance schedules
- **Finances**: Bookings, deposits, payments, refunds, commissions, and payroll
- **Compliance**: Certifications, waivers, medical forms, and incident reports

Without systems to manage this information, operators drown in paperwork and make costly mistakes.

### 6.2 The Paper Trail Problem

Traditional dive shop operations rely heavily on paper:

- Handwritten booking logs
- Paper medical questionnaires
- Physical waiver forms
- Manual dive logs
- Clipboard equipment checklists

This creates problems:

**Accessibility**
- Information locked in physical locations
- Can't check availability remotely
- Difficult to share across staff

**Accuracy**
- Illegible handwriting
- Transcription errors
- Lost or damaged documents

**Searchability**
- Finding historical records is time-consuming
- Pattern recognition is impossible
- Audit preparation is painful

**Scalability**
- More volume = more paper = more chaos
- Staff training on paper systems is slow
- Consistency across locations is difficult

### 6.3 The Coordination Challenge

Dive operations require coordination across multiple dimensions:

**Temporal Coordination**
- Aligning customer availability with trip schedules
- Sequencing multi-day courses
- Managing weather-dependent rescheduling

**Resource Coordination**
- Matching equipment to customers
- Assigning guides to trips
- Allocating boats to routes

**Information Coordination**
- Ensuring all staff have current information
- Communicating changes to customers
- Maintaining accurate records

When any coordination fails, the result is unhappy customers, wasted resources, or safety risks.

### 6.4 The Scaling Dilemma

Small dive shops often resist systematization:

*"We know all our customers personally."*
*"Our system works fine—it's in my head."*
*"Software is too complicated for our simple operation."*

But this approach creates a ceiling:

- **Owner Dependency**: The business can't function without the owner present
- **Knowledge Loss**: When staff leave, their knowledge leaves too
- **Growth Limits**: Adding volume overwhelms informal systems
- **Quality Inconsistency**: Service varies by who's working

The transition from informal to formal operations is painful but essential for growth.

---

## Chapter 7: Common Failure Modes

### 7.1 Booking Failures

**Overbooking**
- More customers than capacity
- Results: Angry customers, dangerous overcrowding, or last-minute cancellations
- Cause: Manual tracking, poor communication, optimistic assumptions

**Underbooking**
- Trips running below profitable capacity
- Results: Lost revenue, potential trip cancellations
- Cause: Poor marketing, inconvenient booking process, lack of follow-up

**Qualification Mismatches**
- Customers booked for trips beyond their certification
- Results: Safety risks, trip disruptions, disappointed customers
- Cause: Inadequate verification, staff assumptions, customer misrepresentation

**Communication Failures**
- Customers miss trips due to unclear information
- Results: No-shows, complaints, refund demands
- Cause: Verbal-only confirmation, incomplete contact info, no reminders

### 7.2 Operational Failures

**Equipment Misallocation**
- Wrong size, wrong type, or unavailable equipment
- Results: Trip delays, customer discomfort, safety issues
- Cause: Poor inventory tracking, last-minute bookings, maintenance backlogs

**Staffing Mismatches**
- Wrong instructor for course type, insufficient guides for group size
- Results: Quality issues, safety concerns, staff burnout
- Cause: Manual scheduling, credential tracking failures, poor forecasting

**Site Selection Errors**
- Inappropriate site for conditions or customer abilities
- Results: Disappointing experiences, safety incidents
- Cause: Outdated condition information, inadequate customer assessment

### 7.3 Financial Failures

**Revenue Leakage**
- Services provided but not charged
- Results: Direct profit loss
- Cause: Manual invoicing, unclear pricing, verbal agreements

**Pricing Errors**
- Wrong prices quoted or charged
- Results: Customer disputes, margin erosion
- Cause: Outdated price lists, calculation errors, unauthorized discounts

**Deposit Management Failures**
- Lost deposits, double-charging, unclear refund policies
- Results: Customer complaints, accounting nightmares
- Cause: Cash handling issues, poor record-keeping, inconsistent policies

### 7.4 Compliance Failures

**Certification Lapses**
- Operating with expired certifications (staff or facility)
- Results: Insurance voidance, legal liability, agency sanctions
- Cause: Manual tracking, lack of reminders, assumed renewals

**Documentation Gaps**
- Missing waivers, incomplete medical forms, unsigned releases
- Results: Legal exposure, insurance claim denials
- Cause: Paper system failures, rushed check-ins, inadequate training

**Maintenance Oversights**
- Overdue equipment service, missed inspections
- Results: Equipment failures, safety incidents, liability
- Cause: Paper-based tracking, deferred maintenance, cost-cutting

---

## Chapter 8: The Human Factor

### 8.1 Staff Challenges

**Seasonal Workforce**
- High turnover creates training burden
- Institutional knowledge walks out the door
- Quality consistency is difficult

**Multi-Role Requirements**
- Small shops need staff who can do everything
- Finding instructor/mechanic/salesperson combinations is hard
- Specialization vs. flexibility tradeoffs

**Certification Maintenance**
- Staff credentials must be current
- Continuing education requirements vary by agency
- Tracking across multiple certifications is complex

### 8.2 Customer Challenges

**Varied Experience Levels**
- Same trip may include beginners and experts
- Pacing and site selection must accommodate all
- Safety protocols differ by experience

**Diverse Expectations**
- Some want adventure, some want relaxation
- Photography priorities vs. diving priorities
- Group dynamics and personality conflicts

**Communication Barriers**
- International customers with language differences
- Technical diving terminology confusion
- Cultural differences in safety attitudes

### 8.3 The Owner's Burden

Many dive shop owners started as divers who loved the sport. They discover that:

- Running a business is very different from diving
- Administrative work consumes time that could be spent on the water
- Financial management skills weren't taught in instructor courses
- The romance of the lifestyle fades under operational pressures

The most successful owners find ways to delegate administration while staying connected to the diving that drew them to the industry.

---

# Part III: Software Solutions

---

## Chapter 9: The Case for Digitization

### 9.1 What Software Can Solve

Modern dive shop software addresses core operational challenges:

**Centralized Information**
- All customer, booking, and operational data in one place
- Accessible from anywhere with internet connection
- Searchable and sortable
- Backed up and secure

**Automated Workflows**
- Booking confirmation and reminders sent automatically
- Certification checks performed at booking time
- Payment processing and receipts handled digitally
- Equipment availability updated in real-time

**Error Prevention**
- Overbooking prevented by capacity tracking
- Qualification mismatches caught before booking confirms
- Price calculations performed consistently
- Required fields ensure complete information

**Business Intelligence**
- Revenue and booking trends visible at a glance
- Customer behavior patterns identifiable
- Operational efficiency measurable
- Forecasting enabled by historical data

### 9.2 The ROI of Software

Investment in dive shop software pays returns through:

**Time Savings**
- Reduce administrative hours per booking
- Eliminate manual data entry duplication
- Accelerate check-in processes
- Simplify reporting and reconciliation

**Revenue Increases**
- Capture bookings that would have been lost to inconvenience
- Reduce no-shows through automated reminders
- Enable upselling through systematic prompts
- Improve customer retention through better service

**Cost Reductions**
- Lower error correction expenses
- Reduce paper and printing costs
- Minimize equipment downtime through maintenance tracking
- Optimize staffing through demand forecasting

**Risk Mitigation**
- Ensure compliance documentation is complete
- Maintain audit trails for liability protection
- Catch qualification issues before they become incidents
- Preserve institutional knowledge beyond individual staff

### 9.3 Resistance to Change

Despite clear benefits, many dive shops resist software adoption:

**"We're Too Small"**
Reality: Even small operations benefit from systematization. The time savings alone often justify the investment.

**"Our Customers Want Personal Service"**
Reality: Software enables more personal service by freeing staff from administrative tasks. Knowing a customer's history and preferences makes interactions more personal, not less.

**"It's Too Expensive"**
Reality: Compare software costs to the cost of one serious booking error, one liability claim from missing documentation, or one burned-out owner.

**"We're Not Tech-Savvy"**
Reality: Modern software is designed for non-technical users. If your staff can use a smartphone, they can use dive shop software.

**"Our Current System Works"**
Reality: "Works" often means "hasn't catastrophically failed yet." Growth, staff changes, or increased competition will expose weaknesses.

---

## Chapter 10: Core Software Capabilities

### 10.1 Customer Management

**Profile Storage**
- Contact information
- Emergency contacts
- Certification records
- Medical questionnaire responses
- Dive history and preferences
- Communication preferences

**Certification Tracking**
- Certification type and level
- Issuing agency
- Certification date
- Expiration tracking (where applicable)
- Specialty certifications

**Medical Management**
- Medical questionnaire digitization
- Flag conditions requiring physician clearance
- Track clearance expiration
- Maintain confidentiality

**Relationship History**
- All bookings and purchases
- Communications sent
- Feedback received
- Loyalty metrics

### 10.2 Booking and Scheduling

**Trip Management**
- Create and modify trip schedules
- Set capacity limits
- Assign boats and staff
- Configure pricing

**Reservation System**
- Real-time availability display
- Online booking capability
- Instant confirmation
- Deposit processing

**Eligibility Enforcement**
- Automatic certification checking
- Medical clearance verification
- Prerequisite validation
- Capacity enforcement

**Communication Automation**
- Booking confirmations
- Pre-trip reminders
- Weather updates
- Post-trip follow-ups

### 10.3 Operational Tracking

**Trip Execution**
- Check-in processing
- Participant tracking
- Status updates (scheduled, in progress, completed)
- Incident documentation

**Equipment Management**
- Inventory tracking
- Rental assignment
- Maintenance scheduling
- Service history

**Staff Scheduling**
- Availability management
- Certification matching
- Workload balancing
- Payroll integration

### 10.4 Financial Management

**Pricing Engine**
- Base pricing by trip type
- Dynamic adjustments (site, season, demand)
- Package and bundle pricing
- Discount management

**Payment Processing**
- Deposit collection
- Balance payment
- Refund handling
- Multiple payment methods

**Reporting**
- Revenue by period, trip type, customer segment
- Booking trends and forecasts
- Profitability analysis
- Tax preparation support

### 10.5 Compliance and Safety

**Documentation Management**
- Digital waiver collection
- Medical form storage
- Certification verification records
- Incident reports

**Audit Trail**
- Who did what, when
- Change history for all records
- Access logging
- Report generation for audits

**Expiration Tracking**
- Staff certification renewals
- Equipment service dates
- Facility permit renewals
- Insurance policy terms

---

## Chapter 11: The Eligibility Engine

### 11.1 Why Eligibility Matters

The single most important safety function of dive shop software is eligibility checking—ensuring that customers are qualified for the activities they book.

Manual eligibility checking fails because:
- Staff may not know all certification requirements
- Busy periods lead to shortcuts
- Customers may misunderstand or misrepresent qualifications
- Requirements vary by site, depth, and activity type

Automated eligibility checking succeeds because:
- Rules are applied consistently every time
- Checks happen at booking, not check-in
- Complex logic is handled without human error
- Documentation of qualification is automatic

### 11.2 Eligibility Factors

A comprehensive eligibility engine considers:

**Certification Level**
- Entry-level certifications limit depth and conditions
- Advanced certifications unlock deeper sites
- Specialty certifications enable specific activities
- Professional certifications allow working roles

**Medical Status**
- Current medical questionnaire on file
- No flagged conditions, or physician clearance obtained
- Clearance not expired

**Experience Requirements**
- Minimum logged dives for certain activities
- Recent diving activity (no extended breaks)
- Specific experience types (night, deep, current)

**Administrative Requirements**
- Current liability waiver
- Emergency contact information
- Payment or deposit completed

**Capacity Constraints**
- Trip not already full
- Appropriate guide-to-diver ratio maintained
- Equipment availability confirmed

### 11.3 Decisioning Logic

The eligibility engine operates as a decision tree:

```
For each booking request:
    1. Check certification level against trip requirements
       → If insufficient: DENY with reason

    2. Check medical status
       → If expired/missing: DENY with reason
       → If flagged without clearance: DENY with reason

    3. Check experience requirements
       → If insufficient: DENY with reason

    4. Check administrative requirements
       → If incomplete: HOLD pending completion

    5. Check capacity
       → If full: DENY (waitlist option)

    6. All checks passed: APPROVE
```

Each denial includes a specific reason, enabling customers to understand what they need to do to become eligible.

### 11.4 Edge Cases and Overrides

Real-world operations require flexibility:

**Certification Equivalencies**
- Different agencies have equivalent certifications
- System must understand cross-agency mappings
- Some regional variations exist

**Supervised Exceptions**
- Students may dive beyond certification with instructor
- Discover Scuba participants need special handling
- Refresher programs for lapsed divers

**Staff Overrides**
- Rare circumstances may justify exception
- All overrides logged with reason and approver
- Override patterns monitored for abuse

---

## Chapter 12: The Price of Certainty

### 12.1 Why Prices Must Lock

In dive shop operations, the price shown at booking must be the price charged. This seems obvious, but consider the complications:

**Scenario: Price Change After Booking**
- Customer books trip at $100
- Shop raises prices to $120
- Customer arrives expecting to pay $100
- Conflict ensues

**Scenario: Promotional Pricing**
- Customer books during sale at $80
- Sale ends before trip date
- System shows current price of $100
- Customer charged wrong amount

**Scenario: Dynamic Pricing**
- Price varies by demand
- Customer books at low-demand price
- Trip fills up, triggering high-demand price
- Later customers pay more for same trip

### 12.2 Price Snapshots

The solution is price snapshots—capturing the exact price at booking time and preserving it regardless of subsequent changes.

**How It Works:**
1. Customer initiates booking
2. System calculates price based on current rules
3. Calculated price is stored with booking record
4. All future references use stored price, not recalculated price

**What Gets Snapshotted:**
- Base trip price
- Site adjustments
- Applied discounts
- Rental add-ons
- Taxes and fees

**Audit Trail:**
- Original price calculation recorded
- Any manual adjustments logged with reason
- Price at time of charge documented

### 12.3 Pricing Transparency

Price snapshots also enable transparency:

**For Customers:**
- See exactly what they'll pay before confirming
- Receive confirmation with price breakdown
- Know price won't change unexpectedly

**For Staff:**
- See price customer was quoted
- Understand what discounts were applied
- Avoid awkward price conversations

**For Management:**
- Track pricing effectiveness
- Identify discount patterns
- Analyze yield by trip and period

---

## Chapter 13: The Audit Imperative

### 13.1 Why Every Action Matters

In dive operations, the question "what happened?" comes up constantly:

- Customer disputes what they were told
- Incident investigation needs timeline
- Insurance claim requires documentation
- Staff conflict needs resolution
- Management needs operational visibility

Without systematic audit logging, answers depend on memory—which is unreliable, inconsistent, and legally questionable.

### 13.2 What to Log

Comprehensive audit logging captures:

**Entity Changes**
- Record created (who, when, what values)
- Record modified (who, when, old vs. new values)
- Record deleted (who, when, what was deleted)

**Operational Events**
- Trip scheduled, started, completed, cancelled
- Customer checked in, completed dive, marked no-show
- Equipment assigned, returned, flagged for service

**System Events**
- User login/logout
- Permission changes
- System configuration changes

**Business Events**
- Payment received
- Refund issued
- Price override applied
- Eligibility override granted

### 13.3 Audit Log Design

Effective audit logs share these characteristics:

**Immutable**
- Logs cannot be modified or deleted
- Append-only storage
- Protected from tampering

**Contextual**
- Who performed the action
- When it occurred
- What changed (before and after)
- Why (if reason provided)

**Searchable**
- Filter by user, date range, entity type
- Full-text search of notes and reasons
- Export for external analysis

**Retained**
- Kept for legally required period
- Archived for long-term reference
- Backed up separately from operational data

### 13.4 Using Audit Data

Beyond answering "what happened?", audit data enables:

**Operational Improvement**
- Identify bottlenecks in processes
- Spot error patterns
- Measure staff productivity

**Security Monitoring**
- Detect unauthorized access
- Identify suspicious patterns
- Support incident investigation

**Compliance Demonstration**
- Prove procedures were followed
- Document qualification verification
- Show due diligence in safety matters

---

## Chapter 14: Integration Considerations

### 14.1 The Integration Landscape

Dive shop software rarely operates in isolation. Integrations may include:

**Payment Processors**
- Credit card processing
- Online payment gateways
- Point-of-sale systems

**Accounting Systems**
- QuickBooks, Xero, or similar
- Revenue recognition
- Expense tracking

**Marketing Platforms**
- Email marketing systems
- Customer review platforms
- Social media

**Booking Channels**
- Online travel agencies
- Hotel concierge systems
- Tourism platforms

**Certification Databases**
- Training agency verification systems
- Digital certification wallets

### 14.2 Integration Approaches

**Manual Export/Import**
- Export data from one system, import to another
- Simple but labor-intensive
- Error-prone and not real-time

**File-Based Integration**
- Automated file transfers on schedule
- Better than manual but still delayed
- Requires format matching

**API Integration**
- Real-time data exchange
- Automated and reliable
- Requires technical implementation

**Embedded Integration**
- Systems share common database
- Seamless user experience
- May limit flexibility

### 14.3 Integration Priorities

For most dive shops, prioritize integrations in this order:

1. **Payment Processing** - Essential for online bookings
2. **Accounting** - Reduces double-entry and errors
3. **Email Marketing** - Enables customer communication at scale
4. **Booking Channels** - Expands reach if using OTAs
5. **Certification Verification** - Nice-to-have for high-volume operations

---

# Part IV: Implementation Guide

---

## Chapter 15: Assessing Your Needs

### 15.1 Current State Analysis

Before selecting software, understand your current operations:

**Volume Metrics**
- Bookings per week/month/year
- Unique customers served
- Trips operated
- Revenue by category

**Pain Points**
- Where do errors occur most often?
- What takes the most administrative time?
- What do customers complain about?
- What keeps you up at night?

**Growth Plans**
- Expected volume increases
- New locations or boats planned
- New services being considered
- Staff changes anticipated

### 15.2 Must-Have vs. Nice-to-Have

Categorize requirements honestly:

**Must-Have Features**
- Without these, the system won't work for you
- Examples: booking management, customer records, basic reporting

**Nice-to-Have Features**
- Would improve operations but aren't essential
- Examples: advanced analytics, marketing automation, mobile app

**Future Needs**
- Not needed now but anticipated later
- Ensure chosen system can accommodate growth

### 15.3 Technical Considerations

**Deployment Model**
- Cloud-based: No hardware, accessible anywhere, subscription pricing
- On-premise: More control, requires IT support, upfront cost

**Device Requirements**
- Desktop/laptop needs
- Tablet usage (for mobile check-in)
- Smartphone access
- Offline capability needs

**Integration Requirements**
- Must connect to which other systems?
- What data needs to flow where?
- Real-time or batch acceptable?

---

## Chapter 16: Selection Process

### 16.1 Market Landscape

Dive shop software options range from:

**Generic Business Software**
- General booking/scheduling systems
- Retail point-of-sale
- Requires customization for dive specifics
- May lack certification/eligibility features

**Dive-Specific Solutions**
- Purpose-built for dive operations
- Understand industry terminology and workflows
- May be smaller vendors with less support

**Custom Development**
- Built specifically for your operation
- Maximum flexibility
- Highest cost and longest timeline

### 16.2 Evaluation Criteria

Score potential solutions on:

**Functionality Fit**
- Does it do what you need?
- How much customization required?
- Are dive-specific features included?

**Usability**
- Can your staff learn it quickly?
- Is the interface intuitive?
- Does it work on your devices?

**Reliability**
- What's the uptime history?
- How is data backed up?
- What happens if vendor disappears?

**Support**
- What support channels available?
- What are response times?
- Is training included?

**Cost**
- What's the total cost of ownership?
- Are there hidden fees?
- How does pricing scale with growth?

### 16.3 The Demo Process

When evaluating software:

**Prepare Realistic Scenarios**
- Walk through a typical day's operations
- Test your specific edge cases
- Try to break it with unusual situations

**Involve End Users**
- Have actual staff participate in demos
- Get feedback from different roles
- Assess learning curve realistically

**Check References**
- Talk to similar operations using the software
- Ask about implementation challenges
- Inquire about ongoing support quality

---

## Chapter 17: Implementation Best Practices

### 17.1 Planning the Transition

**Timeline Considerations**
- Avoid implementing during peak season
- Allow time for staff training
- Plan for parallel running period
- Build in contingency time

**Data Migration**
- What historical data needs to move?
- How will it be cleaned and formatted?
- Who will verify accuracy?

**Process Changes**
- What workflows will change?
- Document new procedures
- Prepare training materials

### 17.2 Staff Preparation

**Change Management**
- Communicate why the change is happening
- Address concerns honestly
- Involve staff in implementation decisions
- Celebrate early wins

**Training Approach**
- Role-based training (not everyone needs everything)
- Hands-on practice with realistic scenarios
- Quick reference guides for common tasks
- Designated "super users" for peer support

**Resistance Management**
- Expect some pushback
- Listen to concerns—they may identify real issues
- Don't force adoption too quickly
- Demonstrate benefits through results

### 17.3 Go-Live Strategies

**Big Bang**
- Switch everything at once
- Clean break from old system
- Higher risk, faster completion

**Phased Rollout**
- Implement modules sequentially
- Lower risk, longer timeline
- May require temporary integrations

**Parallel Running**
- Run old and new systems simultaneously
- Safest approach
- Most labor-intensive

For most dive shops, a phased approach with brief parallel running for critical functions offers the best balance.

### 17.4 Post-Implementation

**Stabilization Period**
- Expect issues in first weeks
- Have extra support available
- Document and fix problems quickly
- Resist major changes until stable

**Optimization Phase**
- Once stable, look for improvements
- Gather user feedback systematically
- Implement enhancements iteratively
- Measure against baseline metrics

**Ongoing Maintenance**
- Keep software updated
- Review and refresh training
- Monitor for emerging issues
- Stay informed about new features

---

## Chapter 18: Measuring Success

### 18.1 Key Performance Indicators

Track these metrics before and after implementation:

**Operational Efficiency**
- Time per booking (should decrease)
- Check-in duration (should decrease)
- Administrative hours per week (should decrease)
- Error rate (should decrease)

**Customer Experience**
- Booking abandonment rate (should decrease)
- No-show rate (should decrease with reminders)
- Customer complaints (should decrease)
- Repeat booking rate (should increase)

**Financial Performance**
- Revenue per trip (should increase through better filling)
- Revenue leakage (should decrease)
- Average transaction value (may increase through upselling)
- Collection efficiency (should improve)

**Compliance Posture**
- Documentation completion rate (should approach 100%)
- Certification verification compliance (should be 100%)
- Audit readiness score (should improve)

### 18.2 Continuous Improvement

Use software-generated data to drive ongoing improvement:

**Regular Reviews**
- Weekly: Operational metrics
- Monthly: Financial performance
- Quarterly: Strategic KPIs
- Annually: Comprehensive assessment

**Feedback Loops**
- Staff suggestions for process improvements
- Customer feedback on booking experience
- Industry benchmarking where available

**System Evolution**
- New features as they become available
- Additional integrations as needed
- Workflow refinements based on experience

---

# Part V: The Opinionated Architecture

---

## Chapter 19: A Principled Approach to Dive Shop Software

### 19.1 The Problem with Generic Software

Most dive shop software falls into two traps:

**Trap 1: Generic Business Software Forced to Fit**
Generic booking systems, CRMs, and retail POS systems don't understand diving. They lack:
- Certification-based eligibility
- Multi-dive trip structures
- Safety-critical documentation
- Industry-specific terminology

The result: endless workarounds, manual processes, and data that doesn't reflect reality.

**Trap 2: Monolithic Dive Software**
Purpose-built dive software often becomes a rigid monolith:
- All-or-nothing feature sets
- Impossible to customize
- Vendor lock-in
- Can't integrate with other systems

The result: paying for features you don't need while lacking ones you do.

### 19.2 The Composable Primitive Approach

There is a better way: build dive shop systems from **composable primitives**—small, focused modules that each do one thing well and combine to create complete solutions.

**Core Primitives for Dive Operations:**

| Primitive | Purpose | Dive Shop Application |
|-----------|---------|----------------------|
| **Parties** | People and organizations | Divers, staff, agencies, shops |
| **Encounters** | Time-bounded interactions | Excursions, dives, courses |
| **Decisioning** | Rule-based eligibility | Certification requirements |
| **Audit Log** | Immutable event history | All operational changes |
| **Money** | Currency and amounts | Pricing, payments |
| **Sequence** | Unique identifiers | Booking numbers, invoice IDs |
| **Documents** | File attachments | Certifications, waivers |
| **Agreements** | Contracts and terms | Liability releases |

**Why Primitives Work:**
- Each primitive is battle-tested independently
- Combine only what you need
- Replace components without rebuilding everything
- Extend functionality without core modifications
- Clear boundaries prevent feature creep

### 19.3 The Layered Architecture

Dive shop software should follow a strict layered architecture:

```
┌─────────────────────────────────────────────┐
│           PRESENTATION LAYER                │
│   Staff Portal │ Customer Portal │ API      │
└─────────────────────────────────────────────┘
                      │
┌─────────────────────────────────────────────┐
│            SERVICE LAYER                    │
│  Booking │ Eligibility │ Pricing │ Audit   │
└─────────────────────────────────────────────┘
                      │
┌─────────────────────────────────────────────┐
│             DOMAIN LAYER                    │
│  Diver │ Excursion │ Dive │ Booking │ Site │
└─────────────────────────────────────────────┘
                      │
┌─────────────────────────────────────────────┐
│           PRIMITIVE LAYER                   │
│ Parties │ Encounters │ Decisioning │ Audit │
└─────────────────────────────────────────────┘
                      │
┌─────────────────────────────────────────────┐
│          FOUNDATION LAYER                   │
│    BaseModels │ Soft Delete │ Timestamps    │
└─────────────────────────────────────────────┘
```

**Layer Rules (Non-Negotiable):**
1. Each layer only imports from layers below
2. Presentation never touches database directly
3. Services contain all business logic
4. Domain models are behavior-rich, not anemic
5. Primitives have zero domain knowledge

---

## Chapter 20: The Domain Model (Opinionated)

### 20.1 Core Entities

After years of refinement, here is the recommended domain model for dive shop operations:

**DiverProfile** (extends Party)
```
DiverProfile
├── party_id (link to identity system)
├── emergency_contact_name
├── emergency_contact_phone
├── medical_clearance_date
├── certification_level (enum)
├── total_logged_dives
└── notes

Certifications (child records)
├── agency (PADI, SSI, etc.)
├── certification_type
├── certification_date
├── card_number
└── verified_at
```

**Why this structure:**
- Divers are a specialized type of Party (reuse identity infrastructure)
- Medical clearance has a date, not a boolean (enables expiration)
- Certification level is denormalized for performance (queries by level are common)
- Detailed certifications are child records (multiple agencies, specialties)

**DiveSite**
```
DiveSite
├── name
├── description
├── max_depth_meters
├── min_certification_level
├── latitude, longitude
├── is_active
└── notes
```

**Why this structure:**
- Max depth drives certification requirements automatically
- Min certification level allows overrides beyond depth-based rules
- Active flag enables soft-disable without deletion
- Coordinates enable mapping and distance calculations

**Excursion** (extends Encounter)
```
Excursion
├── encounter_id (link to encounter system)
├── excursion_type_id (product template)
├── dive_site_id (primary site)
├── scheduled_at
├── boat_name
├── max_capacity
├── status (scheduled/started/completed/cancelled)
├── started_at
├── completed_at
└── notes

Dives (child records)
├── dive_site_id
├── sequence (1, 2, 3...)
├── planned_start
├── planned_duration_minutes
├── max_depth_meters
├── actual_start, actual_end (optional)
└── notes
```

**Why this structure:**
- Excursion is the bookable unit; Dives are operational detail
- Primary site on Excursion; individual dives may vary
- Status is explicit state machine, not derived
- Timestamps for started/completed enable duration tracking
- Sequence allows multi-dive trips with explicit ordering

**Booking**
```
Booking
├── diver_id
├── excursion_id
├── status (confirmed/checked_in/completed/cancelled/no_show)
├── booked_at
├── checked_in_at
├── completed_at
├── price_snapshot (immutable)
├── cancelled_at
├── cancellation_reason
└── notes
```

**Why this structure:**
- Status tracks full lifecycle
- All state transitions have timestamps
- Price is snapshotted at booking, never recalculated
- Cancellation preserves record (soft delete pattern)

### 20.2 The Excursion Type Pattern

**ExcursionType** (Product Template)
```
ExcursionType
├── name ("Two-Tank Morning", "Night Dive")
├── description
├── base_price
├── default_num_dives
├── min_certification_level
├── is_active
└── notes

ExcursionTypeDive (template for dives)
├── excursion_type_id
├── sequence
├── default_duration_minutes
├── default_max_depth
└── notes
```

**Why this pattern:**
- Products are defined once, instantiated many times
- Base price is starting point; adjustments add to it
- Default dive structure speeds excursion creation
- Certification requirement is at product level

**SitePriceAdjustment**
```
SitePriceAdjustment
├── excursion_type_id
├── dive_site_id
├── adjustment_amount (+$25, -$10)
├── effective_from
├── effective_to (null = current)
└── notes
```

**Why this pattern:**
- Same product at different sites costs differently
- Effective dating allows price changes without history loss
- Premium sites get positive adjustments; training sites negative

### 20.3 Hard Rules for Data Integrity

These rules are non-negotiable and should be enforced at the database level where possible:

**Rule 1: Prices Are Immutable After Booking**
```
Once a booking is created, its price_snapshot CANNOT change.
The customer pays what they were quoted, period.
```
*Implementation: Store price as JSON snapshot on booking record*

**Rule 2: Soft Delete Everything in the Booking Path**
```
Divers, Excursions, Bookings are NEVER hard-deleted.
Use deleted_at timestamp. Queries filter by default.
```
*Implementation: SoftDeleteManager as default, all_objects for admin*

**Rule 3: All State Changes Are Logged**
```
Every create, update, status change generates an audit entry.
Audit entries are append-only and cannot be modified.
```
*Implementation: Audit log primitive with immutable storage*

**Rule 4: Eligibility Is Checked at Booking AND Check-In**
```
A diver who was eligible at booking may become ineligible
(cert expired, medical lapsed). Re-check at check-in.
```
*Implementation: Decisioning service called at both points*

**Rule 5: Excursions Have Explicit Status Transitions**
```
scheduled → started → completed
scheduled → cancelled
started → cancelled (emergency only)
No other transitions are valid.
```
*Implementation: State machine with transition validation*

---

## Chapter 21: The Service Layer (Opinionated)

### 21.1 Services, Not Fat Models

Business logic belongs in services, not models. Models define structure and simple computed properties. Services orchestrate complex operations.

**Anti-Pattern (Don't Do This):**
```python
class Booking(models.Model):
    def create_booking(self, diver, excursion, price):
        # 50 lines of validation
        # eligibility checking
        # price calculation
        # audit logging
        # notification sending
        self.save()
```

**Correct Pattern:**
```python
# services.py
def create_booking(diver, excursion, actor):
    """Create a booking with full validation and audit trail."""
    with transaction.atomic():
        # 1. Check eligibility
        decision = check_eligibility(diver, excursion)
        if not decision.eligible:
            raise IneligibleDiverError(decision.reason)

        # 2. Check capacity
        if excursion.is_full:
            raise ExcursionFullError()

        # 3. Calculate price (will be snapshotted)
        price = calculate_price(excursion, diver)

        # 4. Create booking
        booking = Booking.objects.create(
            diver=diver,
            excursion=excursion,
            price_snapshot=price.to_snapshot(),
            status=BookingStatus.CONFIRMED,
        )

        # 5. Log the event
        log_booking_event(
            action=Actions.BOOKING_CREATED,
            booking=booking,
            actor=actor,
            price=price,
        )

        return booking
```

**Why Services:**
- Single responsibility: one service function = one operation
- Explicit dependencies: everything needed is passed in
- Testable: mock dependencies, verify outcomes
- Transactional: atomic blocks ensure consistency
- Auditable: logging is part of the service, not afterthought

### 21.2 The Eligibility Service

Eligibility checking is the most safety-critical service. It must be:

**Deterministic**: Same inputs always produce same output
**Explainable**: Every denial includes specific reason
**Extensible**: New rules can be added without rewriting
**Auditable**: Every check is logged

**Implementation Pattern:**
```python
def check_eligibility(diver, excursion):
    """
    Check if diver is eligible for excursion.
    Returns Decision with eligible=True/False and reason.
    """
    checks = [
        check_certification_level,
        check_medical_clearance,
        check_required_experience,
        check_excursion_requirements,
    ]

    for check in checks:
        result = check(diver, excursion)
        if not result.passed:
            return Decision(
                eligible=False,
                reason=result.reason,
                check_name=check.__name__,
            )

    return Decision(eligible=True)
```

**Certification Level Check:**
```python
def check_certification_level(diver, excursion):
    required = excursion.min_certification_level
    actual = diver.certification_level

    if CERT_HIERARCHY[actual] < CERT_HIERARCHY[required]:
        return CheckResult(
            passed=False,
            reason=f"Requires {required} certification. "
                   f"Diver has {actual}."
        )
    return CheckResult(passed=True)
```

### 21.3 The Pricing Service

Pricing must be:

**Predictable**: Customer knows price before booking
**Immutable**: Price doesn't change after booking
**Traceable**: Can explain how price was calculated
**Flexible**: Support various pricing models

**Implementation Pattern:**
```python
def calculate_price(excursion, diver=None):
    """
    Calculate price for booking.
    Returns Price object with amount and breakdown.
    """
    # Start with base price from excursion type
    base = excursion.excursion_type.base_price

    # Apply site adjustment
    adjustment = get_site_adjustment(
        excursion.excursion_type,
        excursion.dive_site,
    )

    # Build price with breakdown
    return Price(
        amount=base + adjustment.amount,
        currency="USD",
        breakdown={
            "base_price": str(base),
            "site_adjustment": str(adjustment.amount),
            "site_name": excursion.dive_site.name,
        }
    )
```

**Price Snapshot Pattern:**
```python
class Booking(models.Model):
    price_snapshot = models.JSONField()

    @property
    def price(self):
        """Return price from snapshot (never recalculate)."""
        return Price.from_snapshot(self.price_snapshot)
```

### 21.4 The Audit Service

Every significant action must be logged. The audit service provides:

**Structured Events:**
```python
def log_booking_event(action, booking, actor, **context):
    """Log a booking-related event."""
    AuditEntry.objects.create(
        action=action,
        actor_id=actor.id,
        actor_type="user",
        target_type="booking",
        target_id=str(booking.id),
        context={
            "diver_id": str(booking.diver_id),
            "excursion_id": str(booking.excursion_id),
            "status": booking.status,
            **context,
        },
        timestamp=timezone.now(),
    )
```

**Defined Action Constants:**
```python
class Actions:
    # Excursion lifecycle
    EXCURSION_CREATED = "excursion_created"
    EXCURSION_UPDATED = "excursion_updated"
    EXCURSION_CANCELLED = "excursion_cancelled"
    EXCURSION_STARTED = "excursion_started"
    EXCURSION_COMPLETED = "excursion_completed"

    # Booking lifecycle
    BOOKING_CREATED = "booking_created"
    BOOKING_CHECKED_IN = "booking_checked_in"
    BOOKING_COMPLETED = "booking_completed"
    BOOKING_CANCELLED = "booking_cancelled"
    BOOKING_NO_SHOW = "booking_no_show"

    # Diver events
    DIVER_CREATED = "diver_created"
    DIVER_UPDATED = "diver_updated"
    DIVER_CERTIFICATION_ADDED = "diver_certification_added"
```

---

## Chapter 22: Best Practices (Opinionated)

### 22.1 Database Design

**Use UUIDs for Primary Keys**
```python
id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
```
*Why: Globally unique, no sequence contention, safe for distributed systems*

**Always Include Timestamps**
```python
created_at = models.DateTimeField(auto_now_add=True)
updated_at = models.DateTimeField(auto_now=True)
```
*Why: Essential for debugging, auditing, and data analysis*

**Use Explicit Status Fields**
```python
status = models.CharField(
    max_length=20,
    choices=BookingStatus.choices,
    default=BookingStatus.CONFIRMED,
)
```
*Why: State machines are explicit; derived status from timestamps is error-prone*

**Prefer Database Constraints**
```python
class Meta:
    constraints = [
        models.UniqueConstraint(
            fields=["diver", "excursion"],
            condition=Q(deleted_at__isnull=True),
            name="unique_active_booking_per_diver_excursion",
        ),
        models.CheckConstraint(
            check=Q(max_capacity__gte=1),
            name="excursion_capacity_positive",
        ),
    ]
```
*Why: Database constraints can't be bypassed; application validation can*

### 22.2 API Design

**Resource-Oriented URLs**
```
GET    /api/excursions/           # List excursions
POST   /api/excursions/           # Create excursion
GET    /api/excursions/{id}/      # Get excursion
PATCH  /api/excursions/{id}/      # Update excursion
DELETE /api/excursions/{id}/      # Soft delete excursion

GET    /api/excursions/{id}/bookings/   # List bookings for excursion
POST   /api/excursions/{id}/bookings/   # Create booking for excursion
```

**Action Endpoints for State Transitions**
```
POST   /api/excursions/{id}/start/      # Start excursion
POST   /api/excursions/{id}/complete/   # Complete excursion
POST   /api/excursions/{id}/cancel/     # Cancel excursion

POST   /api/bookings/{id}/check-in/     # Check in booking
POST   /api/bookings/{id}/complete/     # Complete booking
POST   /api/bookings/{id}/cancel/       # Cancel booking
```

**Eligibility Check Endpoint**
```
POST   /api/eligibility/check/
{
    "diver_id": "uuid",
    "excursion_id": "uuid"
}

Response:
{
    "eligible": false,
    "reason": "Requires Advanced Open Water certification",
    "checks": [
        {"name": "certification_level", "passed": false},
        {"name": "medical_clearance", "passed": true},
    ]
}
```

### 22.3 Error Handling

**Domain Exceptions**
```python
class DiveOpsError(Exception):
    """Base exception for dive operations."""
    pass

class IneligibleDiverError(DiveOpsError):
    """Diver does not meet requirements for excursion."""
    def __init__(self, reason):
        self.reason = reason
        super().__init__(f"Ineligible: {reason}")

class ExcursionFullError(DiveOpsError):
    """Excursion has reached capacity."""
    pass

class InvalidStateTransitionError(DiveOpsError):
    """Attempted invalid status transition."""
    def __init__(self, current, attempted):
        self.current = current
        self.attempted = attempted
        super().__init__(f"Cannot transition from {current} to {attempted}")
```

**Translate to HTTP Responses**
```python
@api_view(["POST"])
def create_booking(request, excursion_id):
    try:
        booking = services.create_booking(
            diver=request.user.diver_profile,
            excursion=get_object_or_404(Excursion, id=excursion_id),
            actor=request.user,
        )
        return Response(BookingSerializer(booking).data, status=201)

    except IneligibleDiverError as e:
        return Response(
            {"error": "ineligible", "reason": e.reason},
            status=400
        )
    except ExcursionFullError:
        return Response(
            {"error": "full", "reason": "Excursion is at capacity"},
            status=400
        )
```

### 22.4 Testing Strategy

**Test at Service Layer**
```python
@pytest.mark.django_db
class TestBookingService:
    def test_create_booking_success(self):
        diver = DiverProfileFactory(certification_level="advanced")
        excursion = ExcursionFactory(min_certification_level="open_water")

        booking = services.create_booking(diver, excursion, actor=diver.user)

        assert booking.status == BookingStatus.CONFIRMED
        assert booking.diver == diver
        assert booking.excursion == excursion

    def test_create_booking_ineligible_certification(self):
        diver = DiverProfileFactory(certification_level="open_water")
        excursion = ExcursionFactory(min_certification_level="advanced")

        with pytest.raises(IneligibleDiverError) as exc:
            services.create_booking(diver, excursion, actor=diver.user)

        assert "Advanced" in str(exc.value.reason)

    def test_create_booking_creates_audit_entry(self):
        diver = DiverProfileFactory()
        excursion = ExcursionFactory()

        booking = services.create_booking(diver, excursion, actor=diver.user)

        entry = AuditEntry.objects.filter(
            action=Actions.BOOKING_CREATED,
            target_id=str(booking.id),
        ).first()
        assert entry is not None
        assert entry.actor_id == diver.user.id
```

**Test Edge Cases Explicitly**
```python
def test_booking_price_immutable_after_creation(self):
    """Price snapshot doesn't change when base price changes."""
    excursion_type = ExcursionTypeFactory(base_price=Decimal("100.00"))
    excursion = ExcursionFactory(excursion_type=excursion_type)
    diver = DiverProfileFactory()

    booking = services.create_booking(diver, excursion, actor=diver.user)
    original_price = booking.price.amount

    # Change the base price
    excursion_type.base_price = Decimal("200.00")
    excursion_type.save()

    # Booking price should not change
    booking.refresh_from_db()
    assert booking.price.amount == original_price
```

---

# Part VI: The Future of Dive Shop Technology

---

## Chapter 23: Emerging Trends

### 23.1 Mobile-First Operations

The future of dive shop software is mobile:

**Customer Self-Service**
- Complete booking on smartphone
- Digital waiver signing
- Mobile certification cards
- In-trip photo/video access

**Staff Mobility**
- Check-in from tablet on dock
- Equipment assignment via mobile
- Incident reporting from anywhere
- Real-time communication

**Offline Capability**
- Operations continue without connectivity
- Data syncs when connection returns
- Critical for remote dive locations

### 23.2 Artificial Intelligence

AI is beginning to impact dive operations:

**Demand Forecasting**
- Predict booking patterns
- Optimize pricing dynamically
- Staff scheduling recommendations

**Customer Intelligence**
- Predict customer preferences
- Personalized recommendations
- Churn risk identification

**Safety Enhancement**
- Pattern recognition in incident data
- Equipment failure prediction
- Weather impact assessment

### 23.3 Connected Equipment

The Internet of Things is reaching diving:

**Dive Computers**
- Automatic log uploads
- Real-time monitoring
- Rental tracking

**Boat Systems**
- Location tracking
- Fuel monitoring
- Maintenance alerts

**Facility Sensors**
- Tank pressure monitoring
- Compressor performance
- Environmental conditions

### 23.4 Certification Evolution

Training agencies are digitizing:

**Digital Credentials**
- Blockchain-verified certifications
- Instant verification APIs
- Reduced fraud potential

**Continuing Education**
- Online course completion tracking
- Automatic certification updates
- Integrated specialty progressions

---

## Chapter 24: Building for Tomorrow

### 24.1 Technology Principles

As you build or select systems, prioritize:

**Data Ownership**
- You own your customer and operational data
- Export capabilities are essential
- Avoid vendor lock-in where possible

**Security First**
- Protect customer personal information
- Secure payment data properly
- Plan for breach scenarios

**Scalability**
- Systems should grow with your business
- Avoid solutions that cap at current size
- Consider multi-location potential

**Interoperability**
- Open APIs enable future integration
- Standard data formats reduce friction
- Avoid proprietary silos

### 24.2 The Human Element

Technology enables but doesn't replace human judgment:

**Safety Decisions**
- Software can flag issues but humans decide
- Override capability must exist for edge cases
- Training must include when to deviate from system

**Customer Relationships**
- Technology supports but doesn't substitute personal connection
- Use efficiency gains to spend more time with customers
- Remember why people dive: experiences, not transactions

**Continuous Learning**
- Stay current with technology evolution
- Attend industry conferences and training
- Network with other operators

### 24.3 Final Thoughts

The dive industry is built on passion—for the underwater world, for adventure, for sharing experiences. Technology should amplify that passion, not diminish it.

The best dive shop software:
- Eliminates administrative burden so you can focus on diving
- Prevents errors that could harm customers or business
- Provides visibility that enables better decisions
- Scales to support your growth and ambitions

But technology is only as good as its implementation. Success requires:
- Clear understanding of your operational needs
- Thoughtful selection of appropriate solutions
- Disciplined implementation with proper change management
- Ongoing commitment to measurement and improvement

The surface of the water marks a transition—from the everyday world above to the extraordinary world below. Your operations should make that transition as smooth as possible for your customers.

May your tanks be full, your viz be unlimited, and your software never crash.

---

# Part V: Building with Django Primitives

---

## Chapter 25: The 18 Primitives Architecture

This chapter shows how to build every feature in this book using a thin domain wrapper over the 18 built-in django primitives. Rather than building monolithic applications, we compose focused, battle-tested modules into complete solutions.

### 25.1 The Primitive Inventory

The 18 primitives are organized into layers that enforce clean architecture:

```
┌─────────────────────────────────────────────────────────────────┐
│                     LAYER 5: DOMAIN                             │
│   django-catalog  │  django-encounters  │  django-worklog      │
│   django-geo      │  django-ledger                              │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                     LAYER 4: CONTENT                            │
│   django-documents  │  django-notes  │  django-agreements       │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                     LAYER 3: INFRASTRUCTURE                     │
│          django-decisioning  │  django-audit-log                │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                     LAYER 2: IDENTITY                           │
│                django-parties  │  django-rbac                   │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                     LAYER 1: FOUNDATION                         │
│   django-basemodels  │  django-singleton  │  django-modules     │
│                         django-layers                           │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                     VALUE OBJECTS (No DB)                       │
│              django-money  │  django-sequence                   │
└─────────────────────────────────────────────────────────────────┘
```

**Layer Rule (Non-Negotiable):** Each layer may only import from layers below it. Never import upward.

---

### 25.2 Primitive Reference Guide

**LAYER 1: FOUNDATION**

| Primitive | Purpose | Key Models/Functions |
|-----------|---------|---------------------|
| **django-basemodels** | UUID PKs, timestamps, soft delete | `BaseModel`, `SoftDeleteManager` |
| **django-singleton** | Single-row config tables | `SingletonModel` |
| **django-modules** | App registry, feature flags | `ModuleConfig`, `is_enabled()` |
| **django-layers** | Architecture enforcement | `layer_check()`, import validation |

**LAYER 2: IDENTITY**

| Primitive | Purpose | Key Models/Functions |
|-----------|---------|---------------------|
| **django-parties** | People and organizations | `Party`, `Individual`, `Organization`, `PartyRole` |
| **django-rbac** | Roles and permissions | `Role`, `Permission`, `Assignment`, `has_permission()` |

**LAYER 3: INFRASTRUCTURE**

| Primitive | Purpose | Key Models/Functions |
|-----------|---------|---------------------|
| **django-decisioning** | Rule engine, eligibility | `Rule`, `RuleSet`, `Condition`, `evaluate()` |
| **django-audit-log** | Immutable event history | `AuditEntry`, `log_action()`, `get_history()` |

**LAYER 4: CONTENT**

| Primitive | Purpose | Key Models/Functions |
|-----------|---------|---------------------|
| **django-documents** | File attachments, uploads | `Document`, `DocumentVersion`, `attach()` |
| **django-notes** | Text annotations, comments | `Note`, `NoteThread`, `add_note()` |
| **django-agreements** | Contracts, terms, waivers | `Agreement`, `Signature`, `AgreementVersion` |

**LAYER 5: DOMAIN**

| Primitive | Purpose | Key Models/Functions |
|-----------|---------|---------------------|
| **django-catalog** | Products, pricing, categories | `Item`, `Category`, `Price`, `Variant` |
| **django-encounters** | Time-bounded interactions | `Encounter`, `EncounterType`, `Participant` |
| **django-worklog** | Time tracking, schedules | `WorkEntry`, `Schedule`, `Shift`, `Assignment` |
| **django-geo** | Locations, coordinates, regions | `Location`, `Address`, `Region`, `distance()` |
| **django-ledger** | Double-entry accounting | `Account`, `Entry`, `Transaction`, `post()` |

**VALUE OBJECTS (Stateless)**

| Primitive | Purpose | Key Functions |
|-----------|---------|--------------|
| **django-money** | Currency, amounts, math | `Money`, `Currency`, `convert()`, `allocate()` |
| **django-sequence** | Atomic ID generation | `next_value()`, `Sequence`, `SequenceRange` |

---

## Chapter 26: Feature-to-Primitive Mapping

This chapter shows exactly which primitives power each dive shop feature and what thin domain wrapper you need to add.

### 26.1 Customer & Diver Management

**Feature:** Track divers, their profiles, certifications, and emergency contacts.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-parties` | Base identity for divers (Individual), dive shops (Organization) |
| `django-documents` | Certification card uploads, medical forms |
| `django-basemodels` | UUID, timestamps, soft delete for all models |

**Domain Layer Additions (Thin Wrapper):**

```python
# diveops/models/diver.py

from django_parties.models import Individual
from django_basemodels.models import BaseModel

class DiverProfile(BaseModel):
    """Dive-specific extension of Individual party."""
    party = models.OneToOneField(Individual, on_delete=models.CASCADE)
    emergency_contact_name = models.CharField(max_length=200)
    emergency_contact_phone = models.CharField(max_length=50)
    medical_clearance_date = models.DateField(null=True, blank=True)
    certification_level = models.CharField(max_length=50, choices=CERT_LEVELS)
    total_logged_dives = models.PositiveIntegerField(default=0)

    @property
    def medical_current(self):
        if not self.medical_clearance_date:
            return False
        return self.medical_clearance_date > date.today() - timedelta(days=365)


class Certification(BaseModel):
    """Child records for multi-agency certifications."""
    diver = models.ForeignKey(DiverProfile, on_delete=models.CASCADE,
                               related_name='certifications')
    agency = models.CharField(max_length=50)  # PADI, SSI, NAUI
    certification_type = models.CharField(max_length=100)  # OW, AOW, Rescue
    certification_date = models.DateField()
    card_number = models.CharField(max_length=100)
    document = models.ForeignKey('django_documents.Document',
                                  null=True, blank=True,
                                  on_delete=models.SET_NULL)
    verified_at = models.DateTimeField(null=True, blank=True)
```

**Primitive Wiring:**

```python
# Attach cert card image to certification
from django_documents.services import attach_document

cert = Certification.objects.create(
    diver=diver_profile,
    agency='PADI',
    certification_type='Advanced Open Water',
    certification_date=date(2023, 5, 15),
    card_number='1234567890'
)

# Attach scanned certification card
attach_document(
    target=cert,
    file=uploaded_file,
    document_type='certification_card'
)
```

---

### 26.2 Booking & Excursion Management

**Feature:** Schedule dive trips, manage bookings, track trip lifecycle.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-encounters` | Base model for time-bounded excursions |
| `django-decisioning` | Eligibility checking (cert level, medical) |
| `django-money` | Price representation and math |
| `django-sequence` | Booking confirmation numbers |
| `django-audit-log` | Track all booking state changes |

**Domain Layer Additions:**

```python
# diveops/models/excursion.py

from django_encounters.models import Encounter, EncounterType
from django_basemodels.models import BaseModel

class ExcursionType(BaseModel):
    """Product template for dive trips."""
    name = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    base_price = models.DecimalField(max_digits=10, decimal_places=2)
    default_num_dives = models.PositiveSmallIntegerField(default=2)
    min_certification_level = models.CharField(max_length=50)
    is_active = models.BooleanField(default=True)


class Excursion(BaseModel):
    """A scheduled dive trip (extends Encounter concept)."""
    encounter = models.OneToOneField('django_encounters.Encounter',
                                      on_delete=models.CASCADE)
    excursion_type = models.ForeignKey(ExcursionType, on_delete=models.PROTECT)
    primary_site = models.ForeignKey('DiveSite', on_delete=models.PROTECT)
    scheduled_at = models.DateTimeField()
    boat_name = models.CharField(max_length=100, blank=True)
    max_capacity = models.PositiveSmallIntegerField(default=12)
    status = models.CharField(max_length=20, choices=EXCURSION_STATUS)

    class Meta:
        indexes = [
            models.Index(fields=['scheduled_at', 'status']),
            models.Index(fields=['primary_site', 'scheduled_at']),
        ]


class Booking(BaseModel):
    """A diver's reservation on an excursion."""
    confirmation_number = models.CharField(max_length=20, unique=True)
    diver = models.ForeignKey(DiverProfile, on_delete=models.PROTECT)
    excursion = models.ForeignKey(Excursion, on_delete=models.PROTECT,
                                   related_name='bookings')
    status = models.CharField(max_length=20, choices=BOOKING_STATUS)
    price_snapshot = models.DecimalField(max_digits=10, decimal_places=2)
    booked_at = models.DateTimeField(auto_now_add=True)
    checked_in_at = models.DateTimeField(null=True, blank=True)
    completed_at = models.DateTimeField(null=True, blank=True)
    cancelled_at = models.DateTimeField(null=True, blank=True)
```

**Primitive Wiring:**

```python
# Generate unique confirmation number
from django_sequence import next_value

confirmation = f"BK-{next_value('booking_confirmations'):06d}"

# Check eligibility before booking
from django_decisioning.services import evaluate_ruleset

eligibility = evaluate_ruleset(
    ruleset='diver_eligibility',
    context={
        'diver_cert_level': diver.certification_level,
        'required_cert_level': excursion.excursion_type.min_certification_level,
        'medical_current': diver.medical_current,
        'excursion_capacity': excursion.max_capacity,
        'current_bookings': excursion.bookings.active().count(),
    }
)

if not eligibility.passed:
    raise EligibilityError(eligibility.failure_reasons)

# Log the booking creation
from django_audit_log.services import log_action

log_action(
    action='booking_created',
    actor=request.user,
    target=booking,
    metadata={
        'confirmation_number': booking.confirmation_number,
        'price': str(booking.price_snapshot),
        'excursion_name': excursion.excursion_type.name,
    }
)
```

---

### 26.3 Equipment: Sales, Rentals, Service

**Feature:** Track inventory, manage rentals, schedule equipment service.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-catalog` | Equipment items, categories, pricing |
| `django-worklog` | Service schedules, maintenance logs |
| `django-sequence` | Equipment serial numbers, service ticket IDs |
| `django-audit-log` | Equipment assignment/return tracking |

**Domain Layer Additions:**

```python
# diveops/models/equipment.py

from django_catalog.models import Item, Category
from django_basemodels.models import BaseModel

class EquipmentItem(BaseModel):
    """Physical equipment piece extending catalog Item."""
    catalog_item = models.ForeignKey('django_catalog.Item',
                                      on_delete=models.PROTECT)
    serial_number = models.CharField(max_length=100, unique=True)
    purchase_date = models.DateField()
    status = models.CharField(max_length=20, choices=EQUIPMENT_STATUS)
    last_service_date = models.DateField(null=True, blank=True)
    next_service_due = models.DateField(null=True, blank=True)
    location = models.CharField(max_length=100)  # 'shop', 'boat_1', 'repair'

    # For tanks specifically
    hydro_test_date = models.DateField(null=True, blank=True)
    visual_inspection_date = models.DateField(null=True, blank=True)


class RentalAssignment(BaseModel):
    """Equipment assigned to a diver for a booking."""
    equipment = models.ForeignKey(EquipmentItem, on_delete=models.PROTECT)
    booking = models.ForeignKey('Booking', on_delete=models.CASCADE)
    assigned_at = models.DateTimeField(auto_now_add=True)
    returned_at = models.DateTimeField(null=True, blank=True)
    condition_out = models.CharField(max_length=20)
    condition_in = models.CharField(max_length=20, blank=True)
    damage_notes = models.TextField(blank=True)


class ServiceRecord(BaseModel):
    """Maintenance record for equipment."""
    equipment = models.ForeignKey(EquipmentItem, on_delete=models.CASCADE,
                                   related_name='service_records')
    service_type = models.CharField(max_length=100)
    performed_by = models.ForeignKey('django_parties.Individual',
                                      on_delete=models.PROTECT)
    performed_at = models.DateField()
    notes = models.TextField(blank=True)
    next_due = models.DateField(null=True, blank=True)
    cost = models.DecimalField(max_digits=10, decimal_places=2,
                               null=True, blank=True)
```

**Primitive Wiring:**

```python
# Create equipment from catalog template
from django_catalog.models import Item

# Equipment types defined in catalog
regulator_template = Item.objects.get(sku='REG-APEKS-XTX50')

equipment = EquipmentItem.objects.create(
    catalog_item=regulator_template,
    serial_number=f"REG-{next_value('equipment_serial'):06d}",
    purchase_date=date.today(),
    status='available',
    location='shop'
)

# Schedule service using worklog
from django_worklog.services import schedule_task

schedule_task(
    task_type='equipment_service',
    target=equipment,
    due_date=equipment.next_service_due,
    assigned_to=technician,
    metadata={'service_type': 'annual_regulator_service'}
)

# Log rental assignment
from django_audit_log.services import log_action

log_action(
    action='equipment_rented',
    actor=staff_user,
    target=equipment,
    metadata={
        'rented_to': str(diver),
        'booking': booking.confirmation_number,
        'condition': 'good'
    }
)
```

---

### 26.4 Pricing & Dynamic Adjustments

**Feature:** Base pricing, site adjustments, tier pricing, seasonal rates.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-catalog` | Base prices, variants |
| `django-money` | Currency handling, math operations |
| `django-decisioning` | Price rule engine |

**Domain Layer Additions:**

```python
# diveops/models/pricing.py

from django_basemodels.models import BaseModel
from django_money import Money

class SitePriceAdjustment(BaseModel):
    """Premium or discount for specific dive sites."""
    excursion_type = models.ForeignKey(ExcursionType, on_delete=models.CASCADE)
    dive_site = models.ForeignKey(DiveSite, on_delete=models.CASCADE)
    adjustment = models.DecimalField(max_digits=10, decimal_places=2)
    effective_from = models.DateField()
    effective_to = models.DateField(null=True, blank=True)

    class Meta:
        unique_together = ['excursion_type', 'dive_site', 'effective_from']


class PricingTier(BaseModel):
    """Customer segment pricing (students, locals, etc.)."""
    name = models.CharField(max_length=100)
    discount_percent = models.DecimalField(max_digits=5, decimal_places=2)
    requires_verification = models.BooleanField(default=True)
    verification_document_type = models.CharField(max_length=100, blank=True)


class CustomerTierAssignment(BaseModel):
    """Assign customer to a pricing tier."""
    diver = models.ForeignKey(DiverProfile, on_delete=models.CASCADE)
    tier = models.ForeignKey(PricingTier, on_delete=models.CASCADE)
    verified_at = models.DateTimeField(null=True, blank=True)
    verified_by = models.ForeignKey('django_parties.Individual',
                                     null=True, blank=True,
                                     on_delete=models.SET_NULL)
    expires_at = models.DateField(null=True, blank=True)
    verification_document = models.ForeignKey('django_documents.Document',
                                               null=True, blank=True,
                                               on_delete=models.SET_NULL)
```

**Primitive Wiring:**

```python
# Price calculation service
from django_money import Money
from django_decisioning.services import evaluate_ruleset

def calculate_price(excursion, diver, booking_date):
    """Calculate final price using primitives."""
    base = Money(excursion.excursion_type.base_price, 'USD')

    # Site adjustment
    adjustment = SitePriceAdjustment.objects.filter(
        excursion_type=excursion.excursion_type,
        dive_site=excursion.primary_site,
        effective_from__lte=booking_date
    ).filter(
        Q(effective_to__isnull=True) | Q(effective_to__gte=booking_date)
    ).first()

    if adjustment:
        base = base + Money(adjustment.adjustment, 'USD')

    # Tier discount
    tier_assignment = CustomerTierAssignment.objects.filter(
        diver=diver,
        verified_at__isnull=False
    ).filter(
        Q(expires_at__isnull=True) | Q(expires_at__gte=booking_date)
    ).select_related('tier').first()

    if tier_assignment:
        discount = base * (tier_assignment.tier.discount_percent / 100)
        base = base - discount

    return base
```

---

### 26.5 Compliance, Waivers & Agreements

**Feature:** Liability releases, park permits, regulatory compliance.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-agreements` | Waivers, contracts, versioned terms |
| `django-documents` | Permit uploads, compliance attachments |
| `django-audit-log` | Compliance event tracking |
| `django-geo` | Park boundaries, location validation |

**Domain Layer Additions:**

```python
# diveops/models/compliance.py

from django_agreements.models import Agreement, AgreementVersion, Signature
from django_basemodels.models import BaseModel

class LiabilityWaiver(BaseModel):
    """Dive-specific liability waiver extending Agreement."""
    agreement = models.OneToOneField('django_agreements.Agreement',
                                      on_delete=models.CASCADE)
    waiver_type = models.CharField(max_length=50)  # 'standard', 'minor', 'medical'
    jurisdiction = models.CharField(max_length=100)


class WaiverSignature(BaseModel):
    """Record of diver signing waiver."""
    waiver = models.ForeignKey(LiabilityWaiver, on_delete=models.CASCADE)
    diver = models.ForeignKey(DiverProfile, on_delete=models.CASCADE)
    signature = models.OneToOneField('django_agreements.Signature',
                                      on_delete=models.CASCADE)
    signed_for_booking = models.ForeignKey(Booking, null=True, blank=True,
                                            on_delete=models.SET_NULL)


class Park(BaseModel):
    """Marine park or protected area."""
    name = models.CharField(max_length=200)
    jurisdiction = models.CharField(max_length=100)
    location = models.ForeignKey('django_geo.Location', on_delete=models.PROTECT)
    fee_tourist = models.DecimalField(max_digits=10, decimal_places=2)
    fee_national = models.DecimalField(max_digits=10, decimal_places=2)
    fee_local = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    child_age_exempt = models.PositiveSmallIntegerField(default=12)


class OperatorPermit(BaseModel):
    """Dive shop's permit to operate in a park."""
    park = models.ForeignKey(Park, on_delete=models.CASCADE)
    operator = models.ForeignKey('django_parties.Organization',
                                  on_delete=models.CASCADE)
    permit_number = models.CharField(max_length=100)
    issued_date = models.DateField()
    expires_date = models.DateField()
    max_daily_visitors = models.PositiveIntegerField(null=True, blank=True)
    permit_document = models.ForeignKey('django_documents.Document',
                                         null=True, blank=True,
                                         on_delete=models.SET_NULL)
```

**Primitive Wiring:**

```python
# Create waiver and collect signature
from django_agreements.services import create_signature

def sign_waiver(diver, waiver, booking, signature_data):
    """Collect waiver signature using agreements primitive."""
    # Create signature record
    sig = create_signature(
        agreement_version=waiver.agreement.current_version,
        signer_name=str(diver.party),
        signer_email=diver.party.email,
        signature_data=signature_data,
        ip_address=request.META.get('REMOTE_ADDR'),
    )

    # Link to dive operations
    WaiverSignature.objects.create(
        waiver=waiver,
        diver=diver,
        signature=sig,
        signed_for_booking=booking
    )

    # Audit log
    from django_audit_log.services import log_action
    log_action(
        action='waiver_signed',
        actor=diver.party,
        target=waiver,
        metadata={'booking': booking.confirmation_number if booking else None}
    )

    return sig
```

---

### 26.6 Audit Logging & Event History

**Feature:** Track all system changes, who did what when.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-audit-log` | Complete audit infrastructure |

**Domain Layer Additions:**

The audit log primitive requires minimal domain additions—just consistent usage:

```python
# diveops/services/audit.py

from django_audit_log.services import log_action

# Define dive-specific action types
DIVE_ACTIONS = {
    # Excursion lifecycle
    'excursion_created': 'Excursion Created',
    'excursion_updated': 'Excursion Updated',
    'excursion_cancelled': 'Excursion Cancelled',
    'excursion_started': 'Excursion Started',
    'excursion_completed': 'Excursion Completed',

    # Booking lifecycle
    'booking_created': 'Booking Created',
    'booking_checked_in': 'Diver Checked In',
    'booking_completed': 'Booking Completed',
    'booking_cancelled': 'Booking Cancelled',
    'booking_no_show': 'Marked No-Show',

    # Diver profile
    'diver_created': 'Diver Profile Created',
    'diver_updated': 'Diver Profile Updated',
    'certification_added': 'Certification Added',
    'certification_verified': 'Certification Verified',
    'medical_updated': 'Medical Clearance Updated',

    # Equipment
    'equipment_rented': 'Equipment Rented',
    'equipment_returned': 'Equipment Returned',
    'equipment_serviced': 'Equipment Serviced',
    'equipment_damaged': 'Equipment Damage Reported',

    # Financial
    'payment_received': 'Payment Received',
    'refund_issued': 'Refund Issued',
    'price_adjusted': 'Price Adjusted',
}


def log_dive_action(action, actor, target, **kwargs):
    """Wrapper to ensure consistent dive-specific logging."""
    if action not in DIVE_ACTIONS:
        raise ValueError(f"Unknown action: {action}")

    return log_action(
        action=action,
        action_display=DIVE_ACTIONS[action],
        actor=actor,
        target=target,
        **kwargs
    )
```

---

### 26.7 Loyalty Programs & Rewards

**Feature:** Points earning, tier status, rewards redemption.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-ledger` | Points as a ledger (earning/spending accounts) |
| `django-parties` | Customer identity linkage |
| `django-money` | Points value calculations |
| `django-sequence` | Reward codes, transaction IDs |

**Domain Layer Additions:**

```python
# diveops/models/loyalty.py

from django_ledger.models import Account, Entry
from django_basemodels.models import BaseModel

class LoyaltyProgram(BaseModel):
    """Loyalty program configuration."""
    name = models.CharField(max_length=200)
    points_per_dollar = models.DecimalField(max_digits=5, decimal_places=2, default=1)
    points_currency = models.CharField(max_length=10, default='PTS')
    is_active = models.BooleanField(default=True)


class LoyaltyTier(BaseModel):
    """Tier levels within program."""
    program = models.ForeignKey(LoyaltyProgram, on_delete=models.CASCADE)
    name = models.CharField(max_length=100)
    min_points_lifetime = models.PositiveIntegerField()
    points_multiplier = models.DecimalField(max_digits=3, decimal_places=2, default=1)
    benefits = models.JSONField(default=dict)


class CustomerLoyalty(BaseModel):
    """Customer's loyalty account (links to ledger account)."""
    diver = models.OneToOneField(DiverProfile, on_delete=models.CASCADE)
    program = models.ForeignKey(LoyaltyProgram, on_delete=models.PROTECT)
    points_account = models.OneToOneField('django_ledger.Account',
                                           on_delete=models.PROTECT)
    current_tier = models.ForeignKey(LoyaltyTier, null=True, blank=True,
                                      on_delete=models.SET_NULL)
    lifetime_points_earned = models.PositiveIntegerField(default=0)
    enrolled_at = models.DateTimeField(auto_now_add=True)
```

**Primitive Wiring:**

```python
# Award points using ledger
from django_ledger.services import post_transaction

def award_points(diver, amount, reason, reference=None):
    """Award loyalty points using ledger double-entry."""
    loyalty = diver.customerloyalty

    # Points come from program pool, go to customer account
    program_account = Account.objects.get(code='LOYALTY_POOL')

    entries = [
        Entry(account=program_account, debit=amount),
        Entry(account=loyalty.points_account, credit=amount),
    ]

    tx = post_transaction(
        entries=entries,
        description=reason,
        reference=reference,
        transaction_type='points_award'
    )

    # Update lifetime total
    loyalty.lifetime_points_earned += amount
    loyalty.save(update_fields=['lifetime_points_earned'])

    # Check tier upgrade
    _check_tier_upgrade(loyalty)

    return tx


def redeem_points(diver, amount, reward):
    """Redeem points using ledger debit."""
    loyalty = diver.customerloyalty
    redemption_account = Account.objects.get(code='POINTS_REDEMPTION')

    entries = [
        Entry(account=loyalty.points_account, debit=amount),
        Entry(account=redemption_account, credit=amount),
    ]

    tx = post_transaction(
        entries=entries,
        description=f"Redeemed for: {reward.name}",
        reference=str(reward.id),
        transaction_type='points_redemption'
    )

    return tx
```

---

### 26.8 Gift Cards & Vouchers

**Feature:** Sell gift cards, track balances, process redemptions.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-ledger` | Gift card as liability account |
| `django-money` | Card balances, transactions |
| `django-sequence` | Card numbers, redemption codes |
| `django-audit-log` | Transaction history |

**Domain Layer Additions:**

```python
# diveops/models/giftcards.py

from django_ledger.models import Account
from django_basemodels.models import BaseModel

class GiftCard(BaseModel):
    """Gift card with liability account backing."""
    card_number = models.CharField(max_length=20, unique=True)
    pin = models.CharField(max_length=10)
    liability_account = models.OneToOneField('django_ledger.Account',
                                              on_delete=models.PROTECT)
    original_amount = models.DecimalField(max_digits=10, decimal_places=2)
    card_type = models.CharField(max_length=20, choices=CARD_TYPES)
    purchased_by = models.ForeignKey(DiverProfile, null=True, blank=True,
                                      on_delete=models.SET_NULL,
                                      related_name='purchased_cards')
    recipient_email = models.EmailField(blank=True)
    recipient_name = models.CharField(max_length=200, blank=True)
    personal_message = models.TextField(blank=True)
    purchased_at = models.DateTimeField(auto_now_add=True)
    activated_at = models.DateTimeField(null=True, blank=True)
    expires_at = models.DateField(null=True, blank=True)
    status = models.CharField(max_length=20, default='pending')

    @property
    def current_balance(self):
        return self.liability_account.balance
```

**Primitive Wiring:**

```python
# Issue gift card using ledger
from django_ledger.services import post_transaction, create_account
from django_sequence import next_value

def issue_gift_card(amount, purchaser, recipient_email=None):
    """Issue gift card with ledger-backed liability."""

    # Generate unique card number
    card_number = f"GC-{next_value('gift_cards'):010d}"
    pin = ''.join(random.choices(string.digits, k=6))

    # Create liability account for this card
    liability_account = create_account(
        code=f"LIABILITY_GC_{card_number}",
        name=f"Gift Card {card_number}",
        account_type='liability',
        currency='USD'
    )

    # Create card record
    card = GiftCard.objects.create(
        card_number=card_number,
        pin=pin,
        liability_account=liability_account,
        original_amount=amount,
        card_type='monetary',
        purchased_by=purchaser,
        recipient_email=recipient_email,
        status='active'
    )

    # Record sale: Cash -> Gift Card Liability
    cash_account = Account.objects.get(code='CASH')
    entries = [
        Entry(account=cash_account, debit=amount),
        Entry(account=liability_account, credit=amount),
    ]
    post_transaction(
        entries=entries,
        description=f"Gift card {card_number} issued",
        reference=str(card.id),
        transaction_type='gift_card_sale'
    )

    return card


def redeem_gift_card(card, amount, booking):
    """Redeem gift card balance against booking."""
    revenue_account = Account.objects.get(code='DIVE_REVENUE')

    entries = [
        Entry(account=card.liability_account, debit=amount),
        Entry(account=revenue_account, credit=amount),
    ]

    post_transaction(
        entries=entries,
        description=f"Redemption for booking {booking.confirmation_number}",
        reference=str(booking.id),
        transaction_type='gift_card_redemption'
    )

    # Log redemption
    from django_audit_log.services import log_action
    log_action(
        action='gift_card_redeemed',
        target=card,
        metadata={
            'amount': str(amount),
            'booking': booking.confirmation_number,
            'remaining_balance': str(card.current_balance)
        }
    )
```

---

### 26.9 Scholarships & Donations

**Feature:** Accept donations, manage scholarship fund, award scholarships.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-ledger` | Donation fund accounting |
| `django-parties` | Donors, recipients, sponsors |
| `django-documents` | Recipient documentation |
| `django-notes` | Recipient progress updates |
| `django-audit-log` | Donation and award tracking |

**Domain Layer Additions:**

```python
# diveops/models/scholarships.py

from django_ledger.models import Account
from django_parties.models import Individual
from django_basemodels.models import BaseModel

class ScholarshipProgram(BaseModel):
    """Environmental ambassador scholarship program."""
    name = models.CharField(max_length=200)
    fund_account = models.OneToOneField('django_ledger.Account',
                                         on_delete=models.PROTECT)
    description = models.TextField()
    award_amount = models.DecimalField(max_digits=10, decimal_places=2)
    covers = models.JSONField(default=list)  # ['certification', 'equipment', 'trips']
    is_active = models.BooleanField(default=True)


class ScholarshipDonation(BaseModel):
    """Donation to scholarship fund."""
    program = models.ForeignKey(ScholarshipProgram, on_delete=models.PROTECT)
    donor = models.ForeignKey(DiverProfile, null=True, blank=True,
                               on_delete=models.SET_NULL)
    donor_name = models.CharField(max_length=200)  # For anonymous/non-customer
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    source_booking = models.ForeignKey(Booking, null=True, blank=True,
                                        on_delete=models.SET_NULL)
    is_anonymous = models.BooleanField(default=False)
    message = models.TextField(blank=True)
    tax_receipt_sent = models.BooleanField(default=False)


class ScholarshipRecipient(BaseModel):
    """Local scholarship recipient."""
    party = models.OneToOneField('django_parties.Individual',
                                  on_delete=models.CASCADE)
    application_date = models.DateField()
    background = models.TextField()
    goals = models.TextField()
    status = models.CharField(max_length=20, choices=RECIPIENT_STATUS)
    approved_at = models.DateTimeField(null=True, blank=True)
    approved_by = models.ForeignKey('django_parties.Individual',
                                     null=True, blank=True,
                                     on_delete=models.SET_NULL,
                                     related_name='approved_recipients')


class ScholarshipAward(BaseModel):
    """Award made to recipient from fund."""
    program = models.ForeignKey(ScholarshipProgram, on_delete=models.PROTECT)
    recipient = models.ForeignKey(ScholarshipRecipient, on_delete=models.PROTECT)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    purpose = models.CharField(max_length=200)
    awarded_at = models.DateTimeField(auto_now_add=True)
    completed_at = models.DateTimeField(null=True, blank=True)
```

**Primitive Wiring:**

```python
# Process donation using ledger
from django_ledger.services import post_transaction

def process_donation(program, donor, amount, booking=None):
    """Record donation using ledger double-entry."""
    cash_account = Account.objects.get(code='CASH')

    entries = [
        Entry(account=cash_account, debit=amount),
        Entry(account=program.fund_account, credit=amount),
    ]

    tx = post_transaction(
        entries=entries,
        description=f"Donation from {donor or 'Anonymous'}",
        reference=str(booking.id) if booking else None,
        transaction_type='scholarship_donation'
    )

    # Create donation record
    donation = ScholarshipDonation.objects.create(
        program=program,
        donor=donor,
        donor_name=str(donor) if donor else 'Anonymous',
        amount=amount,
        source_booking=booking
    )

    # Log
    from django_audit_log.services import log_action
    log_action(
        action='donation_received',
        target=program,
        metadata={
            'amount': str(amount),
            'donor': str(donor) if not donation.is_anonymous else 'Anonymous',
            'fund_balance': str(program.fund_account.balance)
        }
    )

    return donation


def award_scholarship(program, recipient, amount, purpose):
    """Award scholarship from fund."""
    expense_account = Account.objects.get(code='SCHOLARSHIP_EXPENSE')

    entries = [
        Entry(account=program.fund_account, debit=amount),
        Entry(account=expense_account, credit=amount),
    ]

    tx = post_transaction(
        entries=entries,
        description=f"Award to {recipient.party} - {purpose}",
        reference=str(recipient.id),
        transaction_type='scholarship_award'
    )

    award = ScholarshipAward.objects.create(
        program=program,
        recipient=recipient,
        amount=amount,
        purpose=purpose
    )

    # Add progress note
    from django_notes.services import add_note
    add_note(
        target=recipient,
        author=request.user,
        content=f"Scholarship awarded: {purpose} (${amount})"
    )

    return award
```

---

### 26.10 AI & Natural Language Interfaces

**Feature:** Chat interfaces, AI assistants, conversation logging.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-notes` | Conversation storage, message threads |
| `django-parties` | User identity for conversations |
| `django-audit-log` | Tool execution logging |
| `django-rbac` | AI permission boundaries |

**Domain Layer Additions:**

```python
# diveops/models/ai.py

from django_notes.models import NoteThread
from django_basemodels.models import BaseModel

class AIConversation(BaseModel):
    """AI chat session extending NoteThread."""
    thread = models.OneToOneField('django_notes.NoteThread',
                                   on_delete=models.CASCADE)
    user = models.ForeignKey(DiverProfile, null=True, blank=True,
                              on_delete=models.SET_NULL)
    session_id = models.CharField(max_length=100, unique=True)
    interface = models.CharField(max_length=50)  # 'web', 'sms', 'voice'
    context = models.JSONField(default=dict)
    started_at = models.DateTimeField(auto_now_add=True)
    ended_at = models.DateTimeField(null=True, blank=True)


class AIToolExecution(BaseModel):
    """Record of AI tool/function calls."""
    conversation = models.ForeignKey(AIConversation, on_delete=models.CASCADE)
    tool_name = models.CharField(max_length=100)
    parameters = models.JSONField()
    result = models.JSONField(null=True, blank=True)
    executed_at = models.DateTimeField(auto_now_add=True)
    duration_ms = models.PositiveIntegerField(null=True, blank=True)
    was_approved = models.BooleanField(default=True)
    error = models.TextField(blank=True)
```

**Primitive Wiring:**

```python
# Create conversation using notes
from django_notes.services import create_thread, add_note

def start_ai_conversation(user, interface):
    """Start AI conversation backed by notes thread."""
    thread = create_thread(
        title=f"AI Chat - {user or 'Guest'} - {timezone.now()}",
        thread_type='ai_conversation'
    )

    conversation = AIConversation.objects.create(
        thread=thread,
        user=user,
        session_id=str(uuid.uuid4()),
        interface=interface
    )

    return conversation


def add_message(conversation, role, content, metadata=None):
    """Add message to conversation using notes."""
    add_note(
        thread=conversation.thread,
        author=conversation.user.party if role == 'user' else None,
        content=content,
        note_type=f'ai_{role}',  # ai_user, ai_assistant, ai_system
        metadata=metadata or {}
    )


def log_tool_execution(conversation, tool_name, params, result, duration_ms):
    """Log AI tool execution."""
    execution = AIToolExecution.objects.create(
        conversation=conversation,
        tool_name=tool_name,
        parameters=params,
        result=result,
        duration_ms=duration_ms
    )

    # Audit sensitive operations
    from django_audit_log.services import log_action
    if tool_name in ['create_booking', 'process_payment', 'modify_booking']:
        log_action(
            action=f'ai_tool_{tool_name}',
            actor=conversation.user.party if conversation.user else None,
            metadata={
                'conversation_id': conversation.session_id,
                'parameters': params,
                'result_summary': str(result)[:500]
            }
        )

    return execution
```

---

### 26.11 Park Reporting & Regulatory Compliance

**Feature:** Park fees, visitor manifests, permit compliance reporting.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-geo` | Park locations, boundaries |
| `django-agreements` | Permits as agreements |
| `django-documents` | Permit documents, reports |
| `django-audit-log` | Visit logging |
| `django-ledger` | Fee collection accounting |

**Domain Layer Additions:**

```python
# diveops/models/parks.py

from django_geo.models import Location
from django_basemodels.models import BaseModel

class ParkVisit(BaseModel):
    """Record of taking diver into park."""
    park = models.ForeignKey(Park, on_delete=models.PROTECT)
    excursion = models.ForeignKey(Excursion, on_delete=models.CASCADE)
    diver = models.ForeignKey(DiverProfile, on_delete=models.PROTECT)
    visitor_type = models.CharField(max_length=20, choices=VISITOR_TYPES)
    fee_paid = models.DecimalField(max_digits=10, decimal_places=2)
    bracelet_number = models.CharField(max_length=50, blank=True)
    visited_at = models.DateTimeField()

    class Meta:
        unique_together = ['park', 'excursion', 'diver']


class BraceletInventory(BaseModel):
    """Park bracelet inventory tracking."""
    park = models.ForeignKey(Park, on_delete=models.CASCADE)
    batch_number = models.CharField(max_length=100)
    start_number = models.CharField(max_length=50)
    end_number = models.CharField(max_length=50)
    quantity = models.PositiveIntegerField()
    received_date = models.DateField()
    cost_per_bracelet = models.DecimalField(max_digits=10, decimal_places=2)
    used_count = models.PositiveIntegerField(default=0)
```

**Primitive Wiring:**

```python
# Generate park report using primitives
from django_documents.services import generate_document

def generate_permit_renewal_report(permit, period_start, period_end):
    """Generate park permit renewal report."""

    # Aggregate visit data
    visits = ParkVisit.objects.filter(
        park=permit.park,
        visited_at__gte=period_start,
        visited_at__lt=period_end,
        excursion__operator=permit.operator
    ).select_related('diver', 'excursion')

    # Categorize by visitor type
    visitor_summary = visits.values('visitor_type').annotate(
        count=Count('id'),
        total_fees=Sum('fee_paid')
    )

    # Monthly breakdown
    monthly_breakdown = visits.annotate(
        month=TruncMonth('visited_at')
    ).values('month', 'visitor_type').annotate(
        count=Count('id'),
        fees=Sum('fee_paid')
    ).order_by('month', 'visitor_type')

    report_data = {
        'permit': permit,
        'period': {'start': period_start, 'end': period_end},
        'summary': list(visitor_summary),
        'monthly': list(monthly_breakdown),
        'total_visitors': visits.count(),
        'total_fees': visits.aggregate(total=Sum('fee_paid'))['total'] or 0,
    }

    # Generate document
    doc = generate_document(
        template='park_permit_renewal_report',
        data=report_data,
        document_type='permit_report',
        target=permit
    )

    # Log report generation
    from django_audit_log.services import log_action
    log_action(
        action='permit_report_generated',
        target=permit,
        metadata={
            'period': f"{period_start} - {period_end}",
            'total_visitors': report_data['total_visitors'],
            'total_fees': str(report_data['total_fees'])
        }
    )

    return doc
```

---

### 26.12 SOP Management & Compliance Calendar

**Feature:** Track SOPs, deadlines, equipment service schedules.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-worklog` | Task scheduling, execution tracking |
| `django-documents` | SOP documents, procedure attachments |
| `django-audit-log` | Compliance event history |
| `django-notes` | Execution notes, issue logging |

**Domain Layer Additions:**

```python
# diveops/models/sop.py

from django_worklog.models import Schedule, WorkEntry
from django_documents.models import Document
from django_basemodels.models import BaseModel

class SOP(BaseModel):
    """Standard Operating Procedure definition."""
    code = models.CharField(max_length=50, unique=True)
    title = models.CharField(max_length=200)
    category = models.CharField(max_length=50)
    description = models.TextField()
    document = models.ForeignKey('django_documents.Document',
                                  null=True, blank=True,
                                  on_delete=models.SET_NULL)
    version = models.CharField(max_length=20)
    effective_date = models.DateField()
    review_frequency_days = models.PositiveIntegerField(default=365)
    is_active = models.BooleanField(default=True)


class SOPStep(BaseModel):
    """Individual step within an SOP."""
    sop = models.ForeignKey(SOP, on_delete=models.CASCADE,
                            related_name='steps')
    sequence = models.PositiveSmallIntegerField()
    instruction = models.TextField()
    required = models.BooleanField(default=True)
    estimated_minutes = models.PositiveSmallIntegerField(null=True, blank=True)
    verification_required = models.BooleanField(default=False)

    class Meta:
        ordering = ['sop', 'sequence']
        unique_together = ['sop', 'sequence']


class SOPExecution(BaseModel):
    """Record of SOP being performed."""
    sop = models.ForeignKey(SOP, on_delete=models.PROTECT)
    work_entry = models.OneToOneField('django_worklog.WorkEntry',
                                       null=True, blank=True,
                                       on_delete=models.SET_NULL)
    performed_by = models.ForeignKey('django_parties.Individual',
                                      on_delete=models.PROTECT)
    started_at = models.DateTimeField()
    completed_at = models.DateTimeField(null=True, blank=True)
    status = models.CharField(max_length=20, choices=EXECUTION_STATUS)
    steps_completed = models.JSONField(default=list)
    notes = models.TextField(blank=True)


class ComplianceItem(BaseModel):
    """Trackable compliance deadline."""
    name = models.CharField(max_length=200)
    category = models.CharField(max_length=50)
    description = models.TextField(blank=True)
    due_date = models.DateField()
    recurrence = models.CharField(max_length=50, blank=True)
    responsible_party = models.ForeignKey('django_parties.Individual',
                                           null=True, blank=True,
                                           on_delete=models.SET_NULL)
    status = models.CharField(max_length=20, default='pending')
    related_document = models.ForeignKey('django_documents.Document',
                                          null=True, blank=True,
                                          on_delete=models.SET_NULL)
    completed_at = models.DateTimeField(null=True, blank=True)
    completed_by = models.ForeignKey('django_parties.Individual',
                                      null=True, blank=True,
                                      on_delete=models.SET_NULL,
                                      related_name='completed_items')
```

**Primitive Wiring:**

```python
# Execute SOP using worklog
from django_worklog.services import create_work_entry, complete_work_entry

def start_sop_execution(sop, performer):
    """Start SOP execution with worklog tracking."""

    # Create work entry
    work_entry = create_work_entry(
        task_type='sop_execution',
        worker=performer,
        description=f"Executing: {sop.title}",
        metadata={'sop_code': sop.code}
    )

    # Create execution record
    execution = SOPExecution.objects.create(
        sop=sop,
        work_entry=work_entry,
        performed_by=performer,
        started_at=timezone.now(),
        status='in_progress',
        steps_completed=[]
    )

    return execution


def complete_sop_step(execution, step_sequence, notes=None):
    """Mark SOP step complete."""
    execution.steps_completed.append({
        'step': step_sequence,
        'completed_at': timezone.now().isoformat(),
        'notes': notes
    })
    execution.save(update_fields=['steps_completed'])

    # Add note if provided
    if notes:
        from django_notes.services import add_note
        add_note(
            target=execution,
            author=execution.performed_by,
            content=f"Step {step_sequence}: {notes}"
        )

    # Check if all required steps complete
    required_steps = execution.sop.steps.filter(required=True).count()
    completed_required = len([
        s for s in execution.steps_completed
        if execution.sop.steps.get(sequence=s['step']).required
    ])

    if completed_required >= required_steps:
        execution.status = 'complete'
        execution.completed_at = timezone.now()
        execution.save()

        # Complete work entry
        complete_work_entry(execution.work_entry)

        # Log completion
        from django_audit_log.services import log_action
        log_action(
            action='sop_completed',
            actor=execution.performed_by,
            target=execution.sop,
            metadata={
                'execution_id': str(execution.id),
                'duration_minutes': (execution.completed_at - execution.started_at).seconds // 60
            }
        )

    return execution
```

---

### 26.13 HR & Staff Management

**Feature:** Staff profiles, schedules, certifications, payroll.

**Primitives Used:**

| Primitive | What It Provides |
|-----------|-----------------|
| `django-parties` | Staff as Individual parties |
| `django-rbac` | Staff roles and permissions |
| `django-worklog` | Schedules, time tracking |
| `django-documents` | Staff certifications, contracts |
| `django-agreements` | Employment agreements |
| `django-ledger` | Payroll accounting (optional) |

**Domain Layer Additions:**

```python
# diveops/models/staff.py

from django_parties.models import Individual
from django_rbac.models import Role, Assignment
from django_worklog.models import Schedule, WorkEntry
from django_basemodels.models import BaseModel

class StaffMember(BaseModel):
    """Staff profile extending Individual party."""
    party = models.OneToOneField('django_parties.Individual',
                                  on_delete=models.CASCADE)
    employee_id = models.CharField(max_length=50, unique=True)
    hire_date = models.DateField()
    job_title = models.CharField(max_length=100)
    department = models.CharField(max_length=100)
    employment_type = models.CharField(max_length=20)  # full_time, part_time, seasonal
    hourly_rate = models.DecimalField(max_digits=10, decimal_places=2,
                                       null=True, blank=True)
    is_active = models.BooleanField(default=True)


class StaffCertification(BaseModel):
    """Staff professional certifications."""
    staff = models.ForeignKey(StaffMember, on_delete=models.CASCADE,
                               related_name='certifications')
    certification_type = models.CharField(max_length=100)
    issuing_body = models.CharField(max_length=100)
    certification_number = models.CharField(max_length=100)
    issued_date = models.DateField()
    expires_date = models.DateField(null=True, blank=True)
    document = models.ForeignKey('django_documents.Document',
                                  null=True, blank=True,
                                  on_delete=models.SET_NULL)


class StaffSchedule(BaseModel):
    """Staff work schedule extending worklog Schedule."""
    staff = models.ForeignKey(StaffMember, on_delete=models.CASCADE)
    schedule = models.OneToOneField('django_worklog.Schedule',
                                     on_delete=models.CASCADE)
    shift_type = models.CharField(max_length=50)  # morning, afternoon, full_day
```

**Primitive Wiring:**

```python
# Create staff member with role assignment
from django_parties.services import create_individual
from django_rbac.services import assign_role
from django_worklog.services import create_schedule

def onboard_staff(name, email, job_title, role_name):
    """Onboard new staff member using primitives."""

    # Create identity
    party = create_individual(
        name=name,
        email=email,
        party_type='staff'
    )

    # Create staff profile
    staff = StaffMember.objects.create(
        party=party,
        employee_id=f"EMP-{next_value('employee_ids'):04d}",
        hire_date=date.today(),
        job_title=job_title,
        employment_type='full_time',
        is_active=True
    )

    # Assign RBAC role
    role = Role.objects.get(name=role_name)  # 'divemaster', 'instructor', 'admin'
    assign_role(
        party=party,
        role=role,
        assigned_by=request.user
    )

    # Create default schedule
    schedule = create_schedule(
        worker=party,
        schedule_type='weekly',
        effective_from=date.today()
    )

    StaffSchedule.objects.create(
        staff=staff,
        schedule=schedule,
        shift_type='full_day'
    )

    # Log onboarding
    from django_audit_log.services import log_action
    log_action(
        action='staff_onboarded',
        actor=request.user,
        target=staff,
        metadata={
            'job_title': job_title,
            'role': role_name
        }
    )

    return staff


def track_staff_time(staff, excursion=None, task_type='dive_operations'):
    """Track staff work time using worklog."""
    from django_worklog.services import clock_in, clock_out

    entry = clock_in(
        worker=staff.party,
        task_type=task_type,
        reference=excursion,
        metadata={'excursion_id': str(excursion.id) if excursion else None}
    )

    return entry


def check_staff_certifications_expiring(days_ahead=30):
    """Check for expiring staff certifications."""
    expiring = StaffCertification.objects.filter(
        expires_date__lte=date.today() + timedelta(days=days_ahead),
        expires_date__gte=date.today(),
        staff__is_active=True
    ).select_related('staff', 'staff__party')

    return expiring
```

---

## Chapter 27: Primitive Composition Patterns

### 27.1 The Composition Philosophy

The power of primitives comes from composition. Each primitive solves one problem well; combining them solves complex business problems without custom code.

**Pattern: Identity + Domain Extension**

```
django-parties (Individual) ──extends──> DiverProfile
django-parties (Individual) ──extends──> StaffMember
django-parties (Organization) ──extends──> DiveShop
```

The base `Individual` provides name, email, contact info, and identity management. Domain extensions add role-specific fields without duplicating identity logic.

**Pattern: Encounter + Specialization**

```
django-encounters (Encounter) ──specializes──> Excursion
django-encounters (Encounter) ──specializes──> Course
django-encounters (Encounter) ──specializes──> EquipmentRental
```

The base `Encounter` provides time-bounded interaction semantics. Specializations add domain-specific fields while inheriting lifecycle management.

**Pattern: Ledger-Backed Everything**

```
Loyalty Points ──backed by──> django-ledger Account
Gift Card Balance ──backed by──> django-ledger Account
Scholarship Fund ──backed by──> django-ledger Account
```

Any value that increases and decreases should be backed by a ledger account. This provides:
- Double-entry integrity (debits = credits)
- Complete transaction history
- Audit trail
- Balance queries at any point in time

**Pattern: Notes for Everything Unstructured**

```
Diver Progress ──uses──> django-notes Thread
AI Conversation ──uses──> django-notes Thread
Incident Report ──uses──> django-notes Thread
```

The notes primitive provides threaded, timestamped, author-attributed text. Use it for anything that doesn't need structured fields.

---

### 27.2 Complete Feature Primitive Map

| Feature | Primary Primitives | Supporting Primitives |
|---------|-------------------|----------------------|
| **Diver Management** | parties | documents, basemodels |
| **Bookings** | encounters, money | sequence, audit-log, decisioning |
| **Excursions** | encounters | geo, worklog |
| **Equipment Sales** | catalog, money | sequence, audit-log |
| **Equipment Rental** | catalog, encounters | audit-log |
| **Equipment Service** | worklog | documents, audit-log |
| **Certifications** | documents | parties, decisioning |
| **Waivers** | agreements | parties, audit-log |
| **Pricing** | catalog, money | decisioning |
| **Loyalty** | ledger | parties, money |
| **Gift Cards** | ledger, money | sequence, audit-log |
| **Scholarships** | ledger, parties | notes, documents |
| **Park Compliance** | geo, agreements | documents, ledger |
| **SOP Management** | worklog, documents | notes, audit-log |
| **Staff/HR** | parties, rbac | worklog, agreements, documents |
| **AI Chat** | notes | parties, audit-log, rbac |
| **Reporting** | audit-log | all (read-only) |

---

### 27.3 Migration Strategy: Generic to Specific

When building with primitives, start generic and specialize only when needed:

**Phase 1: Use Primitive Directly**
```python
# Just use Party for customers initially
customer = Individual.objects.create(name="John Doe", email="john@example.com")
```

**Phase 2: Add Extension When Needed**
```python
# When dive-specific fields needed, add thin wrapper
class DiverProfile(BaseModel):
    party = models.OneToOneField(Individual, on_delete=models.CASCADE)
    certification_level = models.CharField(...)
```

**Phase 3: Add Domain Services**
```python
# When business logic grows, add service layer
def book_excursion(diver, excursion):
    # Compose primitives with domain logic
    eligibility = evaluate_ruleset('diver_eligibility', {...})
    price = calculate_price(excursion, diver)
    confirmation = next_value('bookings')
    ...
```

---

### 27.4 Testing Primitive Compositions

Test at the composition layer, not the primitive layer (primitives are already tested):

```python
@pytest.mark.django_db
class TestBookingWorkflow:
    """Test booking workflow composing multiple primitives."""

    def test_eligible_diver_can_book(self, certified_diver, available_excursion):
        """Diver with proper certification can book."""
        booking = book_excursion(
            diver=certified_diver,
            excursion=available_excursion
        )

        assert booking.confirmation_number.startswith('BK-')
        assert booking.status == 'confirmed'
        assert booking.price_snapshot > 0

    def test_unqualified_diver_rejected(self, novice_diver, advanced_excursion):
        """Diver without certification cannot book advanced trip."""
        with pytest.raises(EligibilityError) as exc:
            book_excursion(
                diver=novice_diver,
                excursion=advanced_excursion
            )

        assert 'certification' in str(exc.value).lower()

    def test_booking_creates_audit_trail(self, certified_diver, available_excursion):
        """Booking creates audit log entry."""
        booking = book_excursion(
            diver=certified_diver,
            excursion=available_excursion
        )

        from django_audit_log.models import AuditEntry
        entry = AuditEntry.objects.filter(
            action='booking_created',
            target_id=str(booking.id)
        ).first()

        assert entry is not None
        assert entry.metadata['confirmation_number'] == booking.confirmation_number
```

---

## Chapter 28: Building New Features with Primitives

### 28.1 The Feature Development Checklist

When adding a new feature, follow this checklist:

```
□ 1. IDENTIFY PRIMITIVES
    - What primitives does this feature need?
    - Which primitive is the "primary" (core data)?
    - Which are "supporting" (augment primary)?

□ 2. CHECK EXISTING MODELS
    - Does a domain wrapper already exist?
    - Can existing model be extended?
    - Does this truly need a new model?

□ 3. DESIGN THIN WRAPPER
    - Only add fields primitives don't provide
    - Use OneToOne or ForeignKey to primitive
    - Keep domain model focused

□ 4. WIRE PRIMITIVE SERVICES
    - Import from primitive's services module
    - Don't reimplement primitive logic
    - Compose primitive calls in domain service

□ 5. ADD AUDIT LOGGING
    - Define action names
    - Log all state changes
    - Include relevant metadata

□ 6. WRITE COMPOSITION TESTS
    - Test the workflow, not primitives
    - Test edge cases and error paths
    - Verify audit trail created
```

### 28.2 Example: Adding Dive Log Feature

**Requirement:** Track individual dive logs for certification progression.

**Step 1: Identify Primitives**
- Primary: `django-worklog` (time-based entry)
- Supporting: `django-geo` (dive site location), `django-documents` (log upload)

**Step 2: Check Existing**
- No existing dive log model
- Diver profile exists, can link to it

**Step 3: Design Wrapper**

```python
class DiveLog(BaseModel):
    """Individual dive record for logbook."""
    diver = models.ForeignKey(DiverProfile, on_delete=models.CASCADE,
                               related_name='dive_logs')
    work_entry = models.OneToOneField('django_worklog.WorkEntry',
                                       null=True, blank=True,
                                       on_delete=models.SET_NULL)
    dive_site = models.ForeignKey(DiveSite, on_delete=models.PROTECT)
    dive_date = models.DateField()
    entry_time = models.TimeField()
    exit_time = models.TimeField()
    max_depth_meters = models.DecimalField(max_digits=5, decimal_places=1)
    bottom_time_minutes = models.PositiveSmallIntegerField()
    buddy = models.ForeignKey(DiverProfile, null=True, blank=True,
                               on_delete=models.SET_NULL,
                               related_name='buddy_dives')
    air_start_psi = models.PositiveSmallIntegerField(null=True, blank=True)
    air_end_psi = models.PositiveSmallIntegerField(null=True, blank=True)
    visibility_meters = models.PositiveSmallIntegerField(null=True, blank=True)
    water_temp_celsius = models.DecimalField(max_digits=4, decimal_places=1,
                                              null=True, blank=True)
    notes = models.TextField(blank=True)
    verified_by = models.ForeignKey(StaffMember, null=True, blank=True,
                                     on_delete=models.SET_NULL)
    verified_at = models.DateTimeField(null=True, blank=True)
    source_booking = models.ForeignKey(Booking, null=True, blank=True,
                                        on_delete=models.SET_NULL)
```

**Step 4: Wire Services**

```python
def log_dive(diver, dive_site, dive_date, depth, duration, **kwargs):
    """Create dive log entry using primitives."""
    from django_worklog.services import create_work_entry

    # Create work entry for time tracking
    work_entry = create_work_entry(
        worker=diver.party,
        task_type='recreational_dive',
        started_at=datetime.combine(dive_date, kwargs.get('entry_time')),
        ended_at=datetime.combine(dive_date, kwargs.get('exit_time')),
        metadata={'dive_site': str(dive_site)}
    )

    # Create dive log
    log = DiveLog.objects.create(
        diver=diver,
        work_entry=work_entry,
        dive_site=dive_site,
        dive_date=dive_date,
        max_depth_meters=depth,
        bottom_time_minutes=duration,
        **kwargs
    )

    # Update diver's total
    diver.total_logged_dives = F('total_logged_dives') + 1
    diver.save(update_fields=['total_logged_dives'])

    # Audit log
    from django_audit_log.services import log_action
    log_action(
        action='dive_logged',
        actor=diver.party,
        target=log,
        metadata={
            'site': dive_site.name,
            'depth': str(depth),
            'duration': duration
        }
    )

    return log
```

---

This architecture ensures:
- **Consistency**: All features built the same way
- **Maintainability**: Primitives updated independently
- **Testability**: Clear boundaries for testing
- **Extensibility**: New features compose existing primitives

The primitive layer does the heavy lifting. Your domain layer stays thin.

---

# Appendices

---

## Appendix A: Glossary of Dive Industry Terms

| Term | Definition |
|------|------------|
| **AOW** | Advanced Open Water - intermediate certification level |
| **BCD** | Buoyancy Control Device - inflatable vest for buoyancy management |
| **Bottom Time** | Time spent at depth during a dive |
| **Buddy** | Dive partner for mutual safety |
| **Cert Card** | Certification card proving training completion |
| **DAN** | Divers Alert Network - diving safety organization |
| **Deco** | Decompression - required stops during ascent on technical dives |
| **DM** | Divemaster - first professional level certification |
| **EANx/Nitrox** | Enriched Air Nitrox - oxygen-enriched breathing gas |
| **Fun Dive** | Recreational dive (vs. training dive) |
| **IDC** | Instructor Development Course |
| **Liveaboard** | Boat-based diving trip with overnight accommodation |
| **Log Book** | Record of diver's completed dives |
| **MOD** | Maximum Operating Depth - deepest safe depth for given gas mix |
| **NDL** | No Decompression Limit - maximum time at depth without deco |
| **OW** | Open Water - entry-level certification |
| **PADI** | Professional Association of Diving Instructors |
| **Rescue Diver** | Certification level focused on emergency response |
| **SI** | Surface Interval - time between dives |
| **SSI** | Scuba Schools International |
| **Tech Diving** | Technical diving - beyond recreational limits |
| **Viz** | Visibility - underwater visual range |

---

## Appendix B: Sample Workflows

### B.1 New Customer Booking Workflow

```
1. Customer Inquiry
   ├── Online: Direct to booking system
   └── Phone/Walk-in: Staff enters into system

2. Availability Check
   ├── Select date and trip type
   └── System shows available options

3. Eligibility Verification
   ├── Customer enters certification info
   ├── System validates against requirements
   └── If ineligible: Show alternatives or requirements

4. Booking Creation
   ├── Customer completes profile
   ├── Medical questionnaire
   ├── Liability waiver
   └── Payment/deposit

5. Confirmation
   ├── Instant confirmation email
   ├── Calendar invitation
   └── Pre-trip information

6. Pre-Trip
   ├── Reminder emails (7 days, 1 day)
   ├── Weather updates if relevant
   └── Final confirmation request

7. Trip Day
   ├── Check-in process
   ├── Equipment assignment
   └── Diving!

8. Post-Trip
   ├── Completion recording
   ├── Review request
   └── Future booking incentive
```

### B.2 Equipment Rental Workflow

```
1. Rental Request
   ├── At booking: Pre-select needed items
   └── At check-in: Last-minute additions

2. Availability Check
   ├── System checks inventory
   ├── Considers items already assigned
   └── Accounts for items in maintenance

3. Size/Fit Selection
   ├── Customer measurements on file
   ├── Staff recommendations
   └── System tracks preferences

4. Assignment
   ├── Specific items assigned to customer
   ├── Serial numbers recorded
   └── Condition noted

5. Usage
   ├── Item checked out with trip
   ├── Tracked during dive
   └── Any issues noted

6. Return
   ├── Item checked back in
   ├── Condition verified
   ├── Damage assessment if needed
   └── Cleaning/service queue

7. Maintenance
   ├── Scheduled service triggers
   ├── Service completion recorded
   └── Return to available inventory
```

---

## Appendix C: Compliance Checklist

### C.1 Per-Customer Documentation

- [ ] Valid photo ID verified
- [ ] Certification card verified (card number recorded)
- [ ] Medical questionnaire completed and reviewed
- [ ] Physician clearance obtained (if required)
- [ ] Liability release signed
- [ ] Emergency contact information collected
- [ ] Equipment preferences noted

### C.2 Per-Trip Documentation

- [ ] Manifest completed with all participants
- [ ] Weather conditions recorded
- [ ] Dive site(s) documented
- [ ] Maximum depth achieved
- [ ] Bottom times recorded
- [ ] Any incidents noted
- [ ] Guide/instructor sign-off

### C.3 Equipment Records

- [ ] Serial numbers for all rental items
- [ ] Assignment log by customer and date
- [ ] Maintenance schedule current
- [ ] Service records complete
- [ ] Cylinder test dates valid
- [ ] Visual inspection dates valid

### C.4 Staff Records

- [ ] All certifications current
- [ ] First aid training current
- [ ] Oxygen provider training current
- [ ] Insurance coverage verified
- [ ] Background checks completed (where required)
- [ ] Employment documentation complete

---

## Appendix D: Software Evaluation Scorecard

Rate each criterion 1-5 (1=Poor, 5=Excellent)

### Functionality
| Criterion | Score | Notes |
|-----------|-------|-------|
| Customer management | | |
| Booking management | | |
| Eligibility checking | | |
| Equipment tracking | | |
| Staff scheduling | | |
| Financial management | | |
| Reporting | | |
| **Subtotal** | /35 | |

### Usability
| Criterion | Score | Notes |
|-----------|-------|-------|
| Interface intuitiveness | | |
| Learning curve | | |
| Mobile accessibility | | |
| Speed/performance | | |
| Customization options | | |
| **Subtotal** | /25 | |

### Technical
| Criterion | Score | Notes |
|-----------|-------|-------|
| Reliability/uptime | | |
| Data security | | |
| Backup/recovery | | |
| Integration capabilities | | |
| Offline functionality | | |
| **Subtotal** | /25 | |

### Vendor
| Criterion | Score | Notes |
|-----------|-------|-------|
| Industry experience | | |
| Support quality | | |
| Training provided | | |
| Pricing transparency | | |
| Company stability | | |
| **Subtotal** | /25 | |

### **TOTAL SCORE** | /110 | |

---

## Appendix E: Implementation Timeline Template

### Phase 1: Preparation (Weeks 1-4)
- Week 1: Vendor contract and kickoff
- Week 2: Data inventory and cleanup planning
- Week 3: Process documentation and gap analysis
- Week 4: Training plan development

### Phase 2: Configuration (Weeks 5-8)
- Week 5: System setup and configuration
- Week 6: Data migration preparation
- Week 7: Integration setup
- Week 8: Testing environment validation

### Phase 3: Training (Weeks 9-10)
- Week 9: Administrator training
- Week 10: End-user training

### Phase 4: Go-Live (Weeks 11-12)
- Week 11: Soft launch with limited scope
- Week 12: Full go-live

### Phase 5: Stabilization (Weeks 13-16)
- Weeks 13-14: Intensive support period
- Weeks 15-16: Issue resolution and optimization

---

*End of Book*
