<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ clinic_name }} - Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        .header { background: #2563eb; color: white; padding: 1rem 2rem; }
        .header h1 { font-size: 1.5rem; }
        .header .date { font-size: 0.9rem; opacity: 0.9; }
        .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
        .grid { display: grid; grid-template-columns: 1fr 300px; gap: 1rem; margin-bottom: 1rem; }
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1rem; }
        .card h2 { font-size: 1rem; color: #666; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .visit-item { display: flex; justify-content: space-between; padding: 0.75rem; border-bottom: 1px solid #eee; }
        .visit-item:last-child { border-bottom: none; }
        .visit-time { color: #666; font-size: 0.9rem; }
        .visit-name { font-weight: 500; }
        .visit-state { font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px; background: #e5e7eb; }
        .visit-state.vitals { background: #fef3c7; color: #92400e; }
        .visit-state.provider { background: #dbeafe; color: #1e40af; }
        .visit-state.checkout { background: #d1fae5; color: #065f46; }
        .visit-state.completed { background: #dcfce7; color: #166534; }
        .provider-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee; }
        .provider-item:last-child { border-bottom: none; }
        .provider-time { font-family: monospace; }
        .active-badge { background: #22c55e; color: white; font-size: 0.7rem; padding: 0.1rem 0.4rem; border-radius: 10px; margin-left: 0.5rem; }
        .board { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; }
        .board-column { background: #f9fafb; border-radius: 6px; padding: 0.5rem; min-height: 150px; }
        .board-column h3 { font-size: 0.75rem; color: #6b7280; text-transform: uppercase; margin-bottom: 0.5rem; text-align: center; }
        .board-item { background: white; padding: 0.5rem; border-radius: 4px; font-size: 0.85rem; margin-bottom: 0.5rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .nav-links { margin-top: 1rem; }
        .nav-links a { color: #2563eb; text-decoration: none; margin-right: 1rem; }
        .nav-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ clinic_name }}</h1>
        <div class="date">{% now "l, F j, Y" %}</div>
    </div>

    <div class="container">
        <div class="grid">
            <div class="card">
                <h2>Today's Visits</h2>
                {% for visit in todays_visits %}
                <div class="visit-item">
                    <div>
                        <span class="visit-time">{{ visit.created_at|time:"H:i" }}</span>
                        <span class="visit-name">
                            {% if visit.subject %}
                                {{ visit.subject.first_name }} {{ visit.subject.last_name }}
                            {% else %}
                                Patient #{{ visit.subject_id|truncatechars:8 }}
                            {% endif %}
                        </span>
                    </div>
                    <span class="visit-state {{ visit.state }}">{{ visit.state }}</span>
                </div>
                {% empty %}
                <p style="color: #666; padding: 1rem 0;">No visits scheduled for today.</p>
                {% endfor %}
            </div>

            <div class="card">
                <h2>Provider Time Log</h2>
                {% for provider in providers_time %}
                <div class="provider-item">
                    <span>{{ provider.name }}{% if provider.is_active %}<span class="active-badge">active</span>{% endif %}</span>
                    <span class="provider-time">{{ provider.total_time }}</span>
                </div>
                {% empty %}
                <p style="color: #666;">No provider time logged today.</p>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h2>Patient Status Board</h2>
            <div class="board">
                <div class="board-column">
                    <h3>Waiting</h3>
                    {% for item in status_board.checked_in %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
                <div class="board-column">
                    <h3>Vitals</h3>
                    {% for item in status_board.vitals %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
                <div class="board-column">
                    <h3>Provider</h3>
                    {% for item in status_board.provider %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
                <div class="board-column">
                    <h3>Checkout</h3>
                    {% for item in status_board.checkout %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
                <div class="board-column">
                    <h3>Complete</h3>
                    {% for item in status_board.completed %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
                <div class="board-column">
                    <h3>Cancelled</h3>
                    {% for item in status_board.cancelled %}
                    <div class="board-item">{{ item.patient_name }}</div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="nav-links">
            <a href="{% url 'clinic:patient_list' %}">View All Patients</a>
            <a href="{% url 'index' %}">Back to Testbed Home</a>
        </div>
    </div>
</body>
</html>
