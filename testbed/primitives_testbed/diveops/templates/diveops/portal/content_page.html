{% extends "portal_ui/base_portal.html" %}
{% load portal_ui_tags %}

{% block page_title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="bg-white shadow rounded-lg p-6">
        <h1 class="text-2xl font-bold text-gray-800">{{ page_title }}</h1>
        {% if meta.seo_description %}
        <p class="text-gray-600 mt-2">{{ meta.seo_description }}</p>
        {% endif %}
    </div>

    <!-- Content Blocks -->
    <div class="bg-white shadow rounded-lg p-6">
        {% for block in blocks %}
            {% if block.type == 'rich_text' %}
                <div class="prose max-w-none mb-6">
                    {{ block.data.content|safe }}
                </div>

            {% elif block.type == 'heading' %}
                {% with level=block.data.level|default:"2" %}
                {% if level == "1" %}
                    <h1 class="text-3xl font-bold text-gray-900 mb-4">{{ block.data.text }}</h1>
                {% elif level == "2" %}
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">{{ block.data.text }}</h2>
                {% elif level == "3" %}
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">{{ block.data.text }}</h3>
                {% elif level == "4" %}
                    <h4 class="text-lg font-semibold text-gray-700 mb-3">{{ block.data.text }}</h4>
                {% elif level == "5" %}
                    <h5 class="text-base font-semibold text-gray-700 mb-2">{{ block.data.text }}</h5>
                {% else %}
                    <h6 class="text-sm font-semibold text-gray-600 mb-2">{{ block.data.text }}</h6>
                {% endif %}
                {% endwith %}

            {% elif block.type == 'image' %}
                <figure class="mb-6">
                    <img src="{{ block.data.url }}" alt="{{ block.data.alt|default:'' }}" class="rounded-lg max-w-full h-auto">
                    {% if block.data.caption %}
                    <figcaption class="text-sm text-gray-500 mt-2 text-center">{{ block.data.caption }}</figcaption>
                    {% endif %}
                </figure>

            {% elif block.type == 'hero' %}
                <div class="relative bg-gradient-to-r from-primary-600 to-primary-800 rounded-lg overflow-hidden mb-6">
                    {% if block.data.background_image %}
                    <div class="absolute inset-0">
                        <img src="{{ block.data.background_image }}" alt="" class="w-full h-full object-cover opacity-20">
                    </div>
                    {% endif %}
                    <div class="relative px-8 py-12 text-center text-white">
                        <h2 class="text-3xl font-bold mb-4">{{ block.data.title }}</h2>
                        {% if block.data.subtitle %}
                        <p class="text-lg opacity-90 mb-6">{{ block.data.subtitle }}</p>
                        {% endif %}
                        {% if block.data.cta_text and block.data.cta_url %}
                        <a href="{{ block.data.cta_url }}" class="inline-block px-6 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-gray-100 transition">
                            {{ block.data.cta_text }}
                        </a>
                        {% endif %}
                    </div>
                </div>

            {% elif block.type == 'cta' %}
                <div class="text-center mb-6">
                    <a href="{{ block.data.url }}" class="inline-block px-6 py-3 bg-primary-500 text-white font-semibold rounded-lg hover:bg-primary-600 transition">
                        {{ block.data.text }}
                    </a>
                </div>

            {% elif block.type == 'divider' %}
                <hr class="my-8 border-gray-200">

            {% elif block.type == 'embed' %}
                <div class="mb-6 aspect-w-16 aspect-h-9">
                    <iframe src="{{ block.data.url }}" frameborder="0" allowfullscreen class="w-full rounded-lg" style="min-height: 400px;"></iframe>
                </div>

            {% elif block.type == 'image_gallery' %}
                <div class="grid grid-cols-2 md:grid-cols-{{ block.data.columns|default:3 }} gap-4 mb-6">
                    {% for image in block.data.images %}
                    <figure>
                        <img src="{{ image.url }}" alt="{{ image.alt|default:'' }}" class="rounded-lg w-full h-48 object-cover">
                        {% if image.caption %}
                        <figcaption class="text-xs text-gray-500 mt-1 text-center">{{ image.caption }}</figcaption>
                        {% endif %}
                    </figure>
                    {% endfor %}
                </div>

            {% else %}
                <!-- Unknown block type: {{ block.type }} -->
                <div class="bg-gray-100 p-4 rounded-lg mb-6 text-sm text-gray-600">
                    [Block: {{ block.type }}]
                </div>
            {% endif %}
        {% empty %}
            <p class="text-gray-500">This page has no content yet.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
