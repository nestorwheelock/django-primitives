{% extends "portal_ui/base_portal.html" %}
{% load portal_ui_tags %}

{% block page_title %}My Dashboard{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Welcome Section -->
    <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-2">Welcome back, {{ user.email }}</h2>
        <p class="text-gray-600">Manage your courses, orders, and dive materials from your dashboard.</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- My Courseware -->
        <div class="bg-white shadow rounded-lg">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    {% icon "book-open" "w-5 h-5 mr-2 text-primary-500" %}
                    My Courseware
                </h3>
            </div>
            <div class="p-6">
                {% if courseware_pages %}
                    <ul class="space-y-3">
                        {% for page in courseware_pages %}
                        <li>
                            <a href="{% url 'portal:content' page.slug %}" class="flex items-center text-primary-600 hover:text-primary-800">
                                {% icon "file-text" "w-4 h-4 mr-2" %}
                                {{ page.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-gray-500 text-sm">No courseware available yet.</p>
                    <a href="{% url 'store:list' %}" class="mt-3 inline-flex items-center text-primary-600 hover:text-primary-800 text-sm">
                        {% icon "shopping-cart" "w-4 h-4 mr-1" %}
                        Browse our courses
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="bg-white shadow rounded-lg">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                    {% icon "receipt" "w-5 h-5 mr-2 text-primary-500" %}
                    Recent Orders
                </h3>
            </div>
            <div class="p-6">
                {% if orders %}
                    <ul class="space-y-3">
                        {% for order in orders %}
                        <li class="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
                            <div>
                                <span class="font-medium text-gray-800">{{ order.order_number }}</span>
                                <span class="text-sm text-gray-500 ml-2">{{ order.created_at|date:"M j, Y" }}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-700">${{ order.total_amount }}</span>
                                <span class="ml-2 px-2 py-1 text-xs rounded-full {% if order.status == 'fulfilled' %}bg-green-100 text-green-700{% elif order.status == 'paid' %}bg-blue-100 text-blue-700{% else %}bg-gray-100 text-gray-700{% endif %}">
                                    {{ order.status|title }}
                                </span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    <a href="{% url 'portal:orders' %}" class="mt-4 inline-flex items-center text-primary-600 hover:text-primary-800 text-sm">
                        View all orders
                        {% icon "arrow-right" "w-4 h-4 ml-1" %}
                    </a>
                {% else %}
                    <p class="text-gray-500 text-sm">No orders yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Entitlements -->
    {% if entitlements %}
    <div class="bg-white shadow rounded-lg">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                {% icon "key" "w-5 h-5 mr-2 text-primary-500" %}
                My Access
            </h3>
        </div>
        <div class="p-6">
            <div class="flex flex-wrap gap-2">
                {% for code in entitlements %}
                <span class="px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm">
                    {{ code }}
                </span>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
